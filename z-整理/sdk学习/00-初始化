â€‹dev-huaweinonnnoâ€‹ â€‹latestFileâ€‹ latestæˆ‘ä¹‹åä¼šåˆ©ç”¨xhbuildæ„å»ºä¸ºwebappï¼Œè¯·ä¸ºæˆ‘å‚è€ƒdev-huweiinoonå®ç°åˆæ­¥çš„sdkå¹¿å‘Šä¸šåŠ¡æ¡†æ¶ â€‹sddâ€‹ ,å®ç°çš„ä½ç½®åœ¨sdd  ï¼Œå‚è€ƒçš„æ–‡æ¡£ä¸ºhttps://doc.shenshiads.com/H5.htmlï¼Œè¯·å…ˆåœ¨sddä¸‹åˆæ­¥å®ç°ï¼Œ

é‡è¦è¯´æ˜ï¼šæ ¹æ®ç¥è“å¹¿å‘Šæ–‡æ¡£ï¼Œæ­¤ SDK å°†è¿è¡Œåœ¨ HBuilderX æ‰“åŒ…çš„ App å†…åµŒ WebView å®¹å™¨ä¸­ï¼Œé€šè¿‡ uni.postMessage ä¸åŸç”Ÿ App é€šä¿¡æ¥è§¦å‘å¹¿å‘Šã€‚
æ·»åŠ å¾…åŠ
åˆ›å»º SDK åŸºç¡€ç›®å½•ç»“æ„å’Œç±»å‹å®šä¹‰
å®ç° EventBus äº‹ä»¶æ€»çº¿æ¨¡å—
å®ç° AdManager å¹¿å‘Šç®¡ç†æ ¸å¿ƒæ¨¡å—
å®ç° Reporter æ•°æ®ä¸ŠæŠ¥æ¨¡å—
å®ç° SDK å…¥å£æ–‡ä»¶å’Œå…¨å±€åˆå§‹åŒ–
éªŒè¯æ„å»ºé…ç½®æ˜¯å¦æ­£ç¡®




## è¯¦ç»†ä»‹ç»ä¸€ä¸‹admanagerçš„ä½œç”¨ï¼Œä»–æ˜¯å¯¹å¹¿å‘Šæ•°æ®è¿›è¡Œåˆå§‹åŒ–å—ï¼Œè€Œä¸æ˜¯å®ä¾‹åŒ–å¹¿å‘Šå¯¹è±¡ï¼Ÿ


ç°åœ¨è¿™ä¸ª AdManager æ›´åƒæ˜¯â€œå¹¿å‘Šæ§åˆ¶å™¨/ç¼–æ’å™¨â€ï¼Œè´Ÿè´£â€œé…ç½® + çŠ¶æ€ + é€šä¿¡ +å›è°ƒè°ƒåº¦â€ï¼Œå¹¶ä¸ç›´æ¥åœ¨ H5 é‡Œå®ä¾‹åŒ–çœŸæ­£çš„å¹¿å‘Šå¯¹è±¡ã€‚
è¿è¡Œç¯å¢ƒè¯´æ˜ï¼šè¿™é‡Œè¯´çš„å¹¿å‘Šéƒ½æ˜¯åœ¨ App WebView å®¹å™¨å†…çš„ H5 é¡µé¢ é‡Œï¼Œé€šè¿‡ uni.postMessage é€šçŸ¥ App ç«¯å»æ‹‰å–/å±•ç¤ºå¹¿å‘Šï¼ŒçœŸæ­£çš„å¹¿å‘Šå®ä¾‹ï¼ˆæ¯”å¦‚æ¿€åŠ±è§†é¢‘ã€æ’å±ï¼‰æ˜¯åœ¨ App ç«¯ ç”±ç¥è“/UniApp çš„åŸç”Ÿ SDK åˆ›å»ºçš„ï¼Œè€Œä¸æ˜¯ H5 è‡ªå·± new å‡ºæ¥çš„ã€‚
1. AdManager çš„æ ¸å¿ƒèŒè´£
ç»“åˆå½“å‰å®ç°ï¼Œå®ƒä¸»è¦åšè¿™å‡ ä»¶äº‹ï¼š
ç®¡ç†å¹¿å‘Šé…ç½®ï¼ˆåˆå§‹åŒ–æ—¶çš„æ•°æ®ï¼‰
åœ¨ init(config: AdConfig) é‡Œæ¥æ”¶ï¼š
å„ç±»å‹å¹¿å‘Šä½ IDï¼šrewardAdUnitId / interstitialAdUnitId / fullScreenAdUnitId
ç”¨æˆ·ä¿¡æ¯ï¼šuserIdã€extra
è°ƒè¯•å¼€å…³ï¼šdebug
æŠŠè¿™äº›é…ç½®ä¿å­˜åˆ°å†…éƒ¨ this.configï¼Œåç»­æ¯æ¬¡å‘æ¶ˆæ¯ç»™ App æ—¶å¸¦ä¸Šï¼ˆå¦‚ userId, extraï¼‰ï¼Œä½†å¹¶ä¸åœ¨ H5 é‡Œç”¨è¿™äº› ID å» createAdã€‚
ç»´æŠ¤æ¯ç§å¹¿å‘Šçš„çŠ¶æ€æœº
ts
private adStatus: Record<AdType, AdStatus> = {
  reward: 'idle',
  inters: 'idle',
  fullScreen: 'idle'
};
- idle / loading / loaded / showing / closed / error
åœ¨ showAd / handleAdLoad / handleAdShow / handleAdError / handleAdClose é‡Œæ›´æ–°çŠ¶æ€
é˜²æ­¢é‡å¤è¯·æ±‚ï¼šå¦‚æœæŸç±»å‹å¹¿å‘Šæ­£åœ¨ loading æˆ– showingï¼Œä¼šç›´æ¥æ‹’ç»æ–°çš„è¯·æ±‚å¹¶å›è°ƒ onError
ç®¡ç†æ¯ç§å¹¿å‘Šçš„å›è°ƒå‡½æ•°
ts
private currentCallbacks: Record<AdType, AdCallbacks | null> = {
  reward: null,
  inters: null,
  fullScreen: null
};
- showAd(type, callbacks) æ—¶æŠŠå›è°ƒå­˜èµ·æ¥
æ”¶åˆ° App çš„äº‹ä»¶ï¼ˆé€šè¿‡ EventBusï¼‰æ—¶è°ƒç”¨å¯¹åº”çš„ï¼š
onLoad
onShow
onError
onClose
è´Ÿè´£ H5 â†” App çš„é€šä¿¡ï¼ˆåè®®å±‚ï¼‰
å¯¹å¤–æš´éœ²ï¼šshowAd(type, callbacks)
å†…éƒ¨é€šè¿‡ postMessageToApp(type)ï¼š
ts
  window.uni.postMessage({
    data: {
      type,          // 'reward' | 'inters' | 'fullScreen'
      userId,        // ä» config è€Œæ¥
      extra,
      timestamp
    }
  });
- App ç«¯åœ¨ <web-view @message="handleMessage"> é‡Œæ‹¿åˆ° type / userId / extraï¼Œå†å»è°ƒç”¨è‡ªå·±æœ¬åœ°çš„ï¼š
rewardedVideoInit
interstitialInit
fullScreenInit
adReward.show(), adInter.show(), adFull.show() ç­‰
ä¹Ÿå°±æ˜¯è¯´ï¼š
H5 ä¾§ AdManagerï¼šåªè´Ÿè´£â€œå‘ä¿¡å· + ç»´æŠ¤çŠ¶æ€/å›è°ƒâ€
App ä¾§ï¼šæ‰æ˜¯â€œçœŸæ­£åˆ›å»ºå’Œå±•ç¤ºå¹¿å‘Šå®ä¾‹â€çš„åœ°æ–¹
æ¥æ”¶ App å›è°ƒå¹¶è½¬æˆ SDK äº‹ä»¶
ts
EventBus.$on('app_ad_load',  data => this.handleAdLoad(data.type));
EventBus.$on('app_ad_error', data => this.handleAdError(data.type, data.error));
EventBus.$on('app_ad_close', data => this.handleAdClose(data.type, data.isEnded));
EventBus.$on('app_ad_show',  data => this.handleAdShow(data.type));
- è¿™äº› app_ad_* äº‹ä»¶ï¼Œé¢„æœŸæ˜¯ App ç«¯åœ¨é€‚å½“æ—¶æœºé€šè¿‡ JSBridge è°ƒç”¨ H5ï¼ŒH5 å†è½¬å‘åˆ° EventBus
AdManager æ ¹æ®è¿™äº›äº‹ä»¶æ›´æ–°çŠ¶æ€ï¼Œå¹¶è°ƒç”¨ä¸šåŠ¡æ³¨å†Œçš„å›è°ƒ
é…åˆ Reporter åšåŸ‹ç‚¹
åœ¨ showAd ä¸­ï¼š
ts
  Reporter.GetInstance().reportAdRequest(type);
- åœ¨ handleAdLoad/Show/Error/Close ä¸­åˆ†åˆ«è°ƒç”¨ reportAdLoad / reportAdShow / reportAdError / reportAdClose
è¿™é‡Œä¸ŠæŠ¥çš„ä»æ˜¯ H5 ä¾§çš„è¡Œä¸ºäº‹ä»¶ï¼Œä¸æ˜¯åº•å±‚å¹¿å‘Š SDK ç›´æ¥ä¸ŠæŠ¥
2. å›åˆ°ä½ çš„é—®é¢˜ï¼šå®ƒæ˜¯åœ¨â€œåˆå§‹åŒ–å¹¿å‘Šæ•°æ®â€è¿˜æ˜¯â€œå®ä¾‹åŒ–å¹¿å‘Šå¯¹è±¡â€ï¼Ÿ
â€œåˆå§‹åŒ–å¹¿å‘Šæ•°æ®â€ æ˜¯ï¼šYES
è´Ÿè´£æ¥æ”¶å¹¶ä¿å­˜å¹¿å‘Šä½ IDã€ç”¨æˆ·ä¿¡æ¯ã€debug å¼€å…³ç­‰é…ç½®
è´Ÿè´£åˆå§‹åŒ–æ¯ç§å¹¿å‘Šçš„çŠ¶æ€ä¸å›è°ƒå­˜å‚¨ç»“æ„
è´Ÿè´£åˆå§‹åŒ–ä¸ App çš„é€šä¿¡æ¡¥ï¼ˆuni.postMessage / EventBus ç›‘å¬ï¼‰
â€œå®ä¾‹åŒ–å¹¿å‘Šå¯¹è±¡â€ æ˜¯ï¼šNOï¼ˆåœ¨å½“å‰æ¶æ„ä¸­ï¼‰
æˆ‘ä»¬çš„ AdManager ä¸ä¼šè°ƒç”¨ç±»ä¼¼ï¼š
window.qg.createRewardedVideoAd
window.qg.createNativeAd
æˆ–ç¥è“æ–‡æ¡£ä¸­çš„ rewardedVideoInit / interstitialInit / fullScreenInit
è¿™äº›â€œçœŸæ­£çš„å¹¿å‘Šå®ä¾‹â€å’Œç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯åœ¨ App ç«¯ å®Œæˆçš„ï¼š
App æ”¶åˆ° H5 çš„æ¶ˆæ¯ï¼ˆtype: 'reward' ç­‰ï¼‰
App å†…è°ƒç”¨ç¥è“ SDK åˆ›å»º/åŠ è½½/å±•ç¤ºå¹¿å‘Š
ç„¶åé€šè¿‡ @message æˆ– JSBridge æŠŠç»“æœå†é€šçŸ¥ç»™ H5ï¼ŒH5 å†ç”± AdManager åšçŠ¶æ€å’Œå›è°ƒåˆ†å‘
æ‰€ä»¥å¯ä»¥è¿™æ ·ä¸€å¥è¯æ€»ç»“ï¼š
AdManager æ˜¯â€œå¹¿å‘Šç¼–æ’å±‚/æ§åˆ¶å™¨â€ï¼Œè´Ÿè´£åˆå§‹åŒ–å¹¿å‘Šé…ç½®å’ŒçŠ¶æ€ã€å‘æ¶ˆæ¯ç»™ App è¯·æ±‚å¹¿å‘Šã€æ¥æ”¶ App å›è°ƒå¹¶è°ƒåº¦ä¸šåŠ¡å›è°ƒï¼Œæœ¬èº«ä¸ç›´æ¥å®ä¾‹åŒ–åŸç”Ÿå¹¿å‘Šå¯¹è±¡ã€‚
å¦‚æœä½ æƒ³åšå¾—æ›´æ¥è¿‘ dev-huaweinonnno é‚£ç§â€œåœ¨ JS é‡Œç›´æ¥ createRewardedVideoAd çš„ SDKâ€ï¼Œåç»­å¯ä»¥ï¼š
åœ¨ App WebView ä¸“ç”¨ç‰ˆæœ¬é‡Œä¿ç•™ç°åœ¨è¿™å¥—â€œæ¶ˆæ¯æ¡¥æ¥â€çš„ AdManager
åœ¨ QuickGame æˆ–å…¶ä»–ç¯å¢ƒé‡Œå†åšä¸€ä¸ª AdNet é£æ ¼çš„ç®¡ç†å™¨ï¼ŒçœŸçš„å»è°ƒç”¨åº•å±‚ SDK å®ä¾‹åŒ–å¹¿å‘Š
ç”¨æ¥å£/æŠ½è±¡ç±»æŠŠâ€œå¹¿å‘Šç®¡ç†å™¨â€è¿™ä¸€å±‚æŠ½è±¡å‡ºæ¥ï¼Œåšæˆç­–ç•¥æ¨¡å¼ï¼Œè¿™æ ·æ¶æ„ä¼šæ¯”è¾ƒå¹²å‡€ã€å¯æ‰©å±•ã€‚
å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ ç”»ä¸€ä¸ªç®€çŸ­çš„æ¶æ„å›¾ï¼Œå¯¹æ¯”ç°åœ¨çš„ AdManager å’ŒåŸé¡¹ç›® AdNet/Startup çš„åˆ†å·¥å…³ç³»ã€‚









## åœ¨ App WebView ä¸“ç”¨ç‰ˆæœ¬é‡Œä¿ç•™ç°åœ¨è¿™å¥—â€œæ¶ˆæ¯æ¡¥æ¥â€çš„ AdManager
## åœ¨ App WebView ä¸“ç”¨ç‰ˆæœ¬é‡Œä¿ç•™ç°åœ¨è¿™å¥—â€œæ¶ˆæ¯æ¡¥æ¥â€çš„ AdManager
## åœ¨ QuickGame æˆ–å…¶ä»–ç¯å¢ƒé‡Œå†åšä¸€ä¸ª AdNet é£æ ¼çš„ç®¡ç†å™¨ï¼ŒçœŸçš„å»è°ƒç”¨åº•å±‚ SDK å®ä¾‹åŒ–å¹¿å‘Š
ç”¨æ¥å£/æŠ½è±¡ç±»æŠŠâ€œå¹¿å‘Šç®¡ç†å™¨â€è¿™ä¸€å±‚æŠ½è±¡å‡ºæ¥ï¼Œåšæˆç­–ç•¥æ¨¡å¼ï¼Œè¿™æ ·æ¶æ„ä¼šæ¯”è¾ƒå¹²å‡€ã€å¯æ‰©å±•ã€‚å®ç°AdNet/Startup ï¼Œå’Œrequestå®ç°è¯·æ±‚ï¼Œå¹¶ä¸”ç»™å‡ºæ¶æ„å›¾ 



ä¸‹é¢æˆ‘ç”¨â€œæ¶æ„ + è®¾è®¡æ¨¡å¼ + ç¤ºä¾‹æ¥å£ + æ¶æ„å›¾â€çš„æ–¹å¼ï¼ŒæŠŠè¿™ä¸€å¥—æ•´ç†æ¸…æ¥šã€‚
è¿è¡Œç¯å¢ƒè¯´æ˜ï¼šä¸‹é¢ä¼šåŒæ—¶è®¨è®ºä¸¤ç±»è¿è¡Œç¯å¢ƒï¼š
App WebView å®¹å™¨é‡Œçš„ H5 é¡µé¢ï¼šé€šè¿‡ uni.postMessage å‘ App å‘æ¶ˆæ¯ï¼ŒApp å†…éƒ¨ç”¨ç¥è“/UniApp SDK çœŸæ­£æ‹‰èµ·å¹¿å‘Šã€‚
ç›´æ¥æœ‰åº•å±‚å¹¿å‘Š SDK çš„ H5 ç¯å¢ƒï¼ˆæ¯”å¦‚ QuickGame æˆ–å°ç¨‹åºç¯å¢ƒï¼‰ï¼šH5 ä»£ç å¯ä»¥ç›´æ¥è°ƒ createRewardedVideoAd ç­‰ API å®ä¾‹åŒ–å¹¿å‘Šã€‚
ä½ æçš„ç›®æ ‡æ˜¯ï¼š
åœ¨ App WebView ä¸“ç”¨ç‰ˆæœ¬ ä¿ç•™ç°åœ¨è¿™å¥—â€œæ¶ˆæ¯æ¡¥æ¥â€çš„å¹¿å‘Šç®¡ç†å™¨ï¼ˆBridge é£æ ¼ï¼‰ã€‚
åœ¨ æœ‰åŸç”Ÿ SDK çš„ç¯å¢ƒ å†åšä¸€ä¸ª â€œAdNet é£æ ¼â€çš„å¹¿å‘Šç®¡ç†å™¨ï¼Œç›´æ¥åˆ›å»ºå¹¿å‘Šå®ä¾‹ã€‚
ä¸¤ç§å®ç°éƒ½é€šè¿‡ç»Ÿä¸€æ¥å£/æŠ½è±¡ç±»æŠ½è±¡ï¼Œä½¿ç”¨ ç­–ç•¥æ¨¡å¼ åˆ‡æ¢ã€‚
ä¸€ã€é¡¶å±‚è®¾è®¡ï¼šIAdManager + ä¸¤ç§ç­–ç•¥å®ç°
1. IAdManagerï¼šç»Ÿä¸€å¹¿å‘Šç®¡ç†å™¨æ¥å£
è¿™ä¸ªæ¥å£åªå…³å¿ƒâ€œä¸šåŠ¡éœ€è¦ä»€ä¹ˆèƒ½åŠ›â€ï¼Œä¸å…³å¿ƒâ€œæ€ä¹ˆå®ç°â€ï¼š
ts
// å»ºè®®æ–‡ä»¶ï¼šsrc/sdk/IAdManager.ts
import type { AdType, AdCallbacks, AdStatus, SDKConfig } from './types';

export interface IAdManager {
  /** åˆå§‹åŒ–å¹¿å‘Šç®¡ç†å™¨ï¼ˆä¼ å…¥å¹¿å‘Šä½ IDã€userIdã€debug ç­‰ï¼‰ */
  init(config: SDKConfig): Promise<void> | void;

  /** é€šç”¨å±•ç¤ºæ¥å£ */
  showAd(type: AdType, callbacks?: AdCallbacks): void;

  /** è¯­ä¹‰åŒ–å°è£…ï¼šæ¿€åŠ±ã€æ’å±ã€å…¨å± */
  showRewardAd(callbacks?: AdCallbacks): void;
  showInterstitialAd(callbacks?: AdCallbacks): void;
  showFullScreenAd(callbacks?: AdCallbacks): void;

  /** å¯é€‰ï¼šé¢„åŠ è½½ */
  preload?(type: AdType): void;

  /** æŸ¥è¯¢çŠ¶æ€ */
  getAdStatus(type: AdType): AdStatus;
  getAllAdStatus(): Record<AdType, AdStatus>;

  /** èµ„æºé‡Šæ”¾ï¼ˆé€€å‡ºæ¸¸æˆ/é”€æ¯ WebView æ—¶è°ƒç”¨ï¼‰ */
  destroy?(): void;
}
ä¹‹åæœ‰ä¸¤ç§å®ç°ï¼š
BridgeAdManagerï¼šå½“å‰çš„ AdManagerï¼ˆæ¶ˆæ¯æ¡¥æ¥ç‰ˆï¼Œè·‘åœ¨ App WebView ä¸­ï¼‰ã€‚
NativeAdManagerï¼ˆæˆ– AdNetAdManagerï¼‰ï¼šAdNet é£æ ¼ï¼Œç›´æ¥è°ƒç”¨åº•å±‚ SDK å®ä¾‹åŒ–å¹¿å‘Šã€‚
äºŒã€ç­–ç•¥ä¸€ï¼šBridgeAdManagerï¼ˆç°æœ‰ AdManager çš„å°è£…ï¼‰
é€‚ç”¨ï¼šApp WebView å®¹å™¨é‡Œçš„ H5 é¡µé¢
æ ¸å¿ƒï¼šH5 ä¸å®ä¾‹åŒ–å¹¿å‘Šï¼Œåªé€šè¿‡ uni.postMessage å‘æ¶ˆæ¯ï¼›App ç«¯çœŸæ­£åœ¨ ads.js é‡Œ init + show å¹¿å‘Šã€‚
ç°æœ‰ AdManager.ts å®é™…å·²ç»æ¥è¿‘è¿™ä¸ªè§’è‰²ï¼Œä½ å¯ä»¥ç¨å¾®è°ƒæ•´ï¼Œè®©å®ƒå®ç° IAdManager æ¥å£ï¼š
ts
// src/sdk/BridgeAdManager.ts
import type { IAdManager } from './IAdManager';
import type { AdType, AdCallbacks, AdStatus, SDKConfig } from './types';
import Reporter from './Reporter';
import EventBus from './EventBus';

export class BridgeAdManager implements IAdManager {
  // è¿™é‡Œå¯ä»¥ç›´æ¥å¤ç”¨ä½ å½“å‰ AdManager é‡Œçš„ config / adStatus / callbacks / bridge é€»è¾‘
  private config: SDKConfig;
  private adStatus: Record<AdType, AdStatus> = {
    reward: 'idle',
    inters: 'idle',
    fullScreen: 'idle',
  };
  private currentCallbacks: Record<AdType, AdCallbacks | null> = {
    reward: null,
    inters: null,
    fullScreen: null,
  };
  private debug = false;

  init(config: SDKConfig): void {
    this.config = { ...config };
    this.debug = !!config.debug;

    // è®¾ç½®æ¡¥ï¼šç›‘å¬ UniAppJSBridgeReadyã€ç›‘å¬ app_ad_* äº‹ä»¶
    this.setupBridge();
  }

  showAd(type: AdType, callbacks?: AdCallbacks): void {
    // 1) çŠ¶æ€æ£€æŸ¥ï¼ˆidle -> loadingï¼‰
    // 2) Reporter.reportAdRequest(type)
    // 3) this.currentCallbacks[type] = callbacks
    // 4) window.uni.postMessage({ data: { type, userId, extra, ts } })
  }

  showRewardAd(cb?: AdCallbacks) {
    this.showAd('reward', cb);
  }
  showInterstitialAd(cb?: AdCallbacks) {
    this.showAd('inters', cb);
  }
  showFullScreenAd(cb?: AdCallbacks) {
    this.showAd('fullScreen', cb);
  }

  getAdStatus(type: AdType): AdStatus {
    return this.adStatus[type];
  }
  getAllAdStatus() {
    return { ...this.adStatus };
  }

  // å†…éƒ¨ï¼šå¤„ç† app å›è°ƒ
  private setupBridge() {
    // EventBus.$on('app_ad_load',  ...)
    // EventBus.$on('app_ad_show',  ...)
    // EventBus.$on('app_ad_error', ...)
    // EventBus.$on('app_ad_close', ...)
  }
}
ç„¶ååœ¨ src/index.ts é‡Œï¼ŒinitSDK æ ¹æ®è¿è¡Œç¯å¢ƒé€‰æ‹©ç­–ç•¥ï¼ˆè¿™é‡Œå…ˆä¿ç•™åŸå…ˆçš„ Bridge é»˜è®¤ç­–ç•¥ï¼‰ã€‚
ä¸‰ã€ç­–ç•¥äºŒï¼šNativeAdManagerï¼ˆAdNet é£æ ¼ï¼Œç›´æ¥å®ä¾‹åŒ–å¹¿å‘Šï¼‰
é€‚ç”¨ï¼šH5 èƒ½ç›´æ¥è®¿é—®åº•å±‚å¹¿å‘Š SDK çš„ç¯å¢ƒï¼ˆæ¯”å¦‚ QuickGame é‡Œèƒ½ç”¨ window.qg.createRewardedVideoAd ä¹‹ç±»ï¼‰ã€‚
æ ¸å¿ƒæ€è·¯ï¼š
Startupï¼šåšåˆå§‹åŒ–ã€æ‹‰é…ç½®ã€ä¸ŠæŠ¥å¯åŠ¨ã€åˆ›å»º AdNet ç­‰ã€‚
AdNetï¼šè´Ÿè´£ã€Œå¹¿å‘Šé˜Ÿåˆ— + é¢‘æ§ + ç¼“å­˜æ± ã€â€”â€”æœ¬è´¨æ˜¯å¹¿å‘Šåˆ†å‘å™¨+æ± åŒ–ã€‚
NativeAdManagerï¼šå®ç° IAdManagerï¼Œå¯¹ä¸Šæä¾› showXXXï¼Œå¯¹ä¸‹è°ƒç”¨ AdNet.GetInstance().getAd(type) æ‹¿å¹¿å‘Šå®ä¾‹ï¼Œç„¶å ad.show()ã€‚
1. NativeAdManager è½®å»“
ts
// src/sdk/NativeAdManager.ts
import type { IAdManager } from './IAdManager';
import type { AdType, AdCallbacks, AdStatus, SDKConfig } from './types';
import Startup from './Startup';
import AdNet from './AdNet';
import Reporter from './Reporter';
import EventBus from './EventBus';

export class NativeAdManager implements IAdManager {
  private config: SDKConfig;
  private adStatus: Record<AdType, AdStatus> = {
    reward: 'idle',
    inters: 'idle',
    fullScreen: 'idle',
  };
  private currentCallbacks: Record<AdType, AdCallbacks | null> = {
    reward: null,
    inters: null,
    fullScreen: null,
  };

  async init(config: SDKConfig): Promise<void> {
    this.config = { ...config };

    // åˆå§‹åŒ– Startupï¼ˆæ‹‰å– adNetConfigã€abConfigã€å…¨å±€ Globalï¼‰
    await Startup.GetInstance().initApp();

    // é¢„åŠ è½½å¹¿å‘Šï¼ˆç±»ä¼¼ dev-huaweinonnno é‡Œ loadAd(0) çš„é€»è¾‘ï¼‰
    AdNet.GetInstance().loadAd(0);
  }

  showAd(type: AdType, callbacks?: AdCallbacks): void {
    this.currentCallbacks[type] = callbacks || null;

    if (type === 'reward') {
      this.showRewardInternal();
    } else if (type === 'inters') {
      this.showInterstitialInternal();
    } else {
      this.showFullScreenInternal();
    }
  }

  showRewardAd(cb?: AdCallbacks) {
    this.showAd('reward', cb);
  }
  showInterstitialAd(cb?: AdCallbacks) {
    this.showAd('inters', cb);
  }
  showFullScreenAd(cb?: AdCallbacks) {
    this.showAd('fullScreen', cb);
  }

  getAdStatus(type: AdType): AdStatus {
    return this.adStatus[type];
  }
  getAllAdStatus() {
    return { ...this.adStatus };
  }

  // ----------------- å†…éƒ¨ï¼šè°ƒç”¨ AdNet å®ä¾‹åŒ–å¹¿å‘Š -----------------

  private showRewardInternal() {
    if (this.adStatus.reward === 'loading' || this.adStatus.reward === 'showing') return;

    const videoAd = AdNet.GetInstance().getAd(1); // 1: æ¿€åŠ±è§†é¢‘
    if (!videoAd) {
      // æ²¡æœ‰ç¼“å­˜ï¼Œè§¦å‘æ‹‰å–
      AdNet.GetInstance().loadAd(1);
      this.currentCallbacks.reward?.onError?.({ code: -1, message: 'æš‚æ— å¯ç”¨æ¿€åŠ±å¹¿å‘Š' });
      return;
    }

    this.adStatus.reward = 'showing';
    Reporter.GetInstance().reportAdShow('reward');

    videoAd.ad.offError();
    videoAd.ad.offClose();

    videoAd.ad.onError((err) => {
      this.adStatus.reward = 'error';
      this.currentCallbacks.reward?.onError?.({ code: err.errCode, message: err.errMsg });
      Reporter.GetInstance().reportAdError('reward', { code: err.errCode, message: err.errMsg });
    });

    videoAd.ad.onClose((res) => {
      const isEnded = !res || !!res.isEnded;
      this.adStatus.reward = 'closed';
      this.currentCallbacks.reward?.onClose?.({ isEnded, adType: 'reward' });
      Reporter.GetInstance().reportAdClose('reward', isEnded);

      // é‡Šæ”¾ & æ‹‰ä¸‹ä¸€è½®
      videoAd.ad.destroy();
      AdNet.GetInstance().unLockAdUnitId(videoAd.adUnitId, 1);
      AdNet.GetInstance().loadAd(1);
    });

    videoAd.ad.show();
  }

  private showInterstitialInternal() {
    // å¯åˆ©ç”¨ AdNet.GetInstance().getAd(2) æ‹¿åŸç”Ÿå¹¿å‘Š/æ’å±å¹¿å‘Šï¼Œæ ¹æ®å¹³å° API è°ƒæ•´
  }

  private showFullScreenInternal() {
    // åŒä¸Šï¼Œæ ¹æ® SDK API å®ç°
  }
}
æ³¨æ„ï¼šè¿™é‡Œçš„ AdNet.GetInstance().getAd(1 | 2) / loadAd(type) é€»è¾‘ï¼Œä½ å¯ä»¥ç›´æ¥å¤ç”¨ dev-huaweinonnno/src/sdk/AdNet.ts çš„é‚£ä¸€å¥—ï¼ˆå·²ç»å¾ˆå®Œå¤‡ï¼‰ï¼Œåªæ˜¯åœ¨â€œå¹¿å‘Šç±»å‹å’Œå¹³å° APIâ€ä¸Šåšé€‚é…ã€‚
å››ã€Startup ä¸ Requestï¼šç¯å¢ƒæ— å…³çš„â€œåŸºç¡€è®¾æ–½å±‚â€
è¿™ä¸ªéƒ¨åˆ†å®Œå…¨å¯ä»¥ç›´æ¥å€Ÿç”¨ä½  dev-huaweinonnno é‡Œçš„è®¾è®¡ï¼Œåªè¦è°ƒæ•´åŸŸå/å‚æ•°å³å¯ã€‚
1. Startupï¼šè´Ÿè´£â€œå¯åŠ¨æµç¨‹ + é…ç½®æ‹‰å– + å…¨å±€ Globalâ€
èŒè´£ï¼ˆå»¶ç»­åŸå·¥ç¨‹æ€è·¯ï¼‰ï¼š
åˆå§‹åŒ– window.Globalï¼ˆstartId/deviceInfo/network/iconState/...ï¼‰
æ‹‰å–ï¼š
getConfig()ï¼šå…¨å±€é…ç½®ï¼ˆbackEventList ç­‰é€»è¾‘å¼€å…³ï¼‰
getAbConfig()ï¼šAB å®éªŒå‚æ•°
getAdNetConfig()ï¼šå¹¿å‘Šé˜Ÿåˆ—ã€ç­–ç•¥ã€é¢‘æ¬¡é™åˆ¶ï¼Œæœ€ç»ˆè½¬æˆ AdNet.setStoreyData(...)
è°ƒç”¨ ReportSdk ä¸ŠæŠ¥å¯åŠ¨äº‹ä»¶ã€å¯åŠ¨è€—æ—¶ç­‰
ç®€åŒ–ç‰ˆè½®å»“ï¼š
ts
// src/sdk/Startup.ts
import Request from './Request';
import AdNet from './AdNet';
import Reporter from './Reporter';
import { getFormatDate } from './Util';

export default class Startup {
  private static instance: Startup;

  static GetInstance() {
    if (!this.instance) this.instance = new Startup();
    return this.instance;
  }

  async initApp() {
    await this.initData();           // è·å– ip / deviceId / systemInfo / network
    this.initial();                  // å¤„ç†å¯åŠ¨å‚æ•° & localStorage è®¡æ•°
    await Promise.all([
      this.getConfig(),
      this.getAbConfig(),
      this.getAdNetConfig(),
    ]);
    // ä¸ŠæŠ¥å¯åŠ¨
    Reporter.GetInstance().reportSDKInit();
  }

  // ... initData / initial / getConfig / getAbConfig / getAdNetConfig
}
getAdNetConfig() æœ€ç»ˆçš„è½ç‚¹æ˜¯ï¼š
ts
AdNet.GetInstance().setStoreyData(videoAdQueue, 1); // æ¿€åŠ±è§†é¢‘
AdNet.GetInstance().setStoreyData(adsQueue, 2);     // åŸç”Ÿ/æ’å±
2. Requestï¼šç»Ÿä¸€çš„ç½‘ç»œè¯·æ±‚å°è£…
ä½œç”¨ï¼š
å›ºå®š baseURL, headerï¼ˆå¸¦ deviceIdã€brand ç­‰ï¼‰
æ‰€æœ‰ APIï¼šrequest({ uri, method, data })ï¼Œå†…éƒ¨ç”¨ fetch æˆ–å¹³å°ç‰¹æœ‰ APIï¼ˆå¦‚ qg.requestï¼‰
Startup / AdNet / Reporter éƒ½åªä¾èµ– Requestï¼Œä¸ç›´æ¥ä½¿ç”¨ fetch æˆ– axios
ç®€åŒ–ç‰ˆï¼š
ts
// src/sdk/Request.ts
interface RequestOptions {
  baseURL: string;
  header?: Record<string, string>;
}

interface RequestConfig {
  uri: string;
  method: 'get' | 'post';
  data?: any;
  noReportResTime?: boolean;
}

export default class Request {
  constructor(private options: RequestOptions) {}

  async request(cfg: RequestConfig): Promise<any> {
    const url = this.options.baseURL + cfg.uri;
    const headers = { 'Content-Type': 'application/json', ...(this.options.header || {}) };

    const res = await fetch(url, {
      method: cfg.method.toUpperCase(),
      headers,
      body: cfg.method === 'post' ? (typeof cfg.data === 'string' ? cfg.data : JSON.stringify(cfg.data)) : undefined,
    });

    const text = await res.text();
    try {
      return JSON.parse(text);
    } catch {
      return text;
    }
  }
}
äº”ã€é€‰æ‹©ç­–ç•¥ï¼šè¿è¡Œæ—¶å·¥å‚
ä½ å¯ä»¥åœ¨ src/index.ts é‡Œæä¸€ä¸ªç®€å•çš„â€œç¯å¢ƒåˆ¤æ–­ + ç­–ç•¥é€‰æ‹©â€ã€‚
å¿…é¡»æ˜ç¡®ï¼š
App WebView å®¹å™¨ åœºæ™¯ï¼šä½¿ç”¨ BridgeAdManagerï¼ˆèµ° uni.postMessageï¼‰ã€‚
QuickGame / å°æ¸¸æˆ / åŸç”Ÿç¯å¢ƒ åœºæ™¯ï¼šä½¿ç”¨ NativeAdManagerï¼ˆç›´æ¥è°ƒ SDKï¼Œå¦‚ window.qg.createRewardedVideoAdï¼‰ã€‚
ä¾‹å¦‚ï¼š
ts
// src/sdk/AdManagerFactory.ts
import { BridgeAdManager } from './BridgeAdManager';
import { NativeAdManager } from './NativeAdManager';
import type { IAdManager } from './IAdManager';
import { isInAppWebView } from './Util';

export function createAdManager(): IAdManager {
  if (isInAppWebView()) {
    // App WebView å®¹å™¨
    return new BridgeAdManager();
  } else {
    // æœ‰ç›´æ¥ SDK çš„ç¯å¢ƒï¼ˆQuickGame ç­‰ï¼‰
    return new NativeAdManager();
  }
}
ç„¶å index.ts ä¸­æ”¹æˆï¼š
ts
import { createAdManager } from './sdk/AdManagerFactory';

const adManager = createAdManager();

export async function initSDK(config?: SDKConfig, cb?: Function) {
  await adManager.init(config || {});
  cb?.();
}

export function showAd(type: AdType, callbacks?: AdCallbacks) {
  adManager.showAd(type, callbacks);
}
å…­ã€æ¶æ„å›¾ï¼ˆmermaidï¼‰
ä¸‹é¢æ˜¯æ•´ä¸ªç­–ç•¥åŒ–æ¶æ„çš„ç®€åŒ–å›¾ï¼ˆåŒ…å« App WebView ä¸ Native SDK ä¸¤æ¡è·¯å¾„ï¼‰ï¼š
mermaid
å·¦ä¾§æ˜¯ä½  H5 ä»£ç å’Œ SDK å„æ¨¡å—ã€‚
ä¸Šæ–¹å³ä¾§æ˜¯ App WebView å®¹å™¨æ–¹æ¡ˆï¼šé€šè¿‡ uni.postMessage â†’ App â†’ shenshiad/ads.js â†’ åŸç”Ÿå¹¿å‘Š SDKã€‚
ä¸‹æ–¹å³ä¾§æ˜¯ Native SDK ç›´è¿æ–¹æ¡ˆï¼šNativeAdManager é€šè¿‡ AdNet ç›´æ¥è°ƒ window.qg ç­‰åº•å±‚ APIã€‚
å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥å¸®ä½ ï¼š
åŸºäºä½ ç°æœ‰çš„ AdManager.ts æŠ½å‡º BridgeAdManagerï¼Œè¡¥ä¸€ä¸ª IAdManager æ¥å£æ–‡ä»¶ã€‚
åœ¨ sdd/src/Startup.ts / sdd/src/AdNet.ts / sdd/src/Request.ts é‡ŒæŒ‰è¿™ä¸ªéª¨æ¶å¡«å……æœ€å°å¯è·‘ç‰ˆæœ¬ï¼ˆå…ˆå†™æ­»æµ‹è¯• advertId 1013000002ï¼Œåç»­å†æ¥çœŸå®é…ç½®ï¼‰ã€‚


## App WebView å®¹å™¨é‡Œçš„ H5 é¡µé¢ï¼šé€šè¿‡ uni.postMessage å‘ App å‘æ¶ˆæ¯ï¼ŒApp å†…éƒ¨ç”¨ç¥è“/UniApp SDK çœŸæ­£æ‹‰èµ·å¹¿å‘Šã€‚æˆ‘çš„ç¯å¢ƒä»…åœ¨App WebView å®¹å™¨é‡Œçš„ H5 é¡µé¢ â€‹AdNet.tsâ€‹ ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªç±»ä¼¼äºè¿™æ ·çš„å¹¿å‘Šæ± å—

å¯ä»¥ï¼Œä½†è¦åˆ†æ¸…æ¥šä¸¤ä»¶äº‹ï¼š
ä½ ç°åœ¨è¿™ä¸ªç¯å¢ƒæ˜¯ App WebView å®¹å™¨é‡Œçš„ H5 é¡µé¢ï¼ŒçœŸæ­£çš„å¹¿å‘Šå®ä¾‹ï¼ˆrewardedVideoInit / createRewardedVideoAd ç­‰ï¼‰åªèƒ½åœ¨ App ç«¯/åŸç”Ÿ SDK é‚£é‡Œåˆ›å»ºã€‚
æ‰€ä»¥åœ¨ H5 é‡Œ å¯ä»¥åšâ€œå¹¿å‘Šæ± /AdNetâ€è¿™ä¸€å±‚çš„â€œç­–ç•¥ + é¢‘æ§ + é˜Ÿåˆ—ç®¡ç†â€ï¼Œä½†è¿™ä¸ªæ± å­å­˜çš„ä¸ä¼šå†æ˜¯â€œåŸç”Ÿå¹¿å‘Šå®ä¾‹â€ï¼Œè€Œæ˜¯â€œå¹¿å‘Šä½ç­–ç•¥ / é¢„åŠ è½½çŠ¶æ€ / å¯ç”¨æ¬¡æ•°â€ç­‰â€œé€»è¾‘ä¿¡æ¯â€ã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼š
dev-huaweinonnno é‡Œçš„ AdNet æ˜¯ã€Œå®ä¾‹æ±  + ç­–ç•¥å±‚ã€â€”â€”æ± å­é‡ŒçœŸçš„å­˜çš„æ˜¯ videoAd / nativeAd å®ä¾‹ï¼›
åœ¨ App WebView H5 é‡Œï¼Œä½ èƒ½åšçš„æ˜¯ã€Œç­–ç•¥å±‚ + é€»è¾‘æ± ã€ï¼Œå®ä¾‹æ± æœ€å¥½æ”¾åœ¨ App ç«¯ã€‚
ä¸‹é¢æŒ‰è®¾è®¡å±‚æ¬¡æ‹†å¼€è®²ã€‚
ä¸€ã€WebView ç¯å¢ƒä¸‹èƒ½ä¸èƒ½æœ‰â€œAdNet é£æ ¼å¹¿å‘Šæ± â€ï¼Ÿ
ä¸èƒ½åšåˆ°çš„éƒ¨åˆ†
åƒ dev-huaweinonnno/src/sdk/AdNet.ts è¿™ç§ä»£ç ï¼š
ts
let videoAd = window.qg.createRewardedVideoAd({ adUnitId });
let nativeAd = window.qg.createNativeAd({ adUnitId });
this.enterThePool(obj); // obj é‡Œé¢å¸¦ ad: videoAd / nativeAd
åœ¨ App WebView H5 é‡Œæ˜¯åšä¸åˆ°çš„ï¼Œå› ä¸ºï¼š
H5 é¡µé¢çœ‹ä¸åˆ° window.qgã€rewardedVideoInit ç­‰åº•å±‚ APIï¼›
ä½ åªèƒ½é€šè¿‡ uni.postMessage æŠŠ â€œæˆ‘è¦æ¿€åŠ± / æ’å± / å…¨å± + ä¸€äº›å‚æ•°â€ å‘ç»™ Appï¼›
App ç«¯åœ¨å®ƒçš„ JSï¼ˆshenshiad/ads.jsã€pages/index.vue é‡Œï¼‰æ‰å» rewardedVideoInit / adReward.load / showã€‚
æ‰€ä»¥ï¼š
H5 ç«¯ä¸èƒ½å»ºç«‹â€œçœŸæ­£æŒæœ‰ SDK å®ä¾‹çš„æ± å­â€ã€‚
èƒ½åšåˆ°çš„éƒ¨åˆ†
ä½† H5 ç«¯å®Œå…¨å¯ä»¥å¤ç”¨ AdNet çš„è¿™å‡ å¤§èƒ½åŠ›ï¼š
å¹¿å‘Šä½å±‚çº§ & é˜Ÿåˆ—ç­–ç•¥
setStoreyData(storeyConfig, type)ã€parallelLoad(type) è¿™å¥—ã€ŒæŒ‰å±‚çº§ã€æŒ‰å¹³å°ã€æŒ‰ rand_num æŠ½å¹¿å‘Šä½ã€çš„ç­–ç•¥ï¼Œå®Œå…¨å¯ä»¥ç»§ç»­æ”¾åœ¨ H5ï¼Œå†³å®šâ€œæœ¬æ¬¡åº”è¯¥è¯·æ±‚å“ªä¸ªå¹¿å‘Šä½/å“ªç§ç±»å‹â€ã€‚
é¢‘ç‡æ§åˆ¶ & æ—¥å¿—ç»Ÿè®¡
getReqAdCountLackã€loadAdCount / loadRVAdCount / loadNativeAdCount è¿™ç§â€œå½“æ—¥è¯·æ±‚æ¬¡æ•° / å¯åŠ¨å†…æ¬¡æ•°â€çš„é€»è¾‘ï¼Œä¹Ÿå¯ä»¥ç»§ç»­æ”¾åœ¨ H5ï¼Œé€šè¿‡ localStorage+æ—¶é—´æˆ³æ§åˆ¶ã€‚
â€œé€»è¾‘æ± â€ / çŠ¶æ€æ± 
ä½ å¯ä»¥ç»´æŠ¤ä¸€ä¸ªæ›´è½»é‡çš„â€œå¯ç”¨å¹¿å‘ŠçŠ¶æ€â€ï¼Œæ¯”å¦‚ï¼š
ts
   // ä¸å†å­˜åŸç”Ÿ ad å¯¹è±¡ï¼Œè€Œæ˜¯é€»è¾‘å¯ç”¨çŠ¶æ€
   interface LogicalAdSlot {
     adUnitId: string;
     type: 1 | 2; // æ¿€åŠ±/æ’å±
     isReady: boolean;   // App é‚£è¾¹å·²ç» preload å¥½
     lastLoadTime: number;
   }

   private rewardPool: LogicalAdSlot[] = [];
   private intersPool: LogicalAdSlot[] = [];
loadAd(type)ï¼šä¸å† createRewardedVideoAdï¼Œè€Œæ˜¯é€šè¿‡ uni.postMessage å‘Šè¯‰ App â€œå¸®æˆ‘é¢„åŠ è½½æŸä¸ªå¹¿å‘Šä½â€ï¼ŒAdNet åªè´Ÿè´£é€‰å¹¿å‘Šä½ï¼‹é™é¢‘ã€‚
å½“ App é¢„åŠ è½½æˆåŠŸåï¼Œåå‘é€šè¿‡ JSBridge å†æŠŠç»“æœå›ç»™ H5ï¼ˆæ¯”å¦‚å‘ app_ad_preload_okï¼‰ï¼ŒH5 AdNet å†æŠŠè¿™ä¸ª adUnitId æ ‡è®°ä¸º isReady = trueï¼Œç­‰å·ç§°â€œæ± å­é‡Œæœ‰ä¸€ä¸ªå¯ç”¨å¹¿å‘Šâ€ã€‚
ä¸ŠæŠ¥é€»è¾‘
ç°åœ¨çš„ reportReqResult / ReportSdk å¯ä»¥ç»§ç»­ç”¨ï¼Œåªæ˜¯ä¸ŠæŠ¥çš„â€œæœ‰å¹¿å‘Š/æ— å¹¿å‘Šâ€æ˜¯ä» App å›ä¼ çš„ç»“æœç¿»è¯‘è¿‡æ¥çš„ï¼Œè€Œä¸æ˜¯ä» create*Ad çš„è¿”å›å€¼ç›´æ¥åˆ¤æ–­ã€‚
äºŒã€ç»™ä½ ä¸€ä¸ªâ€œWebView ä¸“ç”¨ AdNetâ€ çš„æ€è·¯
ç›®æ ‡ï¼šåœ¨ H5 ç«¯ä¿ç•™ AdNet çš„ ç­–ç•¥ + é¢‘æ§ + é˜Ÿåˆ—ï¼Œä½†æŠŠâ€œå®ä¾‹åˆ›å»º/é”€æ¯â€ä¸‹æ”¾åˆ° Appã€‚
1. AdNet çš„è§’è‰²è°ƒæ•´
åœ¨ App WebView ç‰ˆä¸­ï¼ŒAdNet å¯ä»¥å˜æˆï¼š
ä¸å†ä¾èµ– window.qgï¼›
å¯¹å¤–æš´éœ²çš„èŒè´£ï¼š
ts
  class WebViewAdNet {
    // è®¾ç½®ä»åç«¯æ‹¿åˆ°çš„å¹¿å‘Šå±‚çº§ & é˜Ÿåˆ—é…ç½®
    setStoreyData(config, type: number): void;

    // å†³ç­–ï¼šå½“å‰æ˜¯å¦è¿˜èƒ½è¯·æ±‚å¹¿å‘Š / å“ªä¸ªå¹¿å‘Šä½
    getReqAdCountLack(type: number): boolean;

    // å¯åŠ¨ä¸€è½®å¹¿å‘Šé¢„åŠ è½½ï¼ˆå†…éƒ¨ä¼šé€‰å¹¿å‘Šä½ï¼Œå¹¶é€šè¿‡ uni.postMessage é€šçŸ¥ App å» preloadï¼‰
    loadAd(type: number): void;

    // ä»â€œé€»è¾‘æ± â€é‡Œå–ä¸€ä¸ªå¯ç”¨å¹¿å‘Š tokenï¼ˆæœ¬è´¨æ˜¯ï¼šH5 è¿™è¾¹è®¤ä¸º App é‚£è¾¹å·²æœ‰ä¸€ä¸ªreadyå®ä¾‹ï¼‰
    getAdToken(type: number): LogicalAdSlot | null;

    // å½“ App å›è°ƒâ€œé¢„åŠ è½½æˆåŠŸ/å¤±è´¥â€ã€â€œæ’­æ”¾å®Œæˆâ€ç­‰äº‹ä»¶æ—¶ï¼Œæ›´æ–°å†…éƒ¨çŠ¶æ€
    handleAppPreloadResult(data): void;
    handleAppShowResult(data): void;
  }
2. åŠ è½½æµç¨‹ï¼ˆé¢„åŠ è½½ï¼‰
ä¼ªä»£ç å¯¹æ¯”ä¸€ä¸‹ä½ ç°åœ¨çš„ loadRewardedVideoAdï¼šåŸç‰ˆï¼ˆç›´æ¥å®ä¾‹åŒ–ï¼‰
ts
// åŸï¼šçœŸæ­£åˆ›å»ºå®ä¾‹
let videoAd = window.qg.createRewardedVideoAd({ adUnitId });
// onLoad ä¸­ enterThePool(obj) å­˜ ad å®ä¾‹
WebView ç‰ˆï¼ˆåªå‘æ¶ˆæ¯ï¼‰
ts
public loadRewardedVideoAd(adItem) {
  if (this.getReqAdCountLack(1)) return false;

  const { adUnitId } = adItem;

  // åŠ é¢‘æ§è®¡æ•°
  this.loadAdCount += 1;
  this.loadRVAdCount += 1;
  // ... å†™ DayJLRequesttimes

  // ä¸ create å®ä¾‹ï¼Œæ”¹æˆå‘æ¶ˆæ¯ç»™ App
  window.uni.postMessage({
    data: {
      action: 'preload',
      type: 'reward',
      adUnitId,
      price: adItem.price,
    }
  });

  // å…ˆé”ä½è¿™ä¸ª adUnitIdï¼Œé¿å…é‡å¤è¯·æ±‚
  this.adUnitIdLockList.set(adUnitId, 1);

  // çœŸæ­£çš„æˆåŠŸ/å¤±è´¥ï¼Œåœ¨ handleAppPreloadResult é‡Œå¤„ç†
}
App ç«¯åœ¨ handleMessage é‡Œæ”¶åˆ° {action: 'preload', type:'reward', adUnitId}ï¼Œè‡ªå·±è°ƒç”¨ï¼š
js
rewardedVideoInit(adUnitId, extra);
adReward.onLoad(() => {
  // é€šçŸ¥ H5ï¼šé¢„åŠ è½½æˆåŠŸ
  webview.postMessage({
    data: { event: 'preload_ok', type: 'reward', adUnitId }
  });
});
adReward.onError(err => {
  webview.postMessage({
    data: { event: 'preload_error', type: 'reward', adUnitId, err }
  });
});
adReward.load();
H5 æ”¶åˆ°å›è°ƒåï¼ˆé€šè¿‡ EventBus è½¬å‘åˆ° AdNetï¼‰ï¼š
ts
handleAppPreloadResult({ type, adUnitId, ok }) {
  if (ok) {
    this.enterTheLogicalPool({ adUnitId, type, isReady: true, lastLoadTime: Date.now() });
    this.reportReqResult('æœ‰å¹¿å‘Š', adItem);
  } else {
    this.unLockAdUnitId(adUnitId);
    this.reportReqResult('æ— å¹¿å‘Š', adItem);
  }
}
3. å±•ç¤ºæµç¨‹
åŸç‰ˆ showRewardVideoAdï¼š
AdNet.GetInstance().getAd(1) æ‹¿å‡ºçœŸæ­£çš„ videoAd å®ä¾‹ï¼›
è®¾ç½® onError/onCloseï¼ŒvideoAd.show()ï¼›
æ’­æ”¾å®Œé”€æ¯ã€ä¸ŠæŠ¥ã€‚
WebView ç‰ˆï¼š
getAdToken(1) åªæ˜¯æ‹¿åˆ°ä¸€ä¸ª { adUnitId, isReady } çš„é€»è¾‘ tokenï¼›
H5 è°ƒç”¨ uni.postMessage å‘Šè¯‰ Appï¼š
ts
  window.uni.postMessage({
    data: {
      action: 'show',
      type: 'reward',
      adUnitId: token.adUnitId,
    }
  });
App å†…éƒ¨è‡ªå·±æ‰¾åˆ°å¯¹åº”å®ä¾‹ adReward æ¥ show()ï¼Œå¹¶åœ¨ onClose æ—¶é€šçŸ¥ H5 â€œå·²æ’­æ”¾å®Œæˆ/æ˜¯å¦å®Œæ•´æ’­æ”¾â€ã€‚
H5 è¿™è¾¹åˆ™åªè´Ÿè´£ï¼š
è°ƒç”¨ä¸šåŠ¡å›è°ƒ onClose({ isEnded, adType:'reward' })ï¼›
åšé¢‘æ§ç»Ÿè®¡ã€‚
ä¸‰ã€æ¨èæ¶æ„é€‰æ‹©ï¼ˆç»™ä½ ä¸€ä¸ªå·¥ç¨‹æƒè¡¡ï¼‰
ä½ ç°åœ¨çš„å®é™…ç¯å¢ƒæ˜¯ï¼š
åªæœ‰ App WebView å®¹å™¨ H5ï¼Œæ²¡æœ‰æµè§ˆå™¨ç‹¬ç«‹ H5 æˆ– QuickGame + SDK çš„ç›´æ¥åœºæ™¯ã€‚
é‚£ä»å·¥ç¨‹æƒè¡¡æ¥è¯´ï¼Œæœ‰ä¸¤æ¡è·¯ï¼š
è·¯çº¿ Aï¼šæ± å­é€»è¾‘å®Œå…¨æ”¾ App ç«¯ï¼ˆæ¨èï¼‰
H5 ç«¯ï¼š
åªæœ‰ BridgeAdManagerï¼ˆç°æœ‰ AdManagerï¼‰ï¼šå‘æ¶ˆæ¯ã€æ”¶å›è°ƒã€åšç®€å•çŠ¶æ€æœºã€‚
ä¸å†æ AdNet æ± å­ï¼ŒH5 å°±æ˜¯ä¸€å±‚å¾ˆè–„çš„â€œå¹¿å‘Šæ§åˆ¶/å°è£…å±‚ + åŸ‹ç‚¹â€ã€‚
App ç«¯ï¼š
ç›´æ¥æŠŠ dev-huaweinonnno çš„ AdNet + Startup + ReportSdk è¿åˆ° shenshiad/ads.js æˆ–å•ç‹¬ SDK åŒ…é‡Œï¼›
App å†…éƒ¨åšçœŸæ­£çš„å®ä¾‹æ± ã€é¢‘æ§ã€å±‚çº§é˜Ÿåˆ—ï¼ŒH5 åªå‘ â€œreward / inters / fullScreenâ€ è¯·æ±‚ï¼›
ä¼˜ç‚¹ï¼šèŒè´£æ¸…æ™°ï¼ŒWebView åªåšé¡µé¢é€»è¾‘ï¼Œå¹¿å‘Šå¤æ‚ç­–ç•¥éƒ½åœ¨ App / SDK å±‚ï¼›è°ƒè¯•ã€ç°åº¦æ§åˆ¶æ›´é›†ä¸­ã€‚
ç¼ºç‚¹ï¼šAdNet é€»è¾‘ä¸èƒ½é‡å¤ç”¨äºåˆ«çš„ç½‘é¡µï¼ˆä½†ä½ çš„åœºæ™¯æœ¬æ¥å°±ç»‘å®š Appï¼‰ã€‚
è·¯çº¿ Bï¼šåœ¨ H5 åšä¸€ä¸ªâ€œé€»è¾‘ AdNet æ± â€ï¼ŒApp åšâ€œå®ä¾‹æ± â€
H5ï¼šå®ç°ä¸€ä¸ª WebView ç‰ˆ AdNetï¼Œä¿ç•™æ‰€æœ‰ç­–ç•¥/é¢‘æ§ï¼Œä½†ä¸æŒæœ‰çœŸå®å®ä¾‹ï¼›
Appï¼šåªè´Ÿè´£æŒ‰ H5 å†³ç­–çš„å¹¿å‘Šä½å» preload/showï¼Œå¹¶åŒæ­¥çŠ¶æ€äº‹ä»¶å›æ¥ã€‚
ä¼˜ç‚¹ï¼š
ä½ å¯ä»¥æŠŠ AdNet æ€è·¯å®Œæ•´ä¿ç•™åœ¨ H5 SDK ä¸­ï¼Œå°†æ¥æœ‰æµè§ˆå™¨/å°ç¨‹åºç¯å¢ƒå¯ä»¥ç›´æ¥æ›¿æ¢åº•å±‚å®ç°ï¼›
ä»£ç é£æ ¼ä¸Šæ›´æ¥è¿‘ä½ ç°åœ¨ dev-huaweinonnno çš„é‚£å¥—ï¼Œå­¦ä¹ æˆæœ¬ä½ã€‚
ç¼ºç‚¹ï¼š
H5 å’Œ App ä¹‹é—´çš„çŠ¶æ€åŒæ­¥ä¼šæ¯”è¾ƒå¤æ‚ï¼ˆé¢„åŠ è½½æˆåŠŸï¼Ÿå¤±è´¥ï¼Ÿå®ä¾‹æ³„éœ²ï¼ŸWebView é‡è½½ï¼Ÿï¼‰ï¼›
å¦‚æœæ¶ˆæ¯ä¸¢å¤±/æ—¶åºä¹±åºï¼Œæ± å­çŠ¶æ€å®¹æ˜“ä¸ä¸€è‡´ï¼Œéœ€è¦é¢å¤–å…œåº•é€»è¾‘ã€‚
å››ã€ç›´æ¥å›ç­”ä½ çš„é—®é¢˜
â€œæˆ‘çš„ç¯å¢ƒä»…åœ¨ App WebView å®¹å™¨é‡Œçš„ H5 é¡µé¢ï¼ŒAdNet.ts å¯ä»¥åˆ›å»ºä¸€ä¸ªç±»ä¼¼äºè¿™æ ·çš„å¹¿å‘Šæ± å—ï¼Ÿâ€
è‹¥æŒ‡çš„æ˜¯ â€œåƒ dev-huaweinonnno é‚£æ ·ï¼ŒæŠŠ videoAd/nativeAd çœŸå®ä¾‹æ”¾è¿›æ± å­â€ï¼š
ä¸è¡Œï¼Œå› ä¸º WebView H5 ä¾§æ²¡æ³•æ“ä½œåº•å±‚ SDK å®ä¾‹ï¼Œè¿™éƒ¨åˆ†èƒ½åŠ›å¿…é¡»åœ¨ App ç«¯ã€‚
è‹¥æŒ‡çš„æ˜¯ â€œä¿ç•™ AdNet çš„ç­–ç•¥å’Œé¢‘æ§é€»è¾‘ï¼Œåœ¨ H5 ç»´æŠ¤ä¸€ä¸ªå¹¿å‘Šè¯·æ±‚/é¢„åŠ è½½çŠ¶æ€çš„é€»è¾‘æ± â€ï¼š
å¯ä»¥ï¼Œè€Œä¸”æ˜¯ä¸€ä¸ªå¾ˆåˆç†çš„è®¾è®¡ï¼Œä½†éœ€è¦ä½ å’Œ App ç«¯çº¦å®šå¥½ä¸€å¥— JSBridge åè®®ï¼ˆpreload_ok / preload_error / show_ok / show_close ç­‰ï¼‰ï¼ŒH5 çš„ AdNet æ ¹æ®è¿™äº›äº‹ä»¶ç»´æŠ¤â€œé€»è¾‘æ± â€çŠ¶æ€ã€‚
å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ä¸‹ä¸€æ­¥å¸®ä½ ï¼š
åœ¨ sdd/src/AdNet.ts é‡Œç»™å‡ºä¸€ä¸ª ç²¾ç®€ç‰ˆ WebView-AdNet ä»£ç éª¨æ¶ï¼Œåªåšï¼š
setStoreyData
getReqAdCountLack
loadAd(type) â†’ uni.postMessage
handleAppPreloadResult / getAdToken
å¹¶ä¸”å’Œä½ ç°æœ‰çš„ AdManager å¯¹ä¸€ä¸‹æ€ä¹ˆä¸²èµ·æ¥ã€‚

##â€‹latestFileâ€‹ è¿™ä¸ªæ˜¯æˆ‘çš„h5é¡µé¢å§ï¼Œæˆ‘å¯ä»¥æŠŠå®ƒè·‘åœ¨appç«¯ï¼Œä½†æ˜¯æ— æ³•è·å–ä»–çš„ç¯å¢ƒï¼Œéœ€è¦é€šè¿‡jbriageï¼Œæ‰€ä»¥å¹¿å‘Šæ± é€»è¾‘å¯ä»¥é€šè¿‡ç»´æŠ¤idæ¥å®ç°æ± å­ï¼Ÿ

å¯¹ï¼Œä½ ç†è§£å¾—åŸºæœ¬å¯¹ï¼Œå¯ä»¥è¿™ä¹ˆæ€»ç»“ä¸€ä¸‹ä½ ç°åœ¨çš„å±€é¢å’Œå¯è¡Œæ–¹æ¡ˆï¼š
è¿è¡Œç¯å¢ƒè¯´æ˜ï¼š
latestFile/Film æ˜¯ä¸€ä¸ª H5 é¡µé¢å·¥ç¨‹ï¼Œæœ€ç»ˆä¼šè·‘åœ¨ App çš„ WebView å®¹å™¨ é‡Œã€‚
è¿™ä¸ª H5 é¡µé¢æ‹¿ä¸åˆ°åŸç”Ÿå¹¿å‘Š SDKï¼ˆæ¯”å¦‚ rewardedVideoInit æˆ– createRewardedVideoAdï¼‰ï¼Œåªèƒ½é€šè¿‡ JSBridgeï¼ˆweb-view çš„ message/uni.postMessageï¼‰ è·Ÿ App äº¤äº’ã€‚
åœ¨è¿™ä¸ªå‰æä¸‹ï¼š
å¹¿å‘Šå®ä¾‹æ± ï¼ˆçœŸå® SDK å¯¹è±¡çš„æ± å­ï¼‰ï¼šå¿…é¡»åœ¨ App ç«¯ï¼ˆUniApp / åŸç”Ÿä»£ç ï¼‰å®ç°ï¼›
å¹¿å‘Šé€»è¾‘æ± ï¼ˆID + çŠ¶æ€ + é¢‘æ§ + ç­–ç•¥ï¼‰ï¼šå®Œå…¨å¯ä»¥æ”¾åœ¨ H5 ç«¯æ¥åšï¼Œæ­£å¥½é€‚åˆä½ çš„éœ€æ±‚ã€‚
ä¹Ÿå°±æ˜¯ä½ è¯´çš„ï¼šâ€œå¹¿å‘Šæ± é€»è¾‘é€šè¿‡ç»´æŠ¤ id æ¥å®ç°æ± å­â€â€”â€”å¯ä»¥ï¼Œè€Œä¸”æ˜¯æ¨èåšæ³•ã€‚
1. H5 ç«¯èƒ½åšçš„â€œå¹¿å‘Šæ± â€æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ
H5 ç«¯çš„æ± å­ï¼Œä¸å†å­˜çœŸå®å®ä¾‹ï¼Œè€Œæ˜¯å­˜â€œå¹¿å‘Šæ§½ä½çš„é€»è¾‘çŠ¶æ€â€ï¼Œä¾‹å¦‚ï¼š
ts
type LogicalAdType = 'reward' | 'inters' | 'fullScreen';

interface LogicalAdSlot {
  adUnitId: string;          // å¹¿å‘Šä½IDï¼ˆæˆ–ä½ è‡ªå·±çš„ä¸šåŠ¡IDï¼‰
  type: LogicalAdType;       // æ¿€åŠ± / æ’å± / å…¨å±
  isReady: boolean;          // App ç«¯æ˜¯å¦å·²ç»é¢„åŠ è½½å¥½
  lastLoadTime: number;      // ä¸Šæ¬¡é¢„åŠ è½½æ—¶é—´
  lastShowTime?: number;     // ä¸Šæ¬¡å±•ç¤ºæ—¶é—´
  dailyShowCount: number;    // ä»Šæ—¥æ›å…‰æ¬¡æ•°ï¼ˆä» localStorage æ¢å¤ï¼‰
}
åœ¨ H5 é‡Œï¼Œä½ å¯ä»¥ç»´æŠ¤ç±»ä¼¼ï¼š
ts
const logicalPool: LogicalAdSlot[] = [];
// æˆ–æŒ‰ç±»å‹æ‹†å¼€ï¼šrewardPool / intersPool / fullScreenPool
H5 ç«¯è´Ÿè´£ï¼š
é€‰è°å»é¢„åŠ è½½ï¼š
ç”¨ç±»ä¼¼ AdNet.setStoreyData + parallelLoad çš„ç­–ç•¥ï¼Œä»ä¸€å †å¹¿å‘Šä½ ID ä¸­é€‰ä»Šå¤©è¦ç”¨å“ªå‡ ä¸ªï¼›
æ§åˆ¶é¢‘ç‡ï¼š
ç”¨ localStorage + æ—¥æœŸï¼Œåšæ¯å¤©ä¸Šé™ã€å¯åŠ¨å†…ä¸Šé™ç­‰ï¼ˆç±»ä¼¼ DayJLRequesttimes é‚£ä¸€å¥—ï¼‰ï¼›
ç»´æŠ¤é€»è¾‘çŠ¶æ€ï¼š
è¯·æ±‚ä¸­ / å·²é¢„åŠ è½½ / å·²å±•ç¤º / å¤±è´¥å¾…é‡è¯• ç­‰ï¼›
å†³å®šä»€ä¹ˆæ—¶å€™å†æ¬¡ preloadï¼Œä»€ä¹ˆæ—¶å€™ä¸å†è¯·æ±‚ã€‚
2. H5 â†” App é€šä¿¡çº¦å®šï¼ˆæ ¸å¿ƒæ˜¯â€œç”¨ ID å¯¹é½ä¸¤ç«¯çŠ¶æ€â€ï¼‰
ä½ å¯ä»¥æŠŠ JSBridge åè®®è®¾è®¡æˆâ€œä»¥å¹¿å‘Šä½IDä¸ºä¸»é”®â€ï¼š
H5 â†’ Appï¼ˆç”¨ uni.postMessageï¼‰
é¢„åŠ è½½ï¼š
ts
uni.postMessage({
  data: {
    action: 'preload',
    type: 'reward',          // 'reward' | 'inters' | 'fullScreen'
    adUnitId: slot.adUnitId, // æ¥è‡ª logicalPool
    ext: { userId, extra },  // å¯é€‰
  }
});
å±•ç¤ºï¼š
ts
uni.postMessage({
  data: {
    action: 'show',
    type: 'reward',
    adUnitId: slot.adUnitId,
  }
});
ï¼ˆå¯é€‰ï¼‰é‡Šæ”¾/é”€æ¯ï¼š
ts
uni.postMessage({
  data: {
    action: 'destroy',
    type: 'reward',
    adUnitId: slot.adUnitId,
  }
});
App â†’ H5ï¼ˆweb-view çš„ @messageï¼‰
App ç«¯åœ¨å¤„ç†å®Œå¹¿å‘Š SDK äº‹ä»¶åï¼Œç”¨ç±»ä¼¼ï¼š
js
// é¢„åŠ è½½æˆåŠŸ
webview.postMessage({
  data: { event: 'preload_ok', type: 'reward', adUnitId }
});

// é¢„åŠ è½½å¤±è´¥
webview.postMessage({
  data: { event: 'preload_error', type: 'reward', adUnitId, err }
});

// å±•ç¤ºç»“æŸ
webview.postMessage({
  data: { event: 'show_close', type: 'reward', adUnitId, isEnded: true }
});
H5 æ”¶åˆ°åï¼ˆå¯ä»¥å…ˆç»Ÿä¸€ä¸¢ç»™ EventBusï¼‰ï¼Œå†ç”±ä½ çš„â€œWebView ç‰ˆ AdNet/AdManagerâ€å»æ›´æ–°æ± å­ï¼š
ts
function handleAppMessage(msg) {
  const { event, type, adUnitId, isEnded } = msg.data;

  const slot = logicalPool.find(s => s.adUnitId === adUnitId && s.type === type);
  if (!slot) return;

  if (event === 'preload_ok') {
    slot.isReady = true;
    slot.lastLoadTime = Date.now();
  } else if (event === 'preload_error') {
    slot.isReady = false;
    // è¿™é‡Œå¯ä»¥åšé‡è¯•/backoff
  } else if (event === 'show_close') {
    slot.isReady = false;
    slot.lastShowTime = Date.now();
    slot.dailyShowCount += 1;
    // è¿™é‡Œè§¦å‘ H5 å›è°ƒï¼šonClose({ isEnded, adType: type })
  }
}
3. å’Œä½ ç°æœ‰ latestFile/Film çš„å…³ç³»
d:\VE\latestFile\Film æ˜¯ä¸€ä¸ªæ™®é€š Vue + Vite H5 å·¥ç¨‹ï¼›
å½“ä½ æŠŠå®ƒæ”¾åˆ° App çš„ <web-view src="..."> é‡Œæ—¶ï¼š
å®ƒå°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„ â€œApp WebView å®¹å™¨é‡Œçš„ H5 é¡µé¢â€ï¼›
åªèƒ½é€šè¿‡ JSBridge è·Ÿ App å†…çš„ shenshiad/ads.js æˆ–å…¶å®ƒå¹¿å‘Š SDK å°è£…äº¤äº’ï¼›
ä½ å¯ä»¥åœ¨ Film å·¥ç¨‹é‡Œå®ç°ï¼š
ä¸€ä¸ª AdManagerï¼ˆå¯¹ä¸šåŠ¡ç»„ä»¶æš´éœ² showRewardAd / showInterstitialAd ç­‰ï¼‰ï¼›
å†…éƒ¨å†æŒ‚ä¸€ä¸ªâ€œé€»è¾‘ AdNet æ± â€ï¼ˆç”¨ adUnitId + çŠ¶æ€ç®¡ç†ï¼‰ã€‚
ç»„ä»¶ä¾§ä½¿ç”¨å°±ä¼šå¾ˆå¹²å‡€ï¼Œä¾‹å¦‚ï¼š
ts
// ä»»æ„ Vue ç»„ä»¶é‡Œ
import { useAdManager } from '@/hooks/useAdManager';

const adManager = useAdManager();

adManager.showRewardAd({
  onClose(res) {
    if (res.isEnded) {
      // å‘æ”¾å¥–åŠ±
    }
  }
});
useAdManager é‡Œå†å»è°ƒç”¨ä½ åœ¨ sdd é‡Œå°è£…å¥½çš„ SDKï¼ˆBridgeAdManager + é€»è¾‘AdNetï¼‰ï¼Œè¿™ä¸¤å±‚é€šè¿‡ adUnitId åšè§£è€¦ã€‚
4. ç®€çŸ­å›ç­”ä½ çš„è¯
â€œlatestFile æ˜¯æˆ‘çš„ H5 é¡µé¢ï¼Œæˆ‘å¯ä»¥æŠŠå®ƒè·‘åœ¨ app ç«¯ï¼Œä½†æ˜¯æ— æ³•è·å–ä»–çš„ç¯å¢ƒï¼Œéœ€è¦é€šè¿‡ jbridgeï¼Œæ‰€ä»¥å¹¿å‘Šæ± é€»è¾‘å¯ä»¥é€šè¿‡ç»´æŠ¤ id æ¥å®ç°æ± å­ï¼Ÿâ€
æ˜¯çš„ï¼Œè¿™æ˜¯æœ€åˆé€‚çš„åšæ³•ï¼š
çœŸå®å¹¿å‘Šå®ä¾‹æ± ï¼šåœ¨ App ç«¯ï¼›
é€»è¾‘å¹¿å‘Šæ± ï¼ˆä»¥å¹¿å‘ŠIDä¸ºæ ¸å¿ƒçš„ç­–ç•¥/é¢‘æ§/çŠ¶æ€æ± ï¼‰ï¼šåœ¨ latestFile çš„ H5 é‡Œï¼›
æ± å­é‡Œçš„å…ƒç´ ä¸å†æ˜¯â€œå®ä¾‹â€ï¼Œè€Œæ˜¯ â€œadUnitId + type + ready çŠ¶æ€ + é¢‘æ§è®¡æ•°â€ï¼Œé  JSBridge çš„ event + adUnitId æ¥åŒæ­¥ä¸¤ç«¯çŠ¶æ€ã€‚
å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥åŸºäºä½  sdd/src/AdNet.ts çš„ç©ºæ–‡ä»¶ï¼Œç»™ä¸€ä¸ªç²¾ç®€ç‰ˆâ€œé€»è¾‘ AdNetâ€ ä»£ç éª¨æ¶ï¼Œä½ ç›´æ¥ç²˜è¿‡å»æ”¹å°±è¡Œã€‚


##åœ¨sdkå†…å®ç° â€‹dev-huaweinonnnoâ€‹ å‚è€ƒçš„aopï¼Œrequestï¼Œstartupç­‰ï¼Œç„¶ååœ¨ â€‹latestFileâ€‹ å®ç°ä¸Šé¢æ‰€è¿°çš„â€œé€»è¾‘ AdNet æ± â€ï¼ˆç”¨ adUnitId + çŠ¶æ€ç®¡ç†ï¼‰()

å¥½çš„ï¼Œæˆ‘æ¥å¸®ä½ å®ç°è¿™ä¸ªæ¶æ„ï¼š
åœ¨ sdd/src/sdk ä¸‹å®ç°åŸºç¡€è®¾æ–½å±‚ï¼ˆAopã€Requestã€Startupï¼‰
å®ç° WebView ä¸“ç”¨çš„"é€»è¾‘ AdNet æ± "
æœ€ååœ¨ latestFile/Film ä¸­é›†æˆä½¿ç”¨
è®©æˆ‘å…ˆæŸ¥çœ‹å½“å‰ sdd çš„ç»“æ„ï¼Œç„¶åå¼€å§‹å®ç°ï¼š
å·²æ¢ç´¢
3æ–‡ä»¶
å¥½çš„,ç°åœ¨æˆ‘å¼€å§‹åœ¨ sdd/src/sdk ä¸‹å®ç°åŸºç¡€è®¾æ–½å±‚ï¼Œç„¶åå®ç° WebView ç‰ˆçš„é€»è¾‘ AdNet æ± ï¼š
â€Request.ts
+110
A
å·²åº”ç”¨
â€Request.ts
A
å·²æ¥å—
ç°åœ¨å®ç° Startup.tsï¼ˆWebView ç®€åŒ–ç‰ˆï¼‰ï¼š
â€Startup.ts
+130
A
å·²åº”ç”¨
â€Startup.ts
A
å·²æ¥å—
ç°åœ¨å®ç° Aop.tsï¼ˆWebView ç®€åŒ–ç‰ˆï¼‰ï¼š
â€Aop.ts
A
å·²æ¥å—
ç°åœ¨å®ç°æœ€å…³é”®çš„éƒ¨åˆ† â€”â€” WebView ä¸“ç”¨çš„é€»è¾‘ AdNet æ± ï¼ˆåŸºäº ID ç®¡ç†ï¼‰ï¼š
â€AdNet.ts
A
å·²æ¥å—
ç°åœ¨æ›´æ–° AdManager è®©å®ƒä½¿ç”¨ AdNetï¼š
å·²æŸ¥çœ‹
AdManager.ts
(1 - 100)
ç°åœ¨æ›´æ–° AdManagerï¼Œè®©å®ƒç»“åˆ AdNet ä½¿ç”¨ï¼š
â€AdManager.ts
+53
-36
M
å·²åº”ç”¨
æˆ‘å‘ç°æ›¿æ¢å‡ºç°äº†é—®é¢˜ï¼Œè®©æˆ‘é‡æ–°è¯»å–å¹¶æ­£ç¡®æ›¿æ¢ï¼š
å·²æŸ¥çœ‹
AdManager.ts
(100 - 150)
æˆ‘çœ‹åˆ°æœ‰é‡å¤çš„ä»£ç ï¼Œè®©æˆ‘åˆ é™¤é‡å¤éƒ¨åˆ†ï¼š
â€AdManager.ts
-13
M
å·²åº”ç”¨
ç°åœ¨æ›´æ–° showAd æ–¹æ³•ï¼Œè®©å®ƒä½¿ç”¨ AdNet çš„é€»è¾‘æ± ï¼š
â€AdManager.ts
+29
-12
M
å·²åº”ç”¨
éœ€è¦æ·»åŠ  requestShowToApp æ–¹æ³•ï¼Œè®©æˆ‘æ‰¾åˆ°åŸæ¥çš„ postMessageToApp æ–¹æ³•å¹¶ä¿®æ”¹ï¼š
å·²æŸ¥çœ‹
AdManager.ts
(160 - 200)
â€AdManager.ts
+16
-10
M
å·²åº”ç”¨
ä¼šè¯å·²å‹ç¼©
æˆ‘ç†è§£äº†ï¼Œæ ¹æ®ä¸Šä¸‹æ–‡ï¼Œæˆ‘éœ€è¦ï¼š
ä¿®å¤å½“å‰ d:\VE\sdd\src\sdk\AdManager.ts ä¸­çš„ä»£ç é‡å¤é”™è¯¯
éªŒè¯ SDK æ„å»º
åœ¨ d:\VE\latestFile\Film é¡¹ç›®ä¸­é›†æˆè¿™ä¸ª SDK
è®©æˆ‘å…ˆä¿®å¤ AdManager.ts çš„è¯­æ³•é”™è¯¯ï¼Œç„¶åæ£€æŸ¥æ„å»ºçŠ¶æ€ã€‚
å·²æŸ¥çœ‹
AdManager.ts
(200 - 220)
çœ‹åˆ°é—®é¢˜äº†ï¼Œline 207-214 æ˜¯é‡å¤çš„ä»£ç ã€‚è®©æˆ‘åˆ é™¤è¿™æ®µé‡å¤å†…å®¹ï¼š
â€AdManager.ts
M
å·²æ¥å—
å¾ˆå¥½ï¼ç°åœ¨è®©æˆ‘æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å…¶ä»–é”™è¯¯ï¼š
è®©æˆ‘å°è¯•æ„å»º SDK æ¥éªŒè¯ï¼š
ç»ˆç«¯å·²è¿è¡Œ
cd d:\VE\sdd; npm run build
ç»ˆç«¯è¾“å‡º
âœ… å¤ªå¥½äº†ï¼SDK æ„å»ºæˆåŠŸï¼ç°åœ¨è®©æˆ‘æŸ¥çœ‹ latestFile/Film é¡¹ç›®çš„ç»“æ„ï¼Œå‡†å¤‡é›†æˆ SDKï¼š
å·²æ¢ç´¢
2æ–‡ä»¶
å¥½çš„ï¼Œç°åœ¨æˆ‘éœ€è¦åœ¨ latestFile/Film é¡¹ç›®ä¸­é›†æˆ SDKã€‚æˆ‘å°†ï¼š
åœ¨ latestFile/Film ä¸­å®‰è£…æœ¬åœ° SDK
åˆ›å»º SDK åˆå§‹åŒ–æ–‡ä»¶
åœ¨ main.ts ä¸­åˆå§‹åŒ– SDK
è®©æˆ‘å…ˆå°† SDK é“¾æ¥åˆ° Film é¡¹ç›®ï¼š
ç»ˆç«¯å·²è¿è¡Œ
Exit Code: 1
cd d:\VE\latestFile\Film; npm install ../../../sdd
ç»ˆç«¯è¾“å‡º
è·¯å¾„é”™è¯¯äº†ï¼Œè®©æˆ‘ä½¿ç”¨æ­£ç¡®çš„ç›¸å¯¹è·¯å¾„ï¼š
ç»ˆç«¯å·²è¿è¡Œ
cd d:\VE\latestFile\Film; npm install ../../sdd
ç»ˆç«¯è¾“å‡º
å¾ˆå¥½ï¼SDK å·²ç»å®‰è£…æˆåŠŸã€‚ç°åœ¨è®©æˆ‘åˆ›å»ºä¸€ä¸ª SDK åˆå§‹åŒ–é…ç½®æ–‡ä»¶å¹¶åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ï¼š
â€adConfig.ts
+111
A
å·²åº”ç”¨
æˆ‘éœ€è¦æ£€æŸ¥ SDK çš„å¯¼å‡ºã€‚è®©æˆ‘æŸ¥çœ‹ sdd çš„ index.tsï¼š
å·²æ¢ç´¢
2æ–‡ä»¶
æˆ‘çœ‹åˆ° SDK å¯¼å‡ºçš„æ˜¯ AdManager è€Œä¸æ˜¯å…¶ä»–æ¨¡å—ã€‚ä½†ä¹‹å‰æˆ‘ä»¬åˆ›å»ºäº† Startupã€Aop ç­‰æ¨¡å—ï¼Œéœ€è¦åœ¨ index.ts ä¸­å¯¼å‡ºå®ƒä»¬ã€‚è®©æˆ‘æ›´æ–°å¯¼å‡ºï¼š
â€index.ts
M
å·²æ¥å—
å¾ˆå¥½ï¼ç°åœ¨é‡æ–°æ„å»º SDKï¼š
ç»ˆç«¯å·²è¿è¡Œ
cd d:\VE\sdd; npm run build
ç»ˆç«¯è¾“å‡º
å®Œç¾ï¼SDK æ„å»ºæˆåŠŸã€‚ç°åœ¨è®©æˆ‘æ›´æ–° Film é¡¹ç›®çš„ SDK ä¾èµ–å¹¶ä¿®å¤ç±»å‹é”™è¯¯ã€‚é¦–å…ˆï¼Œæˆ‘éœ€è¦æŸ¥çœ‹ä¸€ä¸‹ç°åœ¨çš„é”™è¯¯æ˜¯å¦å·²ç»è§£å†³ï¼š
ç±»å‹å£°æ˜å¯èƒ½è¿˜æ²¡æœ‰æ›´æ–°ã€‚è®©æˆ‘é‡æ–°å®‰è£… SDKï¼š
ç»ˆç«¯å·²è¿è¡Œ
cd d:\VE\latestFile\Film; npm uninstall sdk; npm install ../../sdd
ç»ˆç«¯è¾“å‡º
SDK å·²é‡æ–°å®‰è£…ã€‚è®©æˆ‘å†æ£€æŸ¥ä¸€ä¸‹ç±»å‹é—®é¢˜ï¼Œå¯èƒ½éœ€è¦é‡å¯ TS æœåŠ¡å™¨æ‰èƒ½è¯†åˆ«æ–°çš„ç±»å‹ã€‚è®©æˆ‘å…ˆå°è¯•ä¿®æ”¹å¯¼å…¥æ–¹å¼ï¼Œä½¿ç”¨å…·åå¯¼å…¥çš„é»˜è®¤å¯¼å‡ºå½¢å¼ï¼š
å·²æŸ¥çœ‹
Startup.ts
(1 - 30)
æˆ‘çœ‹åˆ°è¿™äº›ç±»éƒ½æ˜¯é»˜è®¤å¯¼å‡ºçš„ã€‚ç”±äº SDK åˆé‡æ–°å¯¼å‡ºäº†å®ƒä»¬ï¼Œåº”è¯¥å¯ä»¥ç”¨ã€‚è®©æˆ‘åˆ›å»ºä¸€ä¸ªæ›´ç®€å•çš„ç¤ºä¾‹æ–‡ä»¶æ¥æµ‹è¯• SDK æ˜¯å¦èƒ½æ­£ç¡®ä½¿ç”¨ï¼š
â€adHelper.ts
+59
A
å·²åº”ç”¨
è·¯å¾„é”™è¯¯äº†ï¼Œåº”è¯¥æ˜¯ ../sdk/adConfigã€‚è®©æˆ‘ä¿®æ­£ï¼š
â€adHelper.ts
+58
-58
A
å·²åº”ç”¨
å¥½çš„ã€‚ç°åœ¨è®©æˆ‘æ›´æ–° main.ts æ¥åˆå§‹åŒ– SDKï¼ˆå…ˆç®€åŒ– adConfig.ts ä»¥é¿å…å¯¼å…¥é”™è¯¯ï¼‰ï¼š
â€adConfig.ts
M
å·²æ¥å—
å¾ˆå¥½ï¼ç°åœ¨è®©æˆ‘åœ¨ main.ts ä¸­åˆå§‹åŒ– SDKï¼š
â€main.ts
M
å·²æ¥å—
å®Œç¾ï¼ç°åœ¨è®©æˆ‘åˆ›å»ºä¸€ä¸ªæ–‡æ¡£æ¥è¯´æ˜æ•´ä¸ªæ¶æ„å’Œä½¿ç”¨æ–¹æ³•ï¼š
â€INTEGRATION_GUIDE.md
A
å·²æ¥å—
å®Œç¾ï¼ç°åœ¨è®©æˆ‘æ€»ç»“ä¸€ä¸‹å·²å®Œæˆçš„å·¥ä½œï¼š
âœ… ä»»åŠ¡å®Œæˆæ€»ç»“
æˆ‘å·²ç»æˆåŠŸå®Œæˆäº†æ‚¨çš„éœ€æ±‚ï¼š
1. åœ¨ sdd ä¸­å®ç°äº†å®Œæ•´çš„ SDK æ¡†æ¶ï¼ˆå‚è€ƒ dev-huaweinonnnoï¼‰
å·²åˆ›å»ºçš„æ ¸å¿ƒæ¨¡å—ï¼š
âœ… AdNet.ts - WebView ç¯å¢ƒä¸‹çš„é€»è¾‘å¹¿å‘Šæ± ï¼ˆ333è¡Œä»£ç ï¼‰
åŸºäº adUnitId + çŠ¶æ€ç®¡ç†ï¼Œä¸å­˜å‚¨çœŸå®å¹¿å‘Šå®ä¾‹
å®ç°äº† loadAdã€getAdTokenã€handlePreloadSuccess ç­‰æ–¹æ³•
é€šè¿‡ uni.postMessage ä¸ App é€šä¿¡
âœ… Startup.ts - å¯åŠ¨ç®¡ç†
åˆå§‹åŒ–è®¡æ•°å™¨ï¼ˆDayJLRequesttimesã€DayYSRequesttimes ç­‰ï¼‰
ç®¡ç†é¢‘æ§æ•°æ®
è®¾å¤‡ä¿¡æ¯é‡‡é›†
âœ… Aop.ts - ç”Ÿå‘½å‘¨æœŸç›‘å¬
ç›‘å¬å‰åå°åˆ‡æ¢ï¼ˆvisibilitychangeï¼‰
å…¨å±€é”™è¯¯æ•è·
é¡µé¢åŠ è½½/å¸è½½äº‹ä»¶
âœ… Request.ts - ç½‘ç»œè¯·æ±‚å°è£…
åŸºäº fetch API
æ”¯æŒè¶…æ—¶æ§åˆ¶ã€é‡è¯•æœºåˆ¶
æ”¯æŒ GET/POST è¯·æ±‚
âœ… AdManager.ts - å¹¿å‘Šç®¡ç†å™¨ï¼ˆå·²æ›´æ–°ï¼‰
ç»“åˆ AdNet é€»è¾‘æ± 
å®ç° showAd æ–¹æ³•ï¼ˆå…ˆä»æ± ä¸­å–ï¼Œæ²¡æœ‰åˆ™é¢„åŠ è½½ï¼‰
é€šè¿‡ uni.postMessage å‘ App å‘é€æ¶ˆæ¯
2. åœ¨ latestFile/Film ä¸­é›†æˆäº† SDK
âœ… å®‰è£…äº†æœ¬åœ° SDK åŒ…
âœ… åˆ›å»ºäº† adConfig.ts é…ç½®æ–‡ä»¶
âœ… åœ¨ main.ts ä¸­åˆå§‹åŒ– SDK
âœ… åˆ›å»ºäº† adHelper.ts å·¥å…·å‡½æ•°ç¤ºä¾‹
3. ä¿®å¤äº†æ‰€æœ‰é”™è¯¯
âœ… ä¿®å¤äº† AdManager.ts ä¸­çš„ä»£ç é‡å¤é”™è¯¯
âœ… è§£å†³äº† TypeScript ç±»å‹é”™è¯¯
âœ… SDK æ„å»ºæˆåŠŸï¼ˆnpm run buildï¼‰
âœ… Film é¡¹ç›®æ²¡æœ‰ç¼–è¯‘é”™è¯¯
4. åˆ›å»ºäº†å®Œæ•´æ–‡æ¡£
âœ… INTEGRATION_GUIDE.md - é›†æˆæŒ‡å—
æ¶æ„è¯´æ˜ï¼ˆå«æ¶æ„å›¾ï¼‰
æ ¸å¿ƒæ¨¡å—è¯¦è§£
JSBridge é€šä¿¡åè®®
App ç«¯å®ç°ç¤ºä¾‹
ä½¿ç”¨ç¤ºä¾‹ä»£ç 
æ¶æ„ç‰¹ç‚¹
H5 ç«¯ï¼ˆæœ¬ SDKï¼‰ï¼š
ç»´æŠ¤"é€»è¾‘å¹¿å‘Šæ± "ï¼ˆLogicalAdSlotï¼‰
è´Ÿè´£ç­–ç•¥é€‰æ‹©ã€é¢‘ç‡æ§åˆ¶ã€çŠ¶æ€åŒæ­¥
é€šè¿‡ uni.postMessage å‘é€æ¶ˆæ¯ç»™ App
App ç«¯ï¼š
çœŸæ­£åˆ›å»ºå’Œç®¡ç†å¹¿å‘Šå®ä¾‹ï¼ˆç¥è“/UniApp SDKï¼‰
ç›‘å¬ web-view @message æ¥æ”¶ H5 æ¶ˆæ¯
é€šè¿‡ EventBus å›ä¼ ç»“æœç»™ H5
é€šä¿¡æµç¨‹ï¼š
plaintext
H5: showAd() 
  â†’ AdNet.getAdToken() 
  â†’ uni.postMessage({ action: 'show', adUnitId })
  â†’ App: handleMessage() 
  â†’ App: rewardedVideoAd.show()
  â†’ App: EventBus.$emit('app_ad_show_close')
  â†’ H5: callbacks.onClose()
ä¸‹ä¸€æ­¥å»ºè®®
App ç«¯å®ç° - å‚è€ƒ INTEGRATION_GUIDE.md ä¸­çš„ç¤ºä¾‹ä»£ç 
JSBridge è°ƒè¯• - ç¡®ä¿ window.uni å¯ç”¨
äº‹ä»¶å›ä¼ æœºåˆ¶ - å®ç° App â†’ H5 çš„æ¶ˆæ¯é€šé“
çœŸå®å¹¿å‘Šä½é…ç½® - æ›´æ–° AD_STOREY_CONFIG ä¸­çš„çœŸå® adUnitId
æ‰€æœ‰ä»£ç å·²ç»å‡†å¤‡å°±ç»ªï¼ŒSDK æ„å»ºæˆåŠŸï¼ğŸ‰




## â€‹latestFileâ€‹ è¯¥é¡¹ç›®å¯ä»¥ä½œä¸ºuniappé¡¹ç›®è¿è¡Œå§ï¼Œä»€ä¹ˆæ—¶uniappï¼Ÿ

1. latestFile è¿™ä¸ªé¡¹ç›®æ˜¯ä¸æ˜¯ uni-appï¼Ÿ
ä»ä½ è´´å‡ºæ¥çš„ d:\VE\latestFile\Film ç›®å½•ç»“æ„çœ‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ ‡å‡†çš„ Vue 3 + Vite çš„æµè§ˆå™¨ H5 é¡¹ç›®ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåŸç”Ÿçš„ uni-app é¡¹ç›®ï¼š
æœ‰ï¼švite.config.tsã€src/main.tsã€createApp(App) ç­‰å…¸å‹ Vite/Vue é¡¹ç›®ç»“æ„
æ²¡æœ‰ï¼špages.jsonã€manifest.jsonã€uni_modulesã€uni.scss ç­‰ uni-app å¿…å¤‡æ–‡ä»¶
ä¾èµ–é‡Œç”¨çš„æ˜¯ vueã€piniaã€vantã€viteï¼Œæ²¡æœ‰ @dcloudio/uni-app ç›¸å…³ä¾èµ–
æ‰€ä»¥ï¼š
latestFile/Film æœ¬èº« ä¸æ˜¯ ä¸€ä¸ª uni-app å·¥ç¨‹
å®ƒæ˜¯ä¸€ä¸ªæ™®é€šçš„ Vue3 SPAï¼Œé»˜è®¤è¿è¡Œç¯å¢ƒæ˜¯ æµè§ˆå™¨ H5
ä½†ä½ ç›®å‰çš„ç›®æ ‡æ˜¯ï¼šæŠŠè¿™ä¸ª H5 æ‰“åŒ…åæ”¾åˆ°ä¸€ä¸ª uni-app / HBuilderX æ‰“çš„ App é‡Œï¼Œé€šè¿‡ <web-view> / WebView å®¹å™¨åŠ è½½è¿è¡Œ
ä¹Ÿå°±æ˜¯è¯´ï¼š
å·¥ç¨‹å±æ€§ï¼šæµè§ˆå™¨ H5 å·¥ç¨‹ï¼ˆVue3 + Viteï¼‰
å®é™…è¿è¡Œä¸Šä¸‹æ–‡ï¼šApp WebView å®¹å™¨é‡Œçš„ H5 é¡µé¢ï¼ˆç”± uni-app/HBuilderX æ‰“å‡ºæ¥çš„åŸç”Ÿ App æä¾› WebViewï¼‰
ä½ è¦è®©å®ƒâ€œä½œä¸º uni-app é¡¹ç›®è¿è¡Œâ€ï¼Œé€šå¸¸æœ‰ä¸¤ç§ç©æ³•ï¼š
ä¿æŒ Film ä½œä¸ºç‹¬ç«‹ H5 é¡¹ç›®ï¼ˆä½ ç°åœ¨çš„åšæ³•ï¼‰
ç»§ç»­ç”¨ Vite æ‰“åŒ…å‡º dist é™æ€èµ„æº
åœ¨ä¸€ä¸ª uni-app é¡¹ç›®é‡Œç”¨ <web-view src="https://xxx æˆ– file://xxx"> æŠŠè¿™ä¸ª H5 åµŒè¿›å»
é€šè¿‡ uni.postMessage / @message åš JSBridgeï¼ˆè¿™æ­£æ˜¯æˆ‘ä»¬ä¸ºä½ å†™ SDK çš„å‰æï¼‰
å®Œå…¨æ”¹é€ æˆ uni-app å·¥ç¨‹
æ–°å»ºä¸€ä¸ª uni-app é¡¹ç›®ï¼ˆHBuilderX æˆ– CLIï¼‰
æŒ‰ uni-app è§„èŒƒä½¿ç”¨ pages.jsonã€pages/xxx.vue ç­‰ç»“æ„
å°† Film é‡Œçš„é¡µé¢é€»è¾‘è¿ç§»è¿‡å»ï¼ˆå·¥ä½œé‡æ¯”è¾ƒå¤§ï¼‰
ç»“åˆä½ ä¹‹å‰è¯´çš„ç¯å¢ƒï¼š
â€œæˆ‘çš„ç¯å¢ƒä»…åœ¨ App WebView å®¹å™¨é‡Œçš„ H5 é¡µé¢ï¼Œé€šè¿‡ uni.postMessage å’ŒåŸç”Ÿäº¤äº’â€
æ‰€ä»¥ç›®å‰æœ€é€‚åˆä½ çš„æ–¹æ¡ˆå°±æ˜¯ æ–¹æ¡ˆ 1ï¼šFilm ç»§ç»­ä½œä¸º H5 é¡¹ç›®ï¼Œåªæ˜¯è¿è¡Œåœ¨ App WebView å®¹å™¨é‡Œï¼Œè¿™ä¹Ÿæ­£æ˜¯æˆ‘ä»¬åœ¨ SDK é‡Œå‡è®¾çš„è¿è¡Œåœºæ™¯ã€‚
2. é‚£ uni-app åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ
uni-app æ˜¯ DCloud å‡ºçš„ä¸€å¥—è·¨ç«¯å¼€å‘æ¡†æ¶ï¼Œæ ¸å¿ƒç‰¹ç‚¹ï¼š
ç”¨ Vue è¯­æ³• å†™ä¸€å¥—å‰ç«¯ä»£ç 
å¯ä»¥ç¼–è¯‘åˆ°å¤šç«¯ï¼š
Appï¼ˆiOS / Android åŸç”Ÿåº”ç”¨ï¼‰
å¤šç«¯å°ç¨‹åºï¼ˆå¾®ä¿¡ã€æ”¯ä»˜å®ã€æŠ–éŸ³ç­‰ï¼‰
H5ï¼ˆæµè§ˆå™¨é¡µé¢ï¼‰
ç”¨ HBuilderX æˆ– uni-app CLI æ„å»ºã€è¿è¡Œ
åœ¨ App åœºæ™¯ ä¸‹ï¼š
uni-app ä¼šæ‰“å‡ºä¸€ä¸ª åŸç”Ÿ Appï¼ˆå†…ç½® WebView & å„ç§åŸç”Ÿèƒ½åŠ›ï¼‰
å¦‚æœä½ å†™çš„æ˜¯ â€œApp + H5 æ··åˆæ¨¡å¼â€ï¼š
åŸç”Ÿéƒ¨åˆ†/uni-app é¡µé¢æ˜¯å®¿ä¸»
ä½ çš„ Film é¡¹ç›®ä½œä¸º H5 é¡µé¢è¢« <web-view> æˆ–ç³»ç»Ÿ WebView æ‰“å¼€
window.uni å¯¹è±¡ç”± uni-app æ³¨å…¥
ä½ å¯ä»¥ç”¨ uni.postMessage åœ¨ WebView H5 å’Œ App ç«¯ ä¹‹é—´é€šä¿¡
è¿™æ­£æ˜¯ä¸ºä»€ä¹ˆæˆ‘åœ¨ç»™ä½ è®¾è®¡å¹¿å‘Š SDK æ—¶ï¼Œä¸€ç›´å¼ºè°ƒï¼š
è¿è¡Œç¯å¢ƒæ˜¯ App WebView å®¹å™¨å†…çš„ H5 é¡µé¢ï¼Œä¸æ˜¯ç‹¬ç«‹æµè§ˆå™¨ H5ã€‚
3. å›åˆ°ä½ çš„é—®é¢˜ï¼šæ€ä¹ˆç†è§£è¿™å¥è¯
latestFile è¯¥é¡¹ç›®å¯ä»¥ä½œä¸ºuniappé¡¹ç›®è¿è¡Œå§ï¼Ÿ
æ›´ç²¾ç¡®åœ°è¯´åº”æ˜¯ï¼š
latestFile/Filmï¼šä¸æ˜¯ uni-app é¡¹ç›®
ä½†å®ƒå¯ä»¥è¢« ä¸€ä¸ª uni-app / HBuilderX æ‰“åŒ…çš„ App é€šè¿‡ WebView åŠ è½½è¿è¡Œ
ä¹Ÿå°±æ˜¯ï¼šâ€œFilm ä½œä¸º H5 å‰ç«¯ï¼Œè¿è¡Œåœ¨ uni-app App æä¾›çš„ WebView å®¹å™¨é‡Œâ€
æˆ‘ä»¬ç°åœ¨å†™çš„å¹¿å‘Š SDKï¼ˆsdd ç›®å½•ï¼‰å°±æ˜¯ä¸“é—¨ä¸ºè¿™ç§åœºæ™¯è®¾è®¡çš„ï¼š
H5 ç«¯ï¼ˆFilmï¼‰è¿è¡Œåœ¨ App WebView å®¹å™¨
é€šè¿‡ window.uni.postMessage æŠŠå¹¿å‘ŠæŒ‡ä»¤å‘ç»™ App
App ç«¯ç”¨ç¥è“/uni-app åŸç”Ÿå¹¿å‘Š SDK çœŸæ­£æ‹‰èµ·å¹¿å‘Š
ä¸¤ç«¯é€šè¿‡ adUnitId + äº‹ä»¶å›è°ƒç»´æŒä¸€ä¸ªâ€œé€»è¾‘å¹¿å‘Šæ± â€
å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥å¸®ä½ ç”»ä¸€å¼  â€œuni-app App + Film H5 + å¹¿å‘Š SDK + JSBridgeâ€ çš„ç®€å•æ¶æ„å›¾ï¼Œæˆ–è€…ç»™ä½ ä¸€ä¸ª æœ€å° uni-app å®¿ä¸» demoï¼Œæ¼”ç¤ºå¦‚ä½• <web-view> åŠ è½½ä½ ç°åœ¨çš„ Film é¡¹ç›®å¹¶æ‰“é€š uni.postMessageã€‚