è¯·è§£é‡Šä»¥ä¸‹ä»£ç é—®é¢˜å¹¶è¿›è¡Œä¿®å¤ï¼š
``` assets/script/mainCanvas.ts
ç±»å‹â€œneverâ€ä¸Šä¸å­˜åœ¨å±æ€§â€œinstantiateâ€ã€‚ ts(2339)
```æˆ‘æ¥å¸®æ‚¨æŸ¥çœ‹å¹¶ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚é¦–å…ˆè®©æˆ‘è¯»å–è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ã€‚å·²æŸ¥çœ‹mainCanvas.tsæˆ‘æ‰¾åˆ°é—®é¢˜äº†ï¼åœ¨ç¬¬ 86 è¡Œï¼Œä»£ç ä½¿ç”¨äº† cc.instantiate()ï¼Œä½†æ˜¯åœ¨ Cocos Creator 3.x ç‰ˆæœ¬ä¸­ï¼Œå·²ç»ä¸å†ä½¿ç”¨å…¨å±€çš„ cc å¯¹è±¡äº†ã€‚é—®é¢˜åŸå› ï¼š
åœ¨ Cocos Creator 3.x ä¸­ï¼Œæ‰€æœ‰ API éƒ½éœ€è¦ä»ç›¸åº”çš„æ¨¡å—å¯¼å…¥ï¼Œè€Œä¸èƒ½ä½¿ç”¨å…¨å±€çš„ cc å‘½åç©ºé—´ã€‚ä»£ç ä¸­ç¬¬ 11 è¡Œå·²ç»æ­£ç¡®å¯¼å…¥äº†æ–°ç‰ˆæœ¬çš„æ¨¡å—ï¼Œä½†ç¬¬ 86 è¡Œå´ä½¿ç”¨äº†æ—§ç‰ˆæœ¬çš„ cc.instantiate()ã€‚è§£å†³æ–¹æ¡ˆï¼š
éœ€è¦ä» cc æ¨¡å—å¯¼å…¥ instantiate å‡½æ•°ï¼Œç„¶åç›´æ¥ä½¿ç”¨ instantiate()ã€‚è®©æˆ‘ä¸ºæ‚¨ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼šâ€mainCanvas.ts+3-3Må·²åº”ç”¨å®Œç¾ï¼é—®é¢˜å·²ç»ä¿®å¤ã€‚è®©æˆ‘ä¸ºæ‚¨æ€»ç»“ä¸€ä¸‹ï¼šé—®é¢˜è§£é‡Šä¸ä¿®å¤é—®é¢˜åŸå› ï¼š
åœ¨ç¬¬ 86 è¡Œä½¿ç”¨äº† cc.instantiate(this.adPrefab)ï¼Œè¿™æ˜¯ Cocos Creator 2.x çš„æ—§è¯­æ³•ã€‚åœ¨ Cocos Creator 3.x ä¸­ï¼Œcc ä½œä¸ºå…¨å±€å¯¹è±¡å·²è¢«åºŸå¼ƒï¼ŒTypeScript å°†å…¶ç±»å‹æ¨æ–­ä¸º neverï¼Œå› æ­¤æŠ¥é”™"ç±»å‹'never'ä¸Šä¸å­˜åœ¨å±æ€§'instantiate'"ã€‚ä¿®å¤å†…å®¹ï¼šâœ… åœ¨ç¬¬ 11 è¡Œçš„å¯¼å…¥è¯­å¥ä¸­æ·»åŠ äº† instantiate å‡½æ•°âœ… å°†ç¬¬ 86 è¡Œçš„ cc.instantiate() æ”¹ä¸ºç›´æ¥ä½¿ç”¨ instantiate()âœ… é¡ºä¾¿ä¿®å¤äº†ç¬¬ 89 è¡Œçš„ zIndex å±æ€§ä¸º setSiblingIndex() æ–¹æ³•ï¼ˆCocos Creator 3.x çš„æ–° APIï¼‰ç°åœ¨ä»£ç å·²ç»ç¬¦åˆ Cocos Creator 3.x çš„æ ‡å‡†ï¼ŒTypeScript ç¼–è¯‘é”™è¯¯å·²è§£å†³ï¼â€‹mainCanvas.ts 1-361â€‹ å¹¿å‘Šä¸ºä»€ä¹ˆæ²¡æœ‰å‘ˆç°åˆ°é¡µé¢ä¸Šï¼Œæ˜¯åœºæ™¯ä¸å¯¹å—â€‹mainCanvas.ts 1-361â€‹ å¹¿å‘Šä¸ºä»€ä¹ˆæ²¡æœ‰å‘ˆç°åˆ°é¡µé¢ä¸Šï¼Œæ˜¯åœºæ™¯ä¸å¯¹å—è®©æˆ‘åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆå¹¿å‘Šæ²¡æœ‰æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šã€‚æˆ‘éœ€è¦æ£€æŸ¥å‡ ä¸ªå…³é”®ç‚¹ï¼šå·²æ¢ç´¢1æ–‡ä»¶ 1æ£€ç´¢å·²æŸ¥çœ‹mainCanvas.ts(83 - 282)å·²æ£€ç´¢ä»“åº“adPrefab scene hierarchy parent node Canvas15 ä¸ªç»“æœæ ¹æ®ä»£ç åˆ†æï¼Œæˆ‘å‘ç°äº†å¹¿å‘Šæ— æ³•æ˜¾ç¤ºçš„å‡ ä¸ªå¯èƒ½åŸå› ï¼šé—®é¢˜åˆ†æé¢„åˆ¶ä½“ä½ç½®è®¾ç½®ä¸æ­£ç¡®ï¼šåœ¨ç¬¬ 86-88 è¡Œï¼Œä»£ç è®¾ç½®äº† setPosition(0, 0)ï¼Œä½†æ²¡æœ‰è®¾ç½® Z è½´åæ ‡ï¼Œå¯èƒ½å¯¼è‡´èŠ‚ç‚¹è¢«é®æŒ¡ã€‚çˆ¶èŠ‚ç‚¹é—®é¢˜ï¼šthis.node æ˜¯ mainCanvas ç»„ä»¶æ‰€åœ¨çš„èŠ‚ç‚¹ã€‚ä»å…¶ä»–å¹¿å‘Šä»£ç å¯ä»¥çœ‹åˆ°ï¼Œé€šå¸¸æ˜¯ç›´æ¥æ·»åŠ åˆ° find("Canvas") ä¸‹ï¼Œè€Œä¸æ˜¯å…¶ä»–èŠ‚ç‚¹ã€‚å±‚çº§é—®é¢˜ï¼šä½¿ç”¨ setSiblingIndex(100) å¯èƒ½ä¸å¤Ÿå¤§ï¼Œå…¶ä»–å¹¿å‘Šä»£ç ä½¿ç”¨äº† 9999ã€99999 ç­‰æ›´å¤§çš„å€¼ã€‚èŠ‚ç‚¹æ¿€æ´»çŠ¶æ€ï¼šæ²¡æœ‰æ˜¾å¼è®¾ç½® active = trueã€‚UITransform ç»„ä»¶ï¼šå¯èƒ½ç¼ºå°‘å¿…è¦çš„ UITransform ç»„ä»¶æˆ–å°ºå¯¸è®¾ç½®ã€‚è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹å¹¿å‘Šé¢„åˆ¶ä½“çš„å…·ä½“æƒ…å†µï¼šå·²æ¢ç´¢1æ£€ç´¢ 8ç›®å½•å·²æ£€ç´¢æ–‡ä»¶**/InitAd.prefab1 ä¸ªç»“æœå·²æŸ¥çœ‹ç›®å½•ui8 ä¸ªç»“æœç°åœ¨è®©æˆ‘ä¿®å¤ä»£ç ï¼Œå‚è€ƒå…¶ä»–å¹¿å‘Šä»£ç çš„æ­£ç¡®å®ç°æ–¹å¼ï¼šâ€mainCanvas.ts+11-4Må·²åº”ç”¨å®Œç¾ï¼æˆ‘å·²ç»ä¿®å¤äº†å¹¿å‘Šæ— æ³•æ˜¾ç¤ºçš„é—®é¢˜ã€‚è®©æˆ‘æ€»ç»“ä¸€ä¸‹ä¿®æ”¹å†…å®¹ï¼šé—®é¢˜åŸå› ä¸è§£å†³æ–¹æ¡ˆä¸»è¦é—®é¢˜ï¼šé”™è¯¯çš„çˆ¶èŠ‚ç‚¹ï¼šåŸä»£ç å°†å¹¿å‘Šæ·»åŠ åˆ° this.nodeï¼ˆmainCanvas ç»„ä»¶æ‰€åœ¨èŠ‚ç‚¹ï¼‰ï¼Œè€Œä¸æ˜¯ Canvas èŠ‚ç‚¹å±‚çº§ç´¢å¼•å¤ªå°ï¼šä½¿ç”¨ 100 å¯èƒ½ä¸å¤Ÿï¼Œè¢«å…¶ä»– UI å…ƒç´ é®æŒ¡ä½ç½®è®¾ç½®ä¸å®Œæ•´ï¼šåªè®¾ç½®äº† 2D ä½ç½® (x, y)ï¼Œæ²¡æœ‰è®¾ç½® z è½´æœªæ˜¾å¼æ¿€æ´»èŠ‚ç‚¹ï¼šå¯èƒ½èŠ‚ç‚¹é»˜è®¤æœªæ¿€æ´»ä¿®å¤å†…å®¹ï¼šâœ… ä½¿ç”¨ find("Canvas") æŸ¥æ‰¾ Canvas èŠ‚ç‚¹ï¼Œå°†å¹¿å‘Šç›´æ¥æ·»åŠ åˆ° Canvas ä¸‹ï¼ˆå‚è€ƒå…¶ä»–å¹¿å‘Šä»£ç çš„æ ‡å‡†åšæ³•ï¼‰âœ… è®¾ç½®å®Œæ•´çš„ 3D ä½ç½® setPosition(0, 0, 0)ï¼Œç¡®ä¿ z è½´ä¹Ÿè¢«æ­£ç¡®è®¾ç½®âœ… ä½¿ç”¨æ›´å¤§çš„å±‚çº§ç´¢å¼• setSiblingIndex(9999)ï¼Œç¡®ä¿åœ¨æ‰€æœ‰ UI å…ƒç´ ä¹‹ä¸Šâœ… æ˜¾å¼æ¿€æ´»èŠ‚ç‚¹ adNode.active = trueâœ… æ·»åŠ äº† Canvas èŠ‚ç‚¹æ£€æŸ¥ï¼Œå¦‚æœæ‰¾ä¸åˆ°ä¼šè¾“å‡ºé”™è¯¯æ—¥å¿—âœ… æ”¹è¿›æ—¥å¿—è¾“å‡ºï¼Œæ˜¾ç¤ºä½ç½®ä¿¡æ¯ä¾¿äºè°ƒè¯•è¿™æ ·ä¿®æ”¹åï¼Œå¹¿å‘Šé¢„åˆ¶ä½“ä¼šè¢«æ­£ç¡®æ·»åŠ åˆ° Canvas èŠ‚ç‚¹çš„æœ€ä¸Šå±‚ï¼Œåº”è¯¥å¯ä»¥æ­£å¸¸æ˜¾ç¤ºäº†ã€‚å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œå¯ä»¥æ£€æŸ¥ï¼šç¼–è¾‘å™¨ä¸­æ˜¯å¦æ­£ç¡®ç»‘å®šäº† adPrefabé¢„åˆ¶ä½“å†…éƒ¨çš„èŠ‚ç‚¹æ˜¯å¦éƒ½æ˜¯æ¿€æ´»çŠ¶æ€é¢„åˆ¶ä½“çš„ UITransform å°ºå¯¸è®¾ç½®æ˜¯å¦æ­£ç¡®æ ¹æ®è„šæœ¬åˆ¤æ–­ï¼Œä¸ºä»€ä¹ˆä¸æ˜¾ç¤ºï¼Ÿæ ¹æ®è„šæœ¬åˆ¤æ–­ï¼Œä¸ºä»€ä¹ˆä¸æ˜¾ç¤ºï¼Ÿè®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹å›¾ç‰‡ä¸­çš„åœºæ™¯ä¿¡æ¯ï¼Œå¹¶æ£€æŸ¥ä»£ç é€»è¾‘æ¥æ‰¾å‡ºé—®é¢˜ã€‚å·²æ¢ç´¢2æ–‡ä»¶å·²æŸ¥çœ‹dwfl3egq-90725d96.pngå·²æŸ¥çœ‹mainCanvas.ts(66 - 265)ä»å›¾ç‰‡å’Œä»£ç åˆ†æï¼Œæˆ‘å‘ç°äº†é—®é¢˜æ‰€åœ¨ï¼å…³é”®é—®é¢˜ï¼šmainCanvas ç»„ä»¶æŒ‚è½½çš„èŠ‚ç‚¹ä¸åœ¨ main åœºæ™¯ä¸­ï¼ä»å›¾ç‰‡å¯ä»¥çœ‹åˆ°ï¼šå·¦ä¾§å±‚çº§é¢æ¿æ˜¾ç¤ºçš„æ˜¯ main åœºæ™¯ï¼Œé‡Œé¢æœ‰ Canvas èŠ‚ç‚¹å’Œ NvAd-md èŠ‚ç‚¹è€Œ mainCanvas.ts è„šæœ¬æ˜¯åœ¨ login åœºæ™¯çš„ Canvas èŠ‚ç‚¹ä¸Šè¿è¡Œçš„ï¼ˆæ ¹æ®é¡¹ç›®ç»“æ„ï¼‰è®©æˆ‘æ£€æŸ¥ä¸€ä¸‹åœºæ™¯ä¿¡æ¯ï¼šå·²æ¢ç´¢2æ£€ç´¢å·²æ£€ç´¢ä»“åº“login scene Canvas mainCanvas component scene loading15 ä¸ªç»“æœå·²æ£€ç´¢ä»£ç director\.loadScene3 ä¸ªç»“æœéå¸¸å¥½ï¼æˆ‘æ‰¾åˆ°äº†æ ¹æœ¬é—®é¢˜ï¼æ ¹æ®ä»£ç å’Œæˆªå›¾åˆ†æï¼šé—®é¢˜æ ¹æºmainCanvas ç»„ä»¶åœ¨ main åœºæ™¯ä¸­ï¼Œä½† start() æ–¹æ³•åœ¨åœºæ™¯åˆ‡æ¢æ—¶æ‰§è¡Œï¼Œæ­¤æ—¶è°ƒç”¨ find("Canvas") æ˜¯æ­£ç¡®çš„ã€‚ä½†é—®é¢˜æ˜¯ï¼šå›¾ç‰‡æ˜¾ç¤ºçš„æ˜¯ç¼–è¾‘å™¨åœºæ™¯è§†å›¾ï¼Œä½ çœ‹åˆ°çš„ NvAd-md èŠ‚ç‚¹æ˜¯é™æ€é¢„åˆ¶çš„åœºæ™¯èŠ‚ç‚¹ï¼Œä¸æ˜¯è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºçš„å¹¿å‘Šä»£ç åœ¨ start() ä¸­æ‰§è¡Œï¼Œè¿™æ—¶ä¼šåˆ›å»ºå¹¿å‘ŠèŠ‚ç‚¹ï¼Œä½†ä½ éœ€è¦åœ¨è¿è¡Œæ—¶æŸ¥çœ‹ï¼Œè€Œä¸æ˜¯ç¼–è¾‘å™¨åœºæ™¯è§†å›¾ä½†æˆ‘æ³¨æ„åˆ°è¿˜æœ‰ä¸€ä¸ªæ½œåœ¨é—®é¢˜ï¼šfind("Canvas") åœ¨ start() ä¸­è°ƒç”¨æ—¶ï¼Œå½“å‰åœºæ™¯å°±æ˜¯ main åœºæ™¯ï¼Œåº”è¯¥èƒ½æ‰¾åˆ°ã€‚è®©æˆ‘æ£€æŸ¥æ˜¯å¦çœŸçš„æ‰¾åˆ°äº†Canvasï¼Œå¹¶æ·»åŠ æ›´è¯¦ç»†çš„è°ƒè¯•ï¼šâ€mainCanvas.ts+13-2Må·²åº”ç”¨æˆ‘éœ€è¦å¯¼å…¥ directorï¼Œè®©æˆ‘ä¿®å¤è¿™ä¸ªé”™è¯¯ï¼šå·²æŸ¥çœ‹mainCanvas.ts(1 - 200)â€mainCanvas.ts+2-2Må·²åº”ç”¨å¾ˆå¥½ï¼ç°åœ¨è®©æˆ‘æ€»ç»“ä¸€ä¸‹ä¸ºä»€ä¹ˆå¹¿å‘Šä¸æ˜¾ç¤ºï¼Œä»¥åŠå¦‚ä½•æ’æŸ¥ï¼šé—®é¢˜è¯Šæ–­æ€»ç»“æ ¹æ®ä»£ç å’Œæˆªå›¾åˆ†æï¼Œå¹¿å‘Šä¸æ˜¾ç¤ºçš„å¯èƒ½åŸå› ï¼š1. ç¼–è¾‘å™¨è§†å›¾ vs è¿è¡Œæ—¶è§†å›¾ğŸ“· æˆªå›¾æ˜¾ç¤ºçš„æ˜¯ç¼–è¾‘å™¨çš„åœºæ™¯è§†å›¾ï¼Œä¸æ˜¯è¿è¡Œæ—¶ä½ çœ‹åˆ°çš„ NvAd-md æ˜¯é™æ€åœºæ™¯èŠ‚ç‚¹ï¼Œä¸æ˜¯ä»£ç åŠ¨æ€åˆ›å»ºçš„å¹¿å‘Šéœ€è¦è¿è¡Œæ¸¸æˆæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—å’Œè¿è¡Œæ—¶å±‚çº§2. å¯èƒ½çš„å…·ä½“é—®é¢˜âœ… ç°åœ¨å·²ä¿®å¤çš„ä»£ç é—®é¢˜ï¼šæ·»åŠ äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—æ­£ç¡®å¯¼å…¥ Canvas èŠ‚ç‚¹è®¾ç½®å®Œæ•´çš„ä½ç½®å’Œå±‚çº§â“ éœ€è¦æ£€æŸ¥çš„é—®é¢˜ï¼šA. adPrefab æœªç»‘å®šåœ¨ç¼–è¾‘å™¨ä¸­ï¼Œæ‰¾åˆ° main åœºæ™¯çš„ Canvas èŠ‚ç‚¹æŸ¥çœ‹ mainCanvas ç»„ä»¶çš„ adPrefab å±æ€§æ˜¯å¦ç»‘å®šäº†é¢„åˆ¶ä½“B. é¢„åˆ¶ä½“å†…å®¹é—®é¢˜InitAd é¢„åˆ¶ä½“å†…éƒ¨èŠ‚ç‚¹å¯èƒ½é»˜è®¤æ˜¯éšè—çš„ï¼ˆactive = falseï¼‰UITransform å°ºå¯¸å¯èƒ½æ˜¯ 0C. å±‚çº§/æ¸²æŸ“é—®é¢˜å¯èƒ½è¢«å…¶ä»– UI é®æŒ¡Camera æ¸²æŸ“å±‚çº§è®¾ç½®é—®é¢˜3. æ’æŸ¥æ­¥éª¤è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼šè¿è¡Œæ¸¸æˆï¼ˆä¸æ˜¯æŸ¥çœ‹ç¼–è¾‘å™¨åœºæ™¯ï¼‰æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼Œåº”è¯¥ä¼šçœ‹åˆ°ï¼šplaintextGameMain5 start, å‡†å¤‡æ£€æŸ¥å¹¿å‘Šé¢„åˆ¶ä½“...
adPrefab å€¼: [object]
å¹¿å‘Šé¢„åˆ¶ä½“å­˜åœ¨ï¼Œå¼€å§‹å®ä¾‹åŒ–
å®ä¾‹åŒ–åçš„èŠ‚ç‚¹: [Node] name: InitAd
æŸ¥æ‰¾ Canvas èŠ‚ç‚¹ç»“æœ: [Node]
æ‰¾åˆ° Canvas èŠ‚ç‚¹ï¼Œå¼€å§‹æ·»åŠ å­èŠ‚ç‚¹...
å­èŠ‚ç‚¹æ·»åŠ æˆåŠŸ
å¹¿å‘Šé¢„åˆ¶ä½“å·²æ·»åŠ åˆ° Canvas èŠ‚ç‚¹: InitAd ä½ç½®: {...} active: true parent: Canvas
å¹¿å‘ŠèŠ‚ç‚¹çš„å­èŠ‚ç‚¹æ•°é‡: Xå¦‚æœçœ‹åˆ°"adPrefab å±æ€§æœªç»‘å®š"é”™è¯¯ï¼šåœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ main åœºæ™¯é€‰ä¸­ Canvas èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹ mainCanvas ç»„ä»¶å°† InitAd.prefab æ‹–åˆ° adPrefab å­—æ®µå¦‚æœèŠ‚ç‚¹æ·»åŠ æˆåŠŸä½†çœ‹ä¸åˆ°ï¼šæ£€æŸ¥è¿è¡Œæ—¶å±‚çº§é¢æ¿ï¼Œçœ‹ InitAd èŠ‚ç‚¹æ˜¯å¦åœ¨ Canvas ä¸‹æ£€æŸ¥ InitAd é¢„åˆ¶ä½“å†…éƒ¨çš„å­èŠ‚ç‚¹æ˜¯å¦éƒ½æ˜¯æ¿€æ´»çŠ¶æ€è¯·è¿è¡Œæ¸¸æˆå¹¶åˆ†äº«æ§åˆ¶å°æ—¥å¿—ï¼Œè¿™æ ·æˆ‘å¯ä»¥å¸®ä½ è¿›ä¸€æ­¥è¯Šæ–­ï¼æ˜¯ä¸æ˜¯æ²¡æœ‰ä½¿ç”¨ui2æ˜¯ä¸æ˜¯æ²¡æœ‰ä½¿ç”¨ui2å¯¹ï¼ä½ è¯´å¾—å¯¹ï¼UITransform çš„å°ºå¯¸æ˜¯ 400x500ï¼Œä½†è¿™ä¸ªèŠ‚ç‚¹æ²¡æœ‰ä½¿ç”¨ Widget ç»„ä»¶æ¥å¯¹é½å¸ƒå±€ï¼ä»å›¾ç‰‡å¯ä»¥çœ‹åˆ°ï¼šContentSize: 400 x 500ï¼ˆå°ºå¯¸æ­£å¸¸ï¼‰AnchorPoint: 0.5, 0.5ï¼ˆä¸­å¿ƒé”šç‚¹ï¼‰Position: 0, 0, 0ï¼ˆåœ¨ Canvas ä¸­å¿ƒï¼‰ä½†æ˜¯ç¼ºå°‘ Widget ç»„ä»¶è¿™æ„å‘³ç€å¹¿å‘ŠèŠ‚ç‚¹è™½ç„¶è¢«æ·»åŠ åˆ°äº† Canvasï¼Œä½†å®ƒçš„å®šä½æ–¹å¼å¯èƒ½ä¸ç¬¦åˆä½ çš„é¢„æœŸã€‚è®©æˆ‘æ£€æŸ¥ä¸€ä¸‹ä½ çš„å¸ƒå±€è§„èŒƒè®°å¿†ï¼šæ ¹æ®è®°å¿†ï¼Œä½ æœ‰å¹¿å‘Šå¸ƒå±€è§„èŒƒã€‚è®©æˆ‘æŸ¥çœ‹ InitAd é¢„åˆ¶ä½“æ˜¯å¦åº”è¯¥ä½¿ç”¨ Widgetï¼šå·²æ¢ç´¢1æ–‡ä»¶ 1æ£€ç´¢å·²æ£€ç´¢è®°å¿†å¹¿å‘Šä¸»å›¾å¸ƒå±€ é¡¶éƒ¨å¯¹é½ å®½åº¦400 Widget UIå¸ƒå±€3 ä¸ªç»“æœå·²æŸ¥çœ‹InitAd.prefab(1 - 200)æ˜¯ä¸æ˜¯æ²¡æœ‰layeræ²¡æœ‰ä½¿ç”¨ui_2dæ˜¯ä¸æ˜¯æ²¡æœ‰layeræ²¡æœ‰ä½¿ç”¨ui_2då®Œå…¨æ­£ç¡®ï¼ ä½ å‘ç°äº†å…³é”®é—®é¢˜ï¼ä»æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼šLayer: DEFAULTï¼ˆé»˜è®¤å±‚ï¼‰ä½†åœ¨ Cocos Creator 3.x ä¸­ï¼ŒUI å…ƒç´ åº”è¯¥ä½¿ç”¨ UI_2D å±‚ï¼Œè€Œä¸æ˜¯ DEFAULT å±‚ï¼é—®é¢˜åˆ†æDEFAULT å±‚ vs UI_2D å±‚çš„åŒºåˆ«ï¼šDEFAULT å±‚ï¼šç”¨äº 3D å¯¹è±¡å’Œä¸€èˆ¬èŠ‚ç‚¹UI_2D å±‚ï¼šä¸“é—¨ç”¨äº UI æ¸²æŸ“ï¼Œä¼šè¢« UI Camera æ¸²æŸ“å¦‚æœå¹¿å‘ŠèŠ‚ç‚¹åœ¨ DEFAULT å±‚ï¼Œè€Œ Canvas çš„ Camera åªæ¸²æŸ“ UI_2D å±‚ï¼Œé‚£ä¹ˆå¹¿å‘Šå°±ä¸ä¼šæ˜¾ç¤ºï¼è§£å†³æ–¹æ¡ˆéœ€è¦åœ¨ä»£ç ä¸­è®¾ç½®å¹¿å‘ŠèŠ‚ç‚¹çš„ Layer ä¸º UI_2Dã€‚è®©æˆ‘ä¿®å¤ä»£ç ï¼šâ€mainCanvas.ts+14-3Må·²åº”ç”¨å®Œç¾ï¼ç°åœ¨ä»£ç å·²ç»ä¿®å¤äº† Layer è®¾ç½®é—®é¢˜ã€‚è®©æˆ‘æ€»ç»“ä¸€ä¸‹ä¿®å¤å†…å®¹ï¼šâœ… å·²ä¿®å¤çš„é—®é¢˜1. Layer è®¾ç½®é”™è¯¯ï¼ˆæœ€å…³é”®ï¼ï¼‰âŒ åŸé—®é¢˜ï¼šå¹¿å‘ŠèŠ‚ç‚¹ä½¿ç”¨ DEFAULT å±‚âœ… å·²ä¿®å¤ï¼šè®¾ç½®ä¸º UI_2D å±‚ğŸ“ åŸå› ï¼šUI Camera åªæ¸²æŸ“ UI_2D å±‚çš„èŠ‚ç‚¹2. é€’å½’è®¾ç½®æ‰€æœ‰å­èŠ‚ç‚¹çš„ Layerä¸ä»…è®¾ç½®æ ¹èŠ‚ç‚¹çš„ Layerè¿˜é€’å½’è®¾ç½®æ‰€æœ‰å­èŠ‚ç‚¹çš„ Layerç¡®ä¿æ•´ä¸ªå¹¿å‘Šé¢„åˆ¶ä½“éƒ½åœ¨æ­£ç¡®çš„æ¸²æŸ“å±‚3. å¢å¼ºçš„è°ƒè¯•æ—¥å¿—è¾“å‡ºèŠ‚ç‚¹çš„ layer ä¿¡æ¯è¾“å‡ºå­èŠ‚ç‚¹çš„ layer ä¿¡æ¯ä¾¿äºæ’æŸ¥é—®é¢˜ä¿®å¤åŸç†typescript// è®¾ç½®èŠ‚ç‚¹ Layer
adNode.layer = Layers.Enum.UI_2D;

// é€’å½’è®¾ç½®æ‰€æœ‰å­èŠ‚ç‚¹
const setLayerRecursively = (node: Node) => {
    node.layer = Layers.Enum.UI_2D;
    node.children.forEach(child => setLayerRecursively(child));
};
setLayerRecursively(adNode);ç°åœ¨è¯·æµ‹è¯•è¿è¡Œæ¸¸æˆåï¼Œå¹¿å‘Šåº”è¯¥èƒ½æ­£å¸¸æ˜¾ç¤ºäº†ï¼æ§åˆ¶å°ä¼šè¾“å‡ºï¼šplaintextå·²è®¾ç½®å¹¿å‘ŠèŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹çš„ Layer ä¸º UI_2D
å¹¿å‘Šé¢„åˆ¶ä½“å·²æ·»åŠ åˆ° Canvas èŠ‚ç‚¹: InitAd ... layer: 1073741824Layer å€¼ 1073741824 å°±æ˜¯ UI_2D çš„æšä¸¾å€¼ã€‚å¦‚æœè¿˜æ˜¯ä¸æ˜¾ç¤ºï¼Œè¯·åˆ†äº«è¿è¡Œæ—¶çš„æ§åˆ¶å°æ—¥å¿—ï¼åŠ è½½çš„æ˜¯ui/2dä¿®æ”¹ä¸€ä¸‹åŠ è½½çš„æ˜¯ui/2dä¿®æ”¹ä¸€ä¸‹æˆ‘ç†è§£äº†ï¼ä½ æ˜¯è¯´é¢„åˆ¶ä½“è·¯å¾„åº”è¯¥æ˜¯ ui/InitAd è€Œä¸æ˜¯å…¶ä»–è·¯å¾„ã€‚è®©æˆ‘æ£€æŸ¥ä¸€ä¸‹å½“å‰çš„é¢„åˆ¶ä½“åŠ è½½ä½ç½®å’Œè·¯å¾„ï¼šå·²æ¢ç´¢1æ–‡ä»¶ 1æ£€ç´¢å·²æŸ¥çœ‹prefabload.tså·²æ£€ç´¢ä»£ç adPrefab|InitAd15 ä¸ªç»“æœæˆ‘çš„å¸ƒå±€å›¾æ˜¯2dçš„è¿œç¨‹æˆ‘çš„å¸ƒå±€å›¾æ˜¯2dçš„è¿œç¨‹æ˜ç™½äº†ï¼æˆ‘çœ‹åˆ°äº†ï¼šLayer å·²ç»æ˜¯ UI_2D âœ…ï¼ˆè¿™ä¸ªæ­£ç¡®ï¼‰ä½ç½®æ˜¯ (0, 125, 0) - Yè½´åç§»äº†125å°ºå¯¸æ˜¯ 400x250è¿™æ˜¯ä¸€ä¸ªè¿œç¨‹åŠ è½½çš„ 2D å›¾ç‰‡èŠ‚ç‚¹ï¼ˆimgï¼‰ã€‚ç°åœ¨æˆ‘ç†è§£ä½ çš„éœ€æ±‚äº† - ä½ æƒ³è¦åŠ¨æ€åŠ è½½è¿œç¨‹å›¾ç‰‡å¹¶æ˜¾ç¤ºä¸ºå¹¿å‘Šã€‚è®©æˆ‘çœ‹ä¸€ä¸‹ prefabload.ts ä¸­çš„å›¾ç‰‡åŠ è½½é€»è¾‘ï¼Œå¹¶ç¡®è®¤æ˜¯å¦éœ€è¦ä¿®æ”¹ mainCanvas çš„ä»£ç æ¥æ”¯æŒè¿œç¨‹å›¾ç‰‡åŠ è½½ï¼šå·²æŸ¥çœ‹InitAd.tsç°åœ¨æˆ‘æ˜ç™½äº†ï¼ä½ çš„å¹¿å‘Šç³»ç»ŸåŒ…å«ä¸¤éƒ¨åˆ†ï¼šInitAd é¢„åˆ¶ä½“ - ä¸€ä¸ªå¯¹è¯æ¡†å®¹å™¨è¿œç¨‹2Då›¾ç‰‡ - é€šè¿‡ prefabload.ts åŠ è½½è¿œç¨‹å›¾ç‰‡å¹¶å¡«å……åˆ° InitAd ä¸­ä»å›¾ç‰‡çœ‹ï¼Œè¿™ä¸ª img èŠ‚ç‚¹ï¼šLayer: UI_2D âœ…ä½ç½®: (0, 125, 0)å°ºå¯¸: 400x250é—®é¢˜æ˜¯ï¼šåœ¨ mainCanvas.ts ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥å®ä¾‹åŒ–äº† adPrefabï¼Œä½†æ²¡æœ‰è§¦å‘ InitAd çš„ show() æ–¹æ³•ï¼Œä¹Ÿæ²¡æœ‰è°ƒç”¨ AdCtl æ¥åˆ›å»ºå’Œæ˜¾ç¤ºå¹¿å‘Šå†…å®¹ï¼è®©æˆ‘ä¿®æ”¹ mainCanvas.tsï¼Œè®©å®ƒæ­£ç¡®åˆå§‹åŒ–å¹¿å‘Šï¼šå·²æŸ¥çœ‹mainCanvas.ts(83 - 282)æˆ‘å‘ç°ä»£ç ä¸­å·²ç»æœ‰å»¶è¿Ÿ5ç§’çš„Promiseäº†ã€‚ä½†æ˜¯é—®é¢˜åœ¨äºæ²¡æœ‰è°ƒç”¨ InitAd ç»„ä»¶æ¥åˆå§‹åŒ–å¹¿å‘Šå†…å®¹ã€‚è®©æˆ‘æ£€æŸ¥ä¸€ä¸‹ä½ æ˜¯å¦æƒ³è¦ï¼šä»…æ˜¾ç¤ºé™æ€é¢„åˆ¶ä½“ï¼Ÿè¿˜æ˜¯éœ€è¦åŠ è½½è¿œç¨‹å›¾ç‰‡æ•°æ®ï¼Ÿæ ¹æ® prefabload.ts çš„ä»£ç ï¼Œå®ƒä¼šä» window['NativeAdData'] è¯»å–å¹¿å‘Šæ•°æ®å¹¶åŠ è½½è¿œç¨‹å›¾ç‰‡ã€‚è®©æˆ‘ä¸ºä½ æä¾›ä¸€ä¸ªæ›´å®Œæ•´çš„è§£å†³æ–¹æ¡ˆ - åœ¨å®ä¾‹åŒ–åè°ƒç”¨ InitAd ç»„ä»¶ï¼šå·²æ¢ç´¢1å·¥å…·è°ƒç”¨â€mainCanvas.tså·²å–æ¶ˆè¿œç¨‹å›¾ç‰‡å°ºå¯¸ä¸ºä»€ä¹ˆè¶…è¿‡äº†è®¾ç½®çš„å°ºå¯¸ï¼Ÿè¿œç¨‹å›¾ç‰‡å°ºå¯¸ä¸ºä»€ä¹ˆè¶…è¿‡äº†è®¾ç½®çš„å°ºå¯¸ï¼Ÿæˆ‘çœ‹åˆ°é—®é¢˜äº†ï¼SizeMode è®¾ç½®ä¸º TRIMMEDï¼ˆè£å‰ªæ¨¡å¼ï¼‰ï¼Œè¿™ä¼šå¯¼è‡´ Sprite æ ¹æ®å›¾ç‰‡çš„å®é™…å†…å®¹è‡ªåŠ¨è°ƒæ•´å°ºå¯¸ï¼Œè€Œä¸æ˜¯éµå¾ª ContentSize çš„è®¾ç½®ã€‚é—®é¢˜åŸå› å½“ SizeMode = TRIMMED æ—¶ï¼šSprite ä¼šä½¿ç”¨å›¾ç‰‡çš„åŸå§‹å°ºå¯¸å¿½ç•¥ UITransform çš„ ContentSize è®¾ç½®å›¾ç‰‡æœ‰å¤šå¤§å°±æ˜¾ç¤ºå¤šå¤§ï¼ˆé™¤é Trim è¢«å‹¾é€‰ä¸”å›¾ç‰‡æœ‰é€æ˜è¾¹ç¼˜ï¼‰è§£å†³æ–¹æ¡ˆéœ€è¦å°† SizeMode æ”¹ä¸º CUSTOMï¼Œè¿™æ ·æ‰ä¼šä½¿ç”¨ ContentSize (400x250) æ¥é™åˆ¶å›¾ç‰‡å°ºå¯¸ã€‚è®©æˆ‘ä¿®æ”¹ prefabload.ts ä¸­çš„å›¾ç‰‡åŠ è½½é€»è¾‘ï¼Œåœ¨è®¾ç½® SpriteFrame æ—¶å¼ºåˆ¶ä½¿ç”¨ CUSTOM æ¨¡å¼ï¼šâ€prefabload.ts+5-1Må·²åº”ç”¨å®Œç¾ï¼ç°åœ¨ä»£ç å·²ç»ä¿®å¤äº†ã€‚è®©æˆ‘æ€»ç»“ä¸€ä¸‹ï¼šâœ… é—®é¢˜è§£å†³é—®é¢˜åŸå› SizeMode: TRIMMED å¯¼è‡´å›¾ç‰‡ä½¿ç”¨åŸå§‹å°ºå¯¸ï¼Œå¿½ç•¥ ContentSize (400x250) çš„é™åˆ¶è¿œç¨‹åŠ è½½çš„å›¾ç‰‡ä¼šæŒ‰åŸå§‹å°ºå¯¸æ˜¾ç¤ºï¼Œè¶…å‡ºè®¾å®šèŒƒå›´ä¿®å¤æ–¹æ¡ˆåœ¨ prefabload.ts çš„ loadImg æ–¹æ³•ä¸­ï¼šâœ… å¯¼å…¥ Sprite ç±»å‹ï¼ˆå·²ç»åœ¨ä»£ç ä¸­ï¼‰âœ… è®¾ç½® this[key].sizeMode = Sprite.SizeMode.CUSTOMâœ… æ·»åŠ è°ƒè¯•æ—¥å¿—Sprite.SizeMode è¯´æ˜ æ¨¡å¼  è¯´æ˜  å°ºå¯¸æ¥æº  TRIMMED  è£å‰ªæ¨¡å¼  å›¾ç‰‡åŸå§‹å°ºå¯¸ï¼ˆå¿½ç•¥ ContentSizeï¼‰  RAW  åŸå§‹æ¨¡å¼  å›¾ç‰‡å®Œæ•´å°ºå¯¸  CUSTOM  è‡ªå®šä¹‰æ¨¡å¼  ä½¿ç”¨ UITransform.ContentSize âœ… ç°åœ¨çš„æ•ˆæœè¿è¡Œæ¸¸æˆåï¼šè¿œç¨‹å›¾ç‰‡ä¼šè¢«ç¼©æ”¾åˆ° 400x250 çš„å°ºå¯¸ä¸ä¼šè¶…å‡ºè®¾å®šçš„ ContentSizeæ§åˆ¶å°ä¼šè¾“å‡ºï¼šå·²åŠ è½½å›¾ç‰‡ MD_ad_img, SizeMode: CUSTOMå»ºè®®å¦‚æœéœ€è¦ä¿æŒå›¾ç‰‡å®½é«˜æ¯”ï¼Œå¯ä»¥è€ƒè™‘ï¼šä½¿ç”¨ Widget ç»„ä»¶æ¥å±…ä¸­å’Œçº¦æŸæˆ–è€…åœ¨é¢„åˆ¶ä½“ä¸­ç›´æ¥å°† SizeMode è®¾ç½®ä¸º CUSTOMï¼ˆè¿™æ ·ä»£ç ä¸­å°±ä¸éœ€è¦å†è®¾ç½®äº†ï¼‰ç°åœ¨æµ‹è¯•ä¸€ä¸‹ï¼Œå›¾ç‰‡åº”è¯¥ä¼šæ­£ç¡®æ˜¾ç¤ºåœ¨ 400x250 çš„åŒºåŸŸå†…äº†ï¼å­—ä½“è¿™æ€ä¹ˆè®¾ç½®å·¦è¾¹ä½ç½®å›ºå®šï¼Œå‘å³è¾¹æ‰©å¤§ï¼Ÿå­—ä½“è¿™æ€ä¹ˆè®¾ç½®å·¦è¾¹ä½ç½®å›ºå®šï¼Œå‘å³è¾¹æ‰©å¤§ï¼Ÿçœ‹å›¾ç‰‡ï¼Œä½ éœ€è¦è®©æ–‡æœ¬ä»å·¦è¾¹å›ºå®šä½ç½®å¼€å§‹ï¼Œå‘å³æ‰©å±•ã€‚è¿™éœ€è¦ä¿®æ”¹ AnchorPointï¼ˆé”šç‚¹ï¼‰ã€‚è§£å†³æ–¹æ¡ˆå½“å‰è®¾ç½®ï¼šAnchorPoint: (0.5, 0.5) - ä¸­å¿ƒé”šç‚¹Position: (45, -110, 0)è¿™ä¼šå¯¼è‡´æ–‡æœ¬ä»¥ä¸­å¿ƒç‚¹å®šä½ï¼Œæ–‡å­—å˜é•¿æ—¶ä¼šå‘ä¸¤è¾¹æ‰©å±•ã€‚ä¿®æ”¹ä¸ºå·¦å¯¹é½æ‰©å±•ï¼šéœ€è¦å°† AnchorPoint X æ”¹ä¸º 0ï¼ˆå·¦è¾¹é”šç‚¹ï¼‰ï¼Œè¿™æ ·ï¼šå·¦è¾¹ä½ç½®å›ºå®šåœ¨ X=45æ–‡å­—å‘å³æ‰©å±•å…·ä½“è®¾ç½®ï¼šplaintextAnchorPoint: (0, 0.5)  â† Xæ”¹ä¸º0ï¼ŒYä¿æŒ0.5ï¼ˆå‚ç›´å±…ä¸­ï¼‰è¿™æ ·æ–‡æœ¬å°±ä¼šï¼šâœ… å·¦è¾¹å›ºå®šåœ¨ X=45 çš„ä½ç½®âœ… éšç€æ–‡å­—å¢å¤šå‘å³æ‰©å±•âœ… å‚ç›´æ–¹å‘ä¿æŒå±…ä¸­HorizontalAlign ä¹Ÿè¦è®¾ç½®ä»å›¾ç‰‡çœ‹åˆ° HorizontalAlign æ˜¯å±…ä¸­å¯¹é½ï¼ˆä¸­é—´æŒ‰é’®è¢«é€‰ä¸­ï¼‰ã€‚å¦‚æœæƒ³è¦æ–‡å­—å·¦å¯¹é½ï¼Œè¿˜éœ€è¦ï¼šç‚¹å‡» HorizontalAlign çš„å·¦è¾¹æŒ‰é’®ï¼ˆå·¦å¯¹é½ï¼‰è¿™æ ·æ–‡å­—ä¼šä»å·¦è¾¹å¼€å§‹æ’åˆ—å®Œæ•´é…ç½®plaintextAnchorPoint: X=0, Y=0.5
HorizontalAlign: LEFT (å·¦å¯¹é½æŒ‰é’®)
Position: X=45 (å·¦è¾¹ç•Œä½ç½®)è¿™æ ·æ–‡æœ¬å°±ä¼šå®Œç¾åœ°ä»å·¦è¾¹å›ºå®šä½ç½®å‘å³æ‰©å±•äº†ï¼â€‹prefabload.ts 91-104â€‹ switchç”¨æ³•æ²¡é—®é¢˜å§ï¼Œä»‹ç»ä¸€ä¸‹switchcacsâ€‹prefabload.ts 91-104â€‹ switchç”¨æ³•æ²¡é—®é¢˜å§ï¼Œä»‹ç»ä¸€ä¸‹switchcacsä½ çš„ switch ç”¨æ³•æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼è®©æˆ‘è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼šå½“å‰ä»£ç çš„é—®é¢˜typescriptgoWeb(type: any) {
    if (this.adData && this.adData.appDetailUrl)
        switch (type) {
            case 1:
                window.qg.openDeeplink({ uri: this.adData.appDetailUrl })
                break;
            case 2:
                window.qg.openDeeplink({ uri: this.adData.permissionUrl })
                break;
            case 3:
                window.qg.openDeeplink({ uri: this.adData.privacyUrl })
                break;
        }
}é—®é¢˜åˆ†æï¼šæ¡ä»¶åˆ¤æ–­ä¸å®Œæ•´ï¼šif (this.adData && this.adData.appDetailUrl) åªæ£€æŸ¥äº† appDetailUrlä½† case 2 å’Œ case 3 ä½¿ç”¨çš„æ˜¯ permissionUrl å’Œ privacyUrlå¦‚æœè¿™ä¸¤ä¸ªå±æ€§ä¸å­˜åœ¨ï¼Œä¼šä¼ é€’ undefined ç»™ openDeeplinkSwitch è¯­æ³•è¯¦è§£åŸºæœ¬ç»“æ„ï¼štypescriptswitch (è¡¨è¾¾å¼) {
    case å€¼1:
        // ä»£ç å—1
        break;  // ä¸­æ–­ï¼Œè·³å‡º switch
    case å€¼2:
        // ä»£ç å—2
        break;
    case å€¼3:
        // ä»£ç å—3
        break;
    default:  // å¯é€‰ï¼šå½“æ‰€æœ‰ case éƒ½ä¸åŒ¹é…æ—¶æ‰§è¡Œ
        // é»˜è®¤ä»£ç å—
        break;
}å…³é”®ç‚¹ï¼šbreak å¾ˆé‡è¦ï¼šå¦‚æœä¸å†™ breakï¼Œä¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª caseï¼ˆç§°ä¸º"fall-through"ï¼‰è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„é™·é˜±ï¼default åˆ†æ”¯ï¼šå¯é€‰çš„ï¼Œç”¨äºå¤„ç†æœªåŒ¹é…çš„æƒ…å†µæ¨èåŠ ä¸Šï¼Œæé«˜ä»£ç å¥å£®æ€§æ”¹è¿›å»ºè®®typescriptgoWeb(type: number) {  // æ”¹ç”¨ number ç±»å‹æ›´æ˜ç¡®
    if (!this.adData) {
        console.error("å¹¿å‘Šæ•°æ®ä¸å­˜åœ¨");
        return;
    }

    let uri: string | undefined;
    
    switch (type) {
        case 1:
            uri = this.adData.appDetailUrl;
            break;
        case 2:
            uri = this.adData.permissionUrl;
            break;
        case 3:
            uri = this.adData.privacyUrl;
            break;
        default:
            console.error(`æœªçŸ¥çš„é“¾æ¥ç±»å‹: ${type}`);
            return;
    }

    if (uri) {
        window.qg.openDeeplink({ uri });
    } else {
        console.error(`é“¾æ¥åœ°å€ä¸å­˜åœ¨ï¼Œç±»å‹: ${type}`);
    }
}æ”¹è¿›ç‚¹ï¼šâœ… ç±»å‹å£°æ˜ï¼štype: number æ›´æ˜ç¡®âœ… ç»Ÿä¸€æ£€æŸ¥ï¼šå…ˆæ£€æŸ¥ this.adDataï¼Œå†æ£€æŸ¥å…·ä½“çš„ uriâœ… default åˆ†æ”¯ï¼šå¤„ç†æœªçŸ¥ç±»å‹âœ… å®‰å…¨è°ƒç”¨ï¼šç¡®ä¿ uri å­˜åœ¨æ‰è°ƒç”¨ openDeeplinkâœ… é”™è¯¯æ—¥å¿—ï¼šä¾¿äºè°ƒè¯•Switch çš„ Fall-Through ç¤ºä¾‹typescript// å±é™©ç¤ºä¾‹ï¼šæ²¡æœ‰ break
switch (type) {
    case 1:
        console.log("case 1");
        // æ²¡æœ‰ breakï¼ä¼šç»§ç»­æ‰§è¡Œ case 2
    case 2:
        console.log("case 2");
        // æ²¡æœ‰ breakï¼ä¼šç»§ç»­æ‰§è¡Œ case 3
    case 3:
        console.log("case 3");
}

// å¦‚æœ type = 1ï¼Œä¼šè¾“å‡ºï¼š
// case 1
// case 2
// case 3å®ç”¨åœºæ™¯ï¼šå¤šä¸ª case å…±äº«ä»£ç typescriptswitch (type) {
    case 1:
    case 2:
    case 3:
        // 1ã€2ã€3 éƒ½æ‰§è¡Œè¿™é‡Œ
        console.log("1-3 éƒ½ä¼šæ‰§è¡Œ");
        break;
    case 4:
    case 5:
        // 4ã€5 æ‰§è¡Œè¿™é‡Œ
        console.log("4-5 æ‰§è¡Œ");
        break;
    default:
        console.log("å…¶ä»–");
}ä½ çš„ä»£ç é€»è¾‘æ˜¯å¯¹çš„ï¼Œåªæ˜¯å»ºè®®åŠ ä¸Šæ›´å®Œå–„çš„é”™è¯¯å¤„ç†å’Œç±»å‹æ£€æŸ¥ï¼ä¸ºä»€ä¹ˆæ§åˆ¶å°æ‰“å°å‡ºæ¥çš„æ˜¯nanï¼Ÿä¸ºä»€ä¹ˆæ§åˆ¶å°æ‰“å°å‡ºæ¥çš„æ˜¯nanï¼Ÿçœ‹å›¾ç‰‡ï¼é—®é¢˜æ‰¾åˆ°äº†ï¼é—®é¢˜åŸå› ä½ ä¼ å…¥çš„å‚æ•°æ˜¯ "1"ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œè€Œ Number("1") åº”è¯¥èƒ½æ­£ç¡®è½¬æ¢ä¸ºæ•°å­— 1ã€‚ä½†æ˜¯ï¼Œä»å›¾ç‰‡çœ‹åˆ° CustomEventData çš„å€¼æ˜¯ "1"ï¼Œè¿™è¯´æ˜äº‹ä»¶ä¼ é€’çš„æ•°æ®æœ¬èº«å¯èƒ½æœ‰é—®é¢˜ã€‚è®©æˆ‘åˆ†æä¸€ä¸‹å¯èƒ½çš„åŸå› ï¼š1. ä¼ å…¥çš„ä¸æ˜¯å­—ç¬¦ä¸² "1"ï¼Œè€Œæ˜¯å…¶ä»–ä¸å¯è½¬æ¢çš„å€¼Number(type) è¿”å› NaN è¯´æ˜ type çš„å€¼æ— æ³•è½¬æ¢ä¸ºæ•°å­—ã€‚å¯èƒ½çš„æƒ…å†µï¼štypescriptNumber("1")      // âœ… 1
Number(1)        // âœ… 1
Number("abc")    // âŒ NaN
Number(undefined) // âŒ NaN
Number(null)     // âœ… 0
Number("")       // âœ… 0
Number("  ")     // âœ… 0
Number({})       // âŒ NaN
Number([])       // âœ… 0
Number([1])      // âœ… 12. æ£€æŸ¥ä¼ å…¥çš„åŸå§‹å€¼åœ¨è½¬æ¢ä¹‹å‰å…ˆæ‰“å°åŸå§‹å€¼ï¼štypescriptgoWeb(type: any) {
    if (!this.adData) return;
    
    console.log("åŸå§‹ type:", type, "ç±»å‹:", typeof type);
    console.log("type çš„å€¼:", JSON.stringify(type));
    
    type = Number(type);
    console.log("è½¬æ¢å type:", type);
    
    // ... åç»­ä»£ç 
}3. å¯èƒ½æ˜¯äº‹ä»¶ç»‘å®šçš„é—®é¢˜ä»å›¾ç‰‡çœ‹ï¼Œè¿™æ˜¯åœ¨ Cocos Creator ç¼–è¾‘å™¨ä¸­ç»‘å®šçš„äº‹ä»¶ã€‚æ£€æŸ¥ä¸€ä¸‹ï¼šCustomEventData å­—æ®µä¸­å¡«çš„æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å¦å¤šäº†ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦ï¼Ÿå°è¯•æ”¹ç”¨æ•°å­— 1 è€Œä¸æ˜¯å­—ç¬¦ä¸² "1"è°ƒè¯•å»ºè®®æ–¹æ³• 1ï¼šè¯¦ç»†æ—¥å¿—typescriptgoWeb(type: any) {
    if (!this.adData) return;
    
    console.log("====== è°ƒè¯•ä¿¡æ¯ ======");
    console.log("type åŸå§‹å€¼:", type);
    console.log("type ç±»å‹:", typeof type);
    console.log("type é•¿åº¦:", type?.length);
    console.log("type charCode:", type?.charCodeAt?.(0));
    console.log("JSON:", JSON.stringify(type));
    
    const numType = Number(type);
    console.log("è½¬æ¢ç»“æœ:", numType);
    console.log("æ˜¯å¦ NaN:", isNaN(numType));
    
    if (isNaN(numType)) {
        console.error("âŒ type è½¬æ¢å¤±è´¥ï¼Œæ— æ³•è½¬ä¸ºæ•°å­—");
        return;
    }
    
    switch (numType) {
        // ...
    }
}æ–¹æ³• 2ï¼šä½¿ç”¨ parseInttypescripttype = parseInt(type, 10);  // 10 æ˜¯åŸºæ•°ï¼Œè¡¨ç¤ºåè¿›åˆ¶æ–¹æ³• 3ï¼šç±»å‹ä¿æŠ¤typescriptgoWeb(type: any) {
    if (!this.adData) return;
    
    // æ¸…ç†å¹¶è½¬æ¢
    let numType: number;
    if (typeof type === 'number') {
        numType = type;
    } else if (typeof type === 'string') {
        numType = parseInt(type.trim(), 10);  // å»é™¤ç©ºæ ¼
    } else {
        console.error("æ— æ•ˆçš„ type å‚æ•°:", type);
        return;
    }
    
    if (isNaN(numType)) {
        console.error("type è½¬æ¢ä¸º NaN:", type);
        return;
    }
    
    console.log("æœ€ç»ˆ type:", numType);
    
    switch (numType) {
        // ...
    }
}å¿«é€Ÿæ’æŸ¥åœ¨ç¼–è¾‘å™¨ä¸­ï¼Œæ£€æŸ¥ CustomEventData æ˜¯å¦çœŸçš„æ˜¯ 1ï¼Œæœ‰æ²¡æœ‰çœ‹ä¸è§çš„ç©ºæ ¼æˆ–æ¢è¡Œæ¸…ç©º CustomEventDataï¼Œé‡æ–°è¾“å…¥ 1æˆ–è€…ç›´æ¥å¡«æ•°å­— 1 è€Œä¸æ˜¯å­—ç¬¦ä¸² "1"å…ˆåŠ ä¸Šè¯¦ç»†æ—¥å¿—çœ‹çœ‹ type åˆ°åº•æ˜¯ä»€ä¹ˆå€¼ï¼Œç„¶åæˆ‘ä»¬å†è¿›ä¸€æ­¥è§£å†³ï¼console.log(JSON.stringify(event))      ä¸ºä»€ä¹ˆä½¿ç”¨äº†è¿™ä¸ªå°±ä¸æ‰“å°åé¢çš„æ•°æ®ï¼Ÿconsole.log(JSON.stringify(event))      ä¸ºä»€ä¹ˆä½¿ç”¨äº†è¿™ä¸ªå°±ä¸æ‰“å°åé¢çš„æ•°æ®ï¼ŸJSON.stringify(event) å‡ºé”™å¯¼è‡´åç»­ä»£ç æ— æ³•æ‰§è¡Œï¼é—®é¢˜åŸå› Cocos Creator çš„ Event å¯¹è±¡åŒ…å«å¾ªç¯å¼•ç”¨ï¼ŒJSON.stringify() æ— æ³•åºåˆ—åŒ–å¾ªç¯å¼•ç”¨çš„å¯¹è±¡ï¼Œä¼šæŠ›å‡ºé”™è¯¯ï¼šplaintextTypeError: Converting circular structure to JSONè¿™ä¸ªé”™è¯¯ä¼šä¸­æ–­å‡½æ•°æ‰§è¡Œï¼Œæ‰€ä»¥åé¢çš„ console.log éƒ½ä¸ä¼šæ‰§è¡Œã€‚Event å¯¹è±¡çš„ç‰¹ç‚¹Cocos Creator çš„äº‹ä»¶å¯¹è±¡åŒ…å«ï¼štarget (äº‹ä»¶ç›®æ ‡èŠ‚ç‚¹)currentTarget (å½“å‰å¤„ç†èŠ‚ç‚¹)è¿™äº›èŠ‚ç‚¹åˆåŒ…å«çˆ¶èŠ‚ç‚¹ã€å­èŠ‚ç‚¹ç­‰ï¼Œå½¢æˆå¾ªç¯å¼•ç”¨è§£å†³æ–¹æ¡ˆæ–¹æ³• 1ï¼šåªæ‰“å°éœ€è¦çš„å±æ€§ï¼ˆæ¨èï¼‰typescriptgoWeb(event: any) {
    console.log("====== Event ä¿¡æ¯ ======");
    console.log("äº‹ä»¶ç±»å‹:", event.type);
    console.log("CustomEventData:", event.detail);
    console.log("target:", event.target?.name);
    console.log("currentTarget:", event.currentTarget?.name);
    
    const dataStr = event.detail; 
    console.log("åŸå§‹æ•°æ®:", dataStr);
    
    const dataNum = Number(dataStr); 
    console.log("è½¬æ¢åæ•°å­—:", dataNum);
    
    if (isNaN(dataNum)) {
        console.error("âŒ è½¬æ¢å¤±è´¥ï¼ŒdataStr:", dataStr);
        return;
    }
    
    switch (dataNum) {
        // ...
    }
}æ–¹æ³• 2ï¼šä½¿ç”¨ try-catch æ•è·é”™è¯¯typescriptgoWeb(event: any) {
    // å°è¯•åºåˆ—åŒ–ï¼Œä½†ä¸ä¸­æ–­æ‰§è¡Œ
    try {
        console.log("Event JSON:", JSON.stringify(event));
    } catch (e) {
        console.log("Event æ— æ³•åºåˆ—åŒ–ï¼ˆæ­£å¸¸ï¼ŒåŒ…å«å¾ªç¯å¼•ç”¨ï¼‰");
        console.log("Event å¯¹è±¡:", event);
    }
    
    const dataStr = event.detail; 
    console.log("åŸå§‹æ•°æ®:", dataStr);
    // ...
}æ–¹æ³• 3ï¼šè‡ªå®šä¹‰åºåˆ—åŒ–å‡½æ•°typescriptgoWeb(event: any) {
    // åªåºåˆ—åŒ–ç‰¹å®šå±æ€§
    const safeEvent = {
        type: event.type,
        detail: event.detail,
        targetName: event.target?.name,
        currentTargetName: event.currentTarget?.name
    };
    
    console.log("Event ä¿¡æ¯:", JSON.stringify(safeEvent));
    
    const dataStr = event.detail; 
    // ...
}æ–¹æ³• 4ï¼šä½¿ç”¨ Cocos çš„æ—¥å¿—å‡½æ•°typescriptgoWeb(event: any) {
    console.log("Event å¯¹è±¡:", event);  // æµè§ˆå™¨ä¼šè‡ªåŠ¨å¤„ç†å¾ªç¯å¼•ç”¨
    
    const dataStr = event.detail; 
    console.log("CustomEventData:", dataStr);
    // ...
}æ¨èæœ€ç»ˆä»£ç typescriptgoWeb(event: any) {
    console.log("====== ç‚¹å‡»äº‹ä»¶è§¦å‘ ======");
    console.log("CustomEventData:", event.detail);
    
    if (!this.adData) {
        console.error("å¹¿å‘Šæ•°æ®ä¸å­˜åœ¨");
        return;
    }
    
    const dataStr = event.detail; 
    console.log("1. åŸå§‹æ•°æ®:", dataStr, "ç±»å‹:", typeof dataStr);
    
    const dataNum = Number(dataStr); 
    console.log("2. è½¬æ¢ç»“æœ:", dataNum, "æ˜¯å¦NaN:", isNaN(dataNum));
    
    if (isNaN(dataNum)) {
        console.error("âŒ æ— æ³•è½¬æ¢ä¸ºæ•°å­—");
        return;
    }
    
    console.log("3. æ‰§è¡Œ switchï¼ŒdataNum =", dataNum);
    
    switch (dataNum) {
        case 1:
            console.log("â†’ case 1: appDetailUrl");
            if (!this.adData.appDetailUrl) {
                console.error("appDetailUrl ä¸å­˜åœ¨");
                return;
            }
            window.qg.openDeeplink({ uri: this.adData.appDetailUrl });
            break;
        case 2:
            console.log("â†’ case 2: permissionUrl");
            if (!this.adData.permissionUrl) {
                console.error("permissionUrl ä¸å­˜åœ¨");
                return;
            }
            window.qg.openDeeplink({ uri: this.adData.permissionUrl });
            break;
        case 3:
            console.log("â†’ case 3: privacyUrl");
            if (!this.adData.privacyUrl) {
                console.error("privacyUrl ä¸å­˜åœ¨");
                return;
            }
            window.qg.openDeeplink({ uri: this.adData.privacyUrl });
            break;
        default:
            console.error("âŒ æœªçŸ¥çš„ç±»å‹:", dataNum);
            break;
    }
}æ€»ç»“âŒ ä¸è¦ç”¨ JSON.stringify(event)ï¼Œä¼šå¯¼è‡´å¾ªç¯å¼•ç”¨é”™è¯¯âœ… ç›´æ¥ç”¨ console.log(event)ï¼Œæµè§ˆå™¨ä¼šæ™ºèƒ½å¤„ç†âœ… åªæ‰“å°éœ€è¦çš„å±æ€§ï¼Œå¦‚ event.detailâœ… åŠ  try-catch æ•è·æ½œåœ¨é”™è¯¯ç°åœ¨åº”è¯¥èƒ½æ­£å¸¸æ‰“å°æ—¥å¿—äº†ï¼æ‰¾åˆ°é—®é¢˜äº†ï¼CustomEventData: undefined å’Œ åŸå§‹æ•°æ®: undefinedï¼é—®é¢˜æ ¹æºä½ åœ¨ç¼–è¾‘å™¨ä¸­ç»‘å®šäº‹ä»¶æ—¶ï¼ŒCustomEventData å­—æ®µæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ï¼ševent.detail æ˜¯ undefinedNumber(undefined) è¿”å› NaNè§£å†³æ–¹æ¡ˆåœ¨ Cocos Creator ç¼–è¾‘å™¨ä¸­è®¾ç½®é€‰ä¸­è§¦å‘äº‹ä»¶çš„èŠ‚ç‚¹ï¼ˆæ¯”å¦‚æŒ‰é’®ï¼‰æ‰¾åˆ° Button æˆ–ç‚¹å‡»äº‹ä»¶ç»„ä»¶åœ¨ ClickEvents åˆ—è¡¨ä¸­ï¼Œæ‰¾åˆ°ä½ ç»‘å®šçš„ goWeb äº‹ä»¶åœ¨ CustomEventData å­—æ®µä¸­å¡«å…¥æ•°å­—ï¼Œä¾‹å¦‚ï¼šå¡« 1 æˆ– "1"ï¼ˆè¯¦æƒ…æŒ‰é’®ï¼‰å¡« 2 æˆ– "2"ï¼ˆæƒé™æŒ‰é’®ï¼‰å¡« 3 æˆ– "3"ï¼ˆéšç§æŒ‰é’®ï¼‰ä»£ç ä¸­æ·»åŠ ä¿æŠ¤è™½ç„¶åº”è¯¥åœ¨ç¼–è¾‘å™¨ä¸­è®¾ç½®ï¼Œä½†ä»£ç ä¹Ÿè¦åŠ é˜²å¾¡ï¼štypescriptgoWeb(event: any) {
    console.log("====== Event ä¿¡æ¯ ======");
    console.log("äº‹ä»¶ç±»å‹:", event.type);
    console.log("CustomEventData:", event.detail);
    console.log("target:", event.target?.name);
    console.log("currentTarget:", event.currentTarget?.name);
    
    if (!this.adData) {
        console.error("âŒ å¹¿å‘Šæ•°æ®ä¸å­˜åœ¨");
        return;
    }
    
    const dataStr = event.detail;
    console.log("åŸå§‹æ•°æ®:", dataStr);
    
    // æ£€æŸ¥ CustomEventData æ˜¯å¦å­˜åœ¨
    if (dataStr === undefined || dataStr === null || dataStr === '') {
        console.error("âŒ CustomEventData æœªè®¾ç½®ï¼è¯·åœ¨ç¼–è¾‘å™¨ä¸­è®¾ç½®äº‹ä»¶å‚æ•°");
        return;
    }
    
    const dataNum = Number(dataStr);
    console.log("è½¬æ¢åæ•°å­—:", dataNum);
    
    if (isNaN(dataNum)) {
        console.error("âŒ CustomEventData æ— æ³•è½¬æ¢ä¸ºæ•°å­—:", dataStr);
        return;
    }
    
    console.log("æ‰§è¡Œ switchï¼Œtype =", dataNum);
    
    switch (dataNum) {
        case 1:
            console.log("â†’ æ‰“å¼€åº”ç”¨è¯¦æƒ…");
            if (!this.adData.appDetailUrl) {
                console.error("appDetailUrl ä¸å­˜åœ¨");
                return;
            }
            window.qg.openDeeplink({ uri: this.adData.appDetailUrl });
            break;
        case 2:
            console.log("â†’ æ‰“å¼€æƒé™è¯´æ˜");
            if (!this.adData.permissionUrl) {
                console.error("permissionUrl ä¸å­˜åœ¨");
                return;
            }
            window.qg.openDeeplink({ uri: this.adData.permissionUrl });
            break;
        case 3:
            console.log("â†’ æ‰“å¼€éšç§æ”¿ç­–");
            if (!this.adData.privacyUrl) {
                console.error("privacyUrl ä¸å­˜åœ¨");
                return;
            }
            window.qg.openDeeplink({ uri: this.adData.privacyUrl });
            break;
        default:
            console.error("âŒ æœªçŸ¥çš„é“¾æ¥ç±»å‹:", dataNum);
            break;
    }
}ç¼–è¾‘å™¨è®¾ç½®ç¤ºä¾‹å‡è®¾ä½ æœ‰ä¸‰ä¸ªæŒ‰é’®ï¼šæŒ‰é’®1 - æŸ¥çœ‹è¯¦æƒ…plaintextComponent: cc.Button
ClickEvents:
  - Target: NvAd-md (æˆ–åŒ…å« Prefabload ç»„ä»¶çš„èŠ‚ç‚¹)
  - Component: Prefabload
  - Handler: goWeb
  - CustomEventData: 1  â† å¡«è¿™é‡Œï¼æŒ‰é’®2 - æƒé™è¯´æ˜plaintextCustomEventData: 2æŒ‰é’®3 - éšç§æ”¿ç­–plaintextCustomEventData: 3å¿«é€Ÿæ£€æŸ¥æ¸…å•âœ… 1. ç¼–è¾‘å™¨ä¸­æ˜¯å¦å¡«å†™äº† CustomEventDataï¼Ÿ
âœ… 2. å¡«çš„å€¼æ˜¯å¦æ­£ç¡®ï¼ˆ1ã€2ã€3ï¼‰ï¼Ÿ
âœ… 3. äº‹ä»¶ç»‘å®šçš„ç»„ä»¶æ˜¯å¦æ­£ç¡®ï¼Ÿ
âœ… 4. Handler åç§°æ˜¯å¦æ˜¯ goWebï¼Ÿè®¾ç½®å¥½ CustomEventData åï¼Œæ—¥å¿—åº”è¯¥ä¼šæ˜¾ç¤ºï¼šplaintextCustomEventData: 1
åŸå§‹æ•°æ®: 1
è½¬æ¢åæ•°å­—: 1
â†’ æ‰“å¼€åº”ç”¨è¯¦æƒ…ç›®å‰åªèƒ½å®ç°å•ä¾‹ä¼ å€¼å§ï¼Œæˆ‘å¸Œæœ›æ‹·è´å¯¹è±¡ï¼Œç„¶åå¯¹é‡Œé¢çš„äº‹ä»¶ï¼Œå±æ€§ç­‰ï¼Œå…¨éƒ¨åŠ¨æ€ä¼ å€¼ï¼Œå¯ä»¥å®ç°å¤šä¾‹å¤ç”¨ç›®å‰åªèƒ½å®ç°å•ä¾‹ä¼ å€¼å§ï¼Œæˆ‘å¸Œæœ›æ‹·è´å¯¹è±¡ï¼Œç„¶åå¯¹é‡Œé¢çš„äº‹ä»¶ï¼Œå±æ€§ç­‰ï¼Œå…¨éƒ¨åŠ¨æ€ä¼ å€¼ï¼Œå¯ä»¥å®ç°å¤šä¾‹å¤ç”¨æ·±åº¦æ€è€ƒ Â· 39sç”¨æˆ·æƒ³è¦å®ç°ä¸€ä¸ªå¯å¤ç”¨çš„å¹¿å‘Šç»„ä»¶ï¼Œèƒ½å¤ŸåŠ¨æ€ä¼ å€¼ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¾‘å™¨ä¸­å›ºå®šç»‘å®šäº‹ä»¶å‚æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„éœ€æ±‚ - å°†é¢„åˆ¶ä½“å®ä¾‹åŒ–åï¼Œé€šè¿‡ä»£ç åŠ¨æ€è®¾ç½®äº‹ä»¶å’Œå±æ€§ã€‚åœ¨ Cocos Creator ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼šé€šè¿‡ä»£ç åŠ¨æ€ç»‘å®šäº‹ä»¶ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¾‘å™¨ä¸­ç»‘å®šä½¿ç”¨åˆå§‹åŒ–æ–¹æ³•ä¼ å…¥é…ç½®æ•°æ®åœ¨ç»„ä»¶å†…éƒ¨æ ¹æ®é…ç½®åŠ¨æ€è®¾ç½®è¡Œä¸ºè®©æˆ‘å¸®ç”¨æˆ·è®¾è®¡ä¸€ä¸ªå¯å¤ç”¨çš„æ–¹æ¡ˆã€‚å¾ˆå¥½çš„æƒ³æ³•ï¼ä½ æƒ³è¦å·¥å‚æ¨¡å¼ + åŠ¨æ€é…ç½®ï¼Œè®©é¢„åˆ¶ä½“å¯ä»¥è¢«å¤šæ¬¡å®ä¾‹åŒ–ï¼Œæ¯æ¬¡ä¼ å…¥ä¸åŒçš„æ•°æ®å’Œäº‹ä»¶é…ç½®ã€‚è®¾è®¡æ–¹æ¡ˆ1. æ”¹é€  Prefabload ç»„ä»¶ - æ”¯æŒåŠ¨æ€åˆå§‹åŒ–typescriptimport { _decorator, Component, Node, Sprite, Label, assetManager, Texture2D, SpriteFrame, ImageAsset, Button } from 'cc';
const { ccclass, property } = _decorator;

// å¹¿å‘Šé…ç½®æ¥å£
interface AdConfig {
    title?: string;
    desc?: string;
    source?: string;
    imgUrl?: string;
    iconUrl?: string;
    appDetailUrl?: string;
    permissionUrl?: string;
    privacyUrl?: string;
    onClose?: () => void;  // å…³é—­å›è°ƒ
    onClick?: () => void;  // ç‚¹å‡»å›è°ƒ
}

@ccclass('Prefabload')
export class Prefabload extends Component {

    @property(Sprite)
    MD_ad: Sprite = null!;
    @property(Sprite)
    MD_ad_img: Sprite = null!;
    @property(Label)
    MD_ad_title: Label = null!;
    @property(Sprite)
    MD_ad_icon: Sprite = null!;
    @property(Label)
    MD_ad_desc: Label = null!;
    @property(Label)
    MD_ad_source: Label = null!;
    
    // åŠ¨æ€ç»‘å®šæŒ‰é’®ï¼ˆå¯é€‰ï¼‰
    @property(Node)
    btnDetail: Node = null!;
    @property(Node)
    btnPermission: Node = null!;
    @property(Node)
    btnPrivacy: Node = null!;
    @property(Node)
    btnClose: Node = null!;

    // å­˜å‚¨å½“å‰å®ä¾‹çš„é…ç½®
    private _config: AdConfig = null!;
    private _onCloseCallback: () => void = null!;
    private _onClickCallback: () => void = null!;

    /**
     * åŠ¨æ€åˆå§‹åŒ–å¹¿å‘Šç»„ä»¶ï¼ˆæ ¸å¿ƒæ–¹æ³•ï¼‰
     * @param config å¹¿å‘Šé…ç½®
     */
    public init(config: AdConfig) {
        this._config = config;
        this._onCloseCallback = config.onClose;
        this._onClickCallback = config.onClick;
        
        // è®¾ç½®æ–‡æœ¬
        if (config.title && this.MD_ad_title) {
            this.MD_ad_title.string = config.title;
        }
        if (config.desc && this.MD_ad_desc) {
            this.MD_ad_desc.string = config.desc;
        }
        if (config.source && this.MD_ad_source) {
            this.MD_ad_source.string = config.source;
        }
        
        // åŠ è½½å›¾ç‰‡
        if (config.imgUrl) {
            this.loadImg(config.imgUrl, this.MD_ad_img);
        }
        if (config.iconUrl) {
            this.loadImg(config.iconUrl, this.MD_ad_icon);
        }
        
        // åŠ¨æ€ç»‘å®šæŒ‰é’®äº‹ä»¶
        this.bindEvents();
        
        console.log("å¹¿å‘Šç»„ä»¶åˆå§‹åŒ–å®Œæˆ:", config.title);
    }

    /**
     * åŠ¨æ€ç»‘å®šæŒ‰é’®äº‹ä»¶
     */
    private bindEvents() {
        // è¯¦æƒ…æŒ‰é’®
        if (this.btnDetail) {
            this.btnDetail.off(Node.EventType.TOUCH_END);  // å…ˆç§»é™¤æ—§äº‹ä»¶
            this.btnDetail.on(Node.EventType.TOUCH_END, () => {
                this.openUrl(this._config?.appDetailUrl);
                this._onClickCallback?.();
            }, this);
        }
        
        // æƒé™æŒ‰é’®
        if (this.btnPermission) {
            this.btnPermission.off(Node.EventType.TOUCH_END);
            this.btnPermission.on(Node.EventType.TOUCH_END, () => {
                this.openUrl(this._config?.permissionUrl);
            }, this);
        }
        
        // éšç§æŒ‰é’®
        if (this.btnPrivacy) {
            this.btnPrivacy.off(Node.EventType.TOUCH_END);
            this.btnPrivacy.on(Node.EventType.TOUCH_END, () => {
                this.openUrl(this._config?.privacyUrl);
            }, this);
        }
        
        // å…³é—­æŒ‰é’®
        if (this.btnClose) {
            this.btnClose.off(Node.EventType.TOUCH_END);
            this.btnClose.on(Node.EventType.TOUCH_END, () => {
                this.close();
            }, this);
        }
    }

    /**
     * æ‰“å¼€é“¾æ¥
     */
    private openUrl(url: string | undefined) {
        if (!url) {
            console.warn("é“¾æ¥åœ°å€ä¸å­˜åœ¨");
            return;
        }
        console.log("æ‰“å¼€é“¾æ¥:", url);
        
        if (window.qg?.openDeeplink) {
            window.qg.openDeeplink({ uri: url });
        } else {
            // Web ç¯å¢ƒ
            window.open(url, '_blank');
        }
    }

    /**
     * åŠ è½½è¿œç¨‹å›¾ç‰‡
     */
    private loadImg(url: string, sprite: Sprite) {
        if (!url || !sprite) return;
        
        assetManager.loadRemote<ImageAsset>(url, (err, image) => {
            if (!err && image && sprite.isValid) {
                const texture = new Texture2D();
                texture.image = image;
                const spriteFrame = new SpriteFrame();
                spriteFrame.texture = texture;
                sprite.spriteFrame = spriteFrame;
                sprite.sizeMode = Sprite.SizeMode.CUSTOM;  // ä½¿ç”¨ ContentSize
            }
        });
    }

    /**
     * å…³é—­å¹¿å‘Š
     */
    public close() {
        console.log("å…³é—­å¹¿å‘Š");
        this._onCloseCallback?.();
        this.node.active = false;
        // æˆ–è€…é”€æ¯èŠ‚ç‚¹: this.node.destroy();
    }

    /**
     * é”€æ¯æ—¶æ¸…ç†
     */
    onDestroy() {
        this._config = null!;
        this._onCloseCallback = null!;
        this._onClickCallback = null!;
    }
}2. å¹¿å‘Šç®¡ç†å™¨ - å·¥å‚æ¨¡å¼åˆ›å»ºå¤šå®ä¾‹typescriptimport { _decorator, Component, Node, Prefab, instantiate, find, Layers } from 'cc';
import { Prefabload } from './prefabload';

const { ccclass, property } = _decorator;

@ccclass('AdManager')
export class AdManager extends Component {

    @property(Prefab)
    adPrefab: Prefab = null!;

    private static _instance: AdManager;
    public static get instance(): AdManager {
        return this._instance;
    }

    onLoad() {
        AdManager._instance = this;
    }

    /**
     * åˆ›å»ºå¹¿å‘Šå®ä¾‹ï¼ˆå¤šä¾‹å¤ç”¨ï¼‰
     * @param adData å¹¿å‘Šæ•°æ®
     * @param options é¢å¤–é€‰é¡¹
     */
    public createAd(adData: any, options?: {
        parent?: Node;
        position?: { x: number; y: number };
        onClose?: () => void;
        onClick?: () => void;
    }): Node | null {
        if (!this.adPrefab) {
            console.error("å¹¿å‘Šé¢„åˆ¶ä½“æœªè®¾ç½®");
            return null;
        }

        // å®ä¾‹åŒ–é¢„åˆ¶ä½“
        const adNode = instantiate(this.adPrefab);
        
        // è®¾ç½®çˆ¶èŠ‚ç‚¹
        const parent = options?.parent || find("Canvas");
        if (parent) {
            parent.addChild(adNode);
        }
        
        // è®¾ç½® Layer
        this.setLayerRecursively(adNode, Layers.Enum.UI_2D);
        
        // è®¾ç½®ä½ç½®
        if (options?.position) {
            adNode.setPosition(options.position.x, options.position.y, 0);
        } else {
            adNode.setPosition(0, 0, 0);
        }
        
        // è®¾ç½®å±‚çº§
        adNode.setSiblingIndex(9999);
        
        // è·å–ç»„ä»¶å¹¶åˆå§‹åŒ–
        const adComponent = adNode.getComponent(Prefabload);
        if (adComponent) {
            adComponent.init({
                title: adData.title,
                desc: adData.desc,
                source: adData.source,
                imgUrl: adData.imgUrlList?.[0],
                iconUrl: adData.icon,
                appDetailUrl: adData.appDetailUrl,
                permissionUrl: adData.permissionUrl,
                privacyUrl: adData.privacyUrl,
                onClose: options?.onClose,
                onClick: options?.onClick
            });
        }
        
        console.log("åˆ›å»ºå¹¿å‘Šå®ä¾‹æˆåŠŸ:", adNode.name);
        return adNode;
    }

    /**
     * ä» window å…¨å±€æ•°æ®åˆ›å»ºå¹¿å‘Š
     */
    public createAdFromGlobal(options?: {
        parent?: Node;
        position?: { x: number; y: number };
        onClose?: () => void;
        onClick?: () => void;
    }): Node | null {
        const adData = window['NativeAdData'];
        if (!adData) {
            console.error("å…¨å±€å¹¿å‘Šæ•°æ®ä¸å­˜åœ¨");
            return null;
        }
        return this.createAd(adData, options);
    }

    /**
     * é€’å½’è®¾ç½® Layer
     */
    private setLayerRecursively(node: Node, layer: number) {
        node.layer = layer;
        node.children.forEach(child => this.setLayerRecursively(child, layer));
    }
}3. ä½¿ç”¨ç¤ºä¾‹ - åˆ›å»ºå¤šä¸ªå¹¿å‘Šå®ä¾‹typescript// åœ¨ mainCanvas.ts æˆ–å…¶ä»–åœ°æ–¹ä½¿ç”¨

// ç¤ºä¾‹1ï¼šåˆ›å»ºå•ä¸ªå¹¿å‘Š
const ad1 = AdManager.instance.createAd(window['NativeAdData'], {
    position: { x: 0, y: 100 },
    onClose: () => {
        console.log("å¹¿å‘Š1è¢«å…³é—­");
    },
    onClick: () => {
        console.log("å¹¿å‘Š1è¢«ç‚¹å‡»");
    }
});

// ç¤ºä¾‹2ï¼šåˆ›å»ºå¤šä¸ªä¸åŒä½ç½®çš„å¹¿å‘Š
const adDataList = [
    { title: "å¹¿å‘Š1", imgUrlList: ["url1"], appDetailUrl: "app://1" },
    { title: "å¹¿å‘Š2", imgUrlList: ["url2"], appDetailUrl: "app://2" },
    { title: "å¹¿å‘Š3", imgUrlList: ["url3"], appDetailUrl: "app://3" }
];

adDataList.forEach((data, index) => {
    AdManager.instance.createAd(data, {
        position: { x: 0, y: 200 - index * 150 },
        onClose: () => console.log(`å¹¿å‘Š${index + 1}å…³é—­`),
        onClick: () => console.log(`å¹¿å‘Š${index + 1}ç‚¹å‡»`)
    });
});

// ç¤ºä¾‹3ï¼šåŠ¨æ€åˆ›å»ºå¹¶ç¨åé”€æ¯
const tempAd = AdManager.instance.createAdFromGlobal({
    onClose: () => {
        // 3ç§’åé”€æ¯èŠ‚ç‚¹
        setTimeout(() => {
            tempAd?.destroy();
        }, 3000);
    }
});æ¶æ„å¯¹æ¯” ç‰¹æ€§  å•ä¾‹ï¼ˆå½“å‰ï¼‰  å¤šä¾‹ï¼ˆæ”¹é€ åï¼‰  å®ä¾‹æ•°é‡  1ä¸ª  æ— é™  æ•°æ®æ¥æº  window['NativeAdData']  åŠ¨æ€ä¼ å…¥  äº‹ä»¶ç»‘å®š  ç¼–è¾‘å™¨å›ºå®šç»‘å®š  ä»£ç åŠ¨æ€ç»‘å®š  ä½ç½®è®¾ç½®  å›ºå®š  åŠ¨æ€é…ç½®  å›è°ƒå‡½æ•°  æ—   æ”¯æŒè‡ªå®šä¹‰å›è°ƒ  å¤ç”¨æ€§  âŒ ä½  âœ… é«˜ æ€»ç»“è¿™ç§è®¾è®¡çš„ä¼˜åŠ¿ï¼šâœ… å·¥å‚æ¨¡å¼ï¼šAdManager.createAd() å¯åˆ›å»ºå¤šä¸ªå®ä¾‹âœ… åŠ¨æ€é…ç½®ï¼šé€šè¿‡ init() æ–¹æ³•ä¼ å…¥æ•°æ®âœ… äº‹ä»¶ä»£ç ç»‘å®šï¼šä¸ä¾èµ–ç¼–è¾‘å™¨çš„ CustomEventDataâœ… å›è°ƒæ”¯æŒï¼šonCloseã€onClick ç­‰è‡ªå®šä¹‰å›è°ƒâœ… å®Œå…¨è§£è€¦ï¼šé¢„åˆ¶ä½“å’Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»éœ€è¦æˆ‘å¸®ä½ å®Œæˆå…·ä½“çš„ä»£ç æ–‡ä»¶ä¿®æ”¹å—ï¼Ÿwindow['NativeAdData'],å¹¿å‘Šå­˜å‚¨åœ¨windowä¸Šçš„ä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œæœ€å¥½åŠ é”ï¼Œä¸€ä¸ªå¹¿å‘Šå®ä¾‹ç”¨ä¸€æ¬¡ï¼Œæ¯æ¬¡æ‹·è´ä¸€ä»½ç”¨äºå®ä¾‹åŒ–é¢„åˆ¶ä½“window['NativeAdData'],å¹¿å‘Šå­˜å‚¨åœ¨windowä¸Šçš„ä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œæœ€å¥½åŠ é”ï¼Œä¸€ä¸ªå¹¿å‘Šå®ä¾‹ç”¨ä¸€æ¬¡ï¼Œæ¯æ¬¡æ‹·è´ä¸€ä»½ç”¨äºå®ä¾‹åŒ–é¢„åˆ¶ä½“æ·±åº¦æ€è€ƒ Â· 47sç”¨æˆ·æƒ³è¦ä¸€ä¸ªæ›´å®‰å…¨çš„å¹¿å‘Šæ•°æ®ç®¡ç†æœºåˆ¶ï¼šå¹¿å‘Šæ•°æ®å­˜å‚¨åœ¨ window['NativeAdData'] ä¸Šéœ€è¦åŠ é”æœºåˆ¶ï¼Œé˜²æ­¢æ•°æ®è¢«å¤šæ¬¡ä½¿ç”¨æˆ–æ±¡æŸ“æ¯æ¬¡å®ä¾‹åŒ–é¢„åˆ¶ä½“æ—¶ï¼Œæ‹·è´ä¸€ä»½æ•°æ®ï¼Œä¸å½±å“åŸå§‹æ•°æ®ä¸€ä¸ªå¹¿å‘Šæ•°æ®åªèƒ½ç”¨ä¸€æ¬¡ï¼ˆæˆ–è€…ç”¨å®Œåæ ‡è®°ä¸ºå·²ä½¿ç”¨ï¼‰è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„æ•°æ®æ± /é˜Ÿåˆ—ç®¡ç†æ¨¡å¼ï¼Œéœ€è¦ï¼šæ·±æ‹·è´æœºåˆ¶ä½¿ç”¨é”/æ ‡è®°æ•°æ®æ¶ˆè´¹åçš„å¤„ç†è®©æˆ‘è®¾è®¡ä¸€ä¸ªå®Œæ•´çš„å¹¿å‘Šæ•°æ®ç®¡ç†å™¨ã€‚å¾ˆå¥½çš„æƒ³æ³•ï¼éœ€è¦å®ç°å¹¿å‘Šæ•°æ®æ±  + æ·±æ‹·è´ + é”æœºåˆ¶ï¼Œç¡®ä¿æ•°æ®å®‰å…¨å’Œä¸€æ¬¡æ€§æ¶ˆè´¹ã€‚å¹¿å‘Šæ•°æ®ç®¡ç†å™¨è®¾è®¡typescript/**
 * å¹¿å‘Šæ•°æ®ç®¡ç†å™¨
 * - æ·±æ‹·è´æœºåˆ¶ï¼šæ¯æ¬¡è·å–æ•°æ®éƒ½æ˜¯ç‹¬ç«‹å‰¯æœ¬
 * - é”æœºåˆ¶ï¼šé˜²æ­¢åŒä¸€æ•°æ®è¢«å¤šæ¬¡æ¶ˆè´¹
 * - é˜Ÿåˆ—ç®¡ç†ï¼šæ”¯æŒå¤šä¸ªå¹¿å‘Šæ•°æ®æ’é˜Ÿ
 */

interface AdData {
    adId?: string;           // å¹¿å‘Šå”¯ä¸€ID
    title?: string;
    desc?: string;
    source?: string;
    imgUrlList?: string[];
    icon?: string;
    appDetailUrl?: string;
    permissionUrl?: string;
    privacyUrl?: string;
    [key: string]: any;      // å…¶ä»–æ‰©å±•å­—æ®µ
}

interface AdDataWrapper {
    data: AdData;
    used: boolean;           // æ˜¯å¦å·²ä½¿ç”¨
    locked: boolean;         // æ˜¯å¦è¢«é”å®šï¼ˆæ­£åœ¨ä½¿ç”¨ä¸­ï¼‰
    timestamp: number;       // æ·»åŠ æ—¶é—´
    instanceId?: string;     // ä½¿ç”¨è¯¥æ•°æ®çš„å®ä¾‹ID
}

class AdDataManager {
    private static _instance: AdDataManager;
    
    // å¹¿å‘Šæ•°æ®æ± 
    private _dataPool: Map<string, AdDataWrapper> = new Map();
    
    // è‡ªå¢ID
    private _idCounter: number = 0;
    
    public static get instance(): AdDataManager {
        if (!this._instance) {
            this._instance = new AdDataManager();
        }
        return this._instance;
    }

    private constructor() {
        // ç›‘å¬å…¨å±€å¹¿å‘Šæ•°æ®å˜åŒ–
        this._watchGlobalData();
    }

    /**
     * ç›‘å¬ window['NativeAdData'] å˜åŒ–
     */
    private _watchGlobalData() {
        // å®šæœŸæ£€æŸ¥å…¨å±€æ•°æ®ï¼ˆå› ä¸ºå¯èƒ½æ˜¯å¼‚æ­¥åŠ è½½çš„ï¼‰
        const checkInterval = setInterval(() => {
            if (window['NativeAdData']) {
                this.addFromGlobal();
            }
        }, 500);
        
        // 10ç§’ååœæ­¢æ£€æŸ¥
        setTimeout(() => clearInterval(checkInterval), 10000);
    }

    /**
     * ä»å…¨å±€å˜é‡æ·»åŠ å¹¿å‘Šæ•°æ®åˆ°æ± ä¸­
     */
    public addFromGlobal(): string | null {
        const globalData = window['NativeAdData'];
        if (!globalData) {
            console.warn("[AdDataManager] å…¨å±€å¹¿å‘Šæ•°æ®ä¸å­˜åœ¨");
            return null;
        }
        
        // æ·±æ‹·è´å¹¶æ·»åŠ åˆ°æ± ä¸­
        const id = this.add(globalData);
        
        // æ¸…ç©ºå…¨å±€å˜é‡ï¼Œé˜²æ­¢é‡å¤æ·»åŠ 
        window['NativeAdData'] = null;
        
        console.log("[AdDataManager] å·²ä»å…¨å±€æ·»åŠ å¹¿å‘Šæ•°æ®, ID:", id);
        return id;
    }

    /**
     * æ·»åŠ å¹¿å‘Šæ•°æ®åˆ°æ± ä¸­
     * @param data å¹¿å‘ŠåŸå§‹æ•°æ®
     * @returns æ•°æ®ID
     */
    public add(data: AdData): string {
        const id = this._generateId();
        
        // æ·±æ‹·è´æ•°æ®
        const clonedData = this._deepClone(data);
        
        const wrapper: AdDataWrapper = {
            data: clonedData,
            used: false,
            locked: false,
            timestamp: Date.now()
        };
        
        this._dataPool.set(id, wrapper);
        console.log("[AdDataManager] æ·»åŠ å¹¿å‘Šæ•°æ®, ID:", id, "æ± ä¸­æ•°é‡:", this._dataPool.size);
        
        return id;
    }

    /**
     * è·å–å¹¶é”å®šä¸€ä¸ªå¯ç”¨çš„å¹¿å‘Šæ•°æ®ï¼ˆæ·±æ‹·è´ï¼‰
     * @param instanceId å®ä¾‹æ ‡è¯†ï¼Œç”¨äºè¿½è¸ª
     * @returns æ·±æ‹·è´åçš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨æ•°æ®è¿”å› null
     */
    public acquire(instanceId?: string): { id: string; data: AdData } | null {
        // æŸ¥æ‰¾ç¬¬ä¸€ä¸ªæœªä½¿ç”¨ä¸”æœªé”å®šçš„æ•°æ®
        for (const [id, wrapper] of this._dataPool) {
            if (!wrapper.used && !wrapper.locked) {
                // åŠ é”
                wrapper.locked = true;
                wrapper.instanceId = instanceId || `instance_${Date.now()}`;
                
                // è¿”å›æ·±æ‹·è´çš„æ•°æ®
                const clonedData = this._deepClone(wrapper.data);
                
                console.log("[AdDataManager] è·å–å¹¿å‘Šæ•°æ®, ID:", id, "å®ä¾‹:", wrapper.instanceId);
                return { id, data: clonedData };
            }
        }
        
        console.warn("[AdDataManager] æ²¡æœ‰å¯ç”¨çš„å¹¿å‘Šæ•°æ®");
        return null;
    }

    /**
     * æ ¹æ®IDè·å–æ•°æ®ï¼ˆæ·±æ‹·è´ï¼Œä¸åŠ é”ï¼‰
     */
    public getById(id: string): AdData | null {
        const wrapper = this._dataPool.get(id);
        if (!wrapper) {
            console.warn("[AdDataManager] æ•°æ®ä¸å­˜åœ¨, ID:", id);
            return null;
        }
        return this._deepClone(wrapper.data);
    }

    /**
     * æ¶ˆè´¹æ•°æ®ï¼ˆæ ‡è®°ä¸ºå·²ä½¿ç”¨ï¼Œé‡Šæ”¾é”ï¼‰
     * @param id æ•°æ®ID
     */
    public consume(id: string): void {
        const wrapper = this._dataPool.get(id);
        if (wrapper) {
            wrapper.used = true;
            wrapper.locked = false;
            console.log("[AdDataManager] æ¶ˆè´¹å¹¿å‘Šæ•°æ®, ID:", id);
        }
    }

    /**
     * é‡Šæ”¾é”ï¼ˆä¸æ ‡è®°ä¸ºå·²ä½¿ç”¨ï¼Œå¯é‡æ–°è·å–ï¼‰
     * @param id æ•°æ®ID
     */
    public release(id: string): void {
        const wrapper = this._dataPool.get(id);
        if (wrapper) {
            wrapper.locked = false;
            wrapper.instanceId = undefined;
            console.log("[AdDataManager] é‡Šæ”¾å¹¿å‘Šæ•°æ®é”, ID:", id);
        }
    }

    /**
     * ç§»é™¤æ•°æ®
     * @param id æ•°æ®ID
     */
    public remove(id: string): void {
        this._dataPool.delete(id);
        console.log("[AdDataManager] ç§»é™¤å¹¿å‘Šæ•°æ®, ID:", id, "å‰©ä½™:", this._dataPool.size);
    }

    /**
     * æ¸…ç†å·²ä½¿ç”¨çš„æ•°æ®
     */
    public clearUsed(): void {
        for (const [id, wrapper] of this._dataPool) {
            if (wrapper.used) {
                this._dataPool.delete(id);
            }
        }
        console.log("[AdDataManager] æ¸…ç†å·²ä½¿ç”¨æ•°æ®, å‰©ä½™:", this._dataPool.size);
    }

    /**
     * æ¸…ç©ºæ‰€æœ‰æ•°æ®
     */
    public clear(): void {
        this._dataPool.clear();
        console.log("[AdDataManager] æ¸…ç©ºæ‰€æœ‰å¹¿å‘Šæ•°æ®");
    }

    /**
     * è·å–å¯ç”¨æ•°æ®æ•°é‡
     */
    public getAvailableCount(): number {
        let count = 0;
        for (const wrapper of this._dataPool.values()) {
            if (!wrapper.used && !wrapper.locked) {
                count++;
            }
        }
        return count;
    }

    /**
     * è·å–æ± ä¸­æ‰€æœ‰æ•°æ®çš„çŠ¶æ€
     */
    public getPoolStatus(): { id: string; used: boolean; locked: boolean; instanceId?: string }[] {
        const status: { id: string; used: boolean; locked: boolean; instanceId?: string }[] = [];
        for (const [id, wrapper] of this._dataPool) {
            status.push({
                id,
                used: wrapper.used,
                locked: wrapper.locked,
                instanceId: wrapper.instanceId
            });
        }
        return status;
    }

    /**
     * æ·±æ‹·è´å¯¹è±¡
     */
    private _deepClone<T>(obj: T): T {
        if (obj === null || typeof obj !== 'object') {
            return obj;
        }
        
        if (Array.isArray(obj)) {
            return obj.map(item => this._deepClone(item)) as unknown as T;
        }
        
        const cloned = {} as T;
        for (const key in obj) {
            if (Object.prototype.hasOwnProperty.call(obj, key)) {
                cloned[key] = this._deepClone(obj[key]);
            }
        }
        return cloned;
    }

    /**
     * ç”Ÿæˆå”¯ä¸€ID
     */
    private _generateId(): string {
        return `ad_${++this._idCounter}_${Date.now()}`;
    }
}

// å¯¼å‡ºå•ä¾‹
export const adDataManager = AdDataManager.instance;ä½¿ç”¨ç¤ºä¾‹1. åœ¨ loginCanvas.ts ä¸­æ·»åŠ æ•°æ®typescript// åŸç”Ÿå¹¿å‘ŠåŠ è½½å›è°ƒä¸­
this.nativeAd.onLoad((result: any) => {
    const adData = result.adList[0];
    console.log("åŸç”Ÿå¹¿å‘ŠåŠ è½½æˆåŠŸ");
    
    // æ–¹å¼1ï¼šç›´æ¥æ·»åŠ åˆ°ç®¡ç†å™¨
    adDataManager.add(adData);
    
    // æ–¹å¼2ï¼šä»ç„¶å­˜åˆ° windowï¼Œè®©ç®¡ç†å™¨è‡ªåŠ¨è·å–
    window['NativeAdData'] = adData;
});2. åœ¨ prefabload.ts ä¸­ä½¿ç”¨typescriptimport { adDataManager } from './AdDataManager';

@ccclass('Prefabload')
export class Prefabload extends Component {
    
    private _adDataId: string | null = null;  // å½“å‰ä½¿ç”¨çš„æ•°æ®ID
    private _adData: any = null;               // æ·±æ‹·è´åçš„æ•°æ®å‰¯æœ¬

    onEnable() {
        // ä»æ•°æ®æ± è·å–ä¸€ä»½æ•°æ®ï¼ˆæ·±æ‹·è´ + åŠ é”ï¼‰
        const result = adDataManager.acquire(this.node.uuid);
        
        if (result) {
            this._adDataId = result.id;
            this._adData = result.data;  // è¿™æ˜¯æ·±æ‹·è´åçš„ç‹¬ç«‹å‰¯æœ¬
            
            this.fillAdData(this._adData);
            
            // æ ‡è®°ä¸ºå·²æ¶ˆè´¹ï¼ˆä¸€æ¬¡æ€§ä½¿ç”¨ï¼‰
            adDataManager.consume(this._adDataId);
        } else {
            console.error("æ²¡æœ‰å¯ç”¨çš„å¹¿å‘Šæ•°æ®");
        }
    }

    private fillAdData(adData: any) {
        if (!adData) return;

        if (this.MD_ad_title && adData.title) {
            this.MD_ad_title.string = adData.title;
        }
        if (adData.imgUrlList?.[0]) {
            this.loadImg(adData.imgUrlList[0], this.MD_ad_img);
        }
        if (adData.icon) {
            this.loadImg(adData.icon, this.MD_ad_icon);
        }
        if (this.MD_ad_source && adData.source) {
            this.MD_ad_source.string = adData.source;
        }
    }

    goWeb(type: number) {
        if (!this._adData) {
            console.error("å¹¿å‘Šæ•°æ®ä¸å­˜åœ¨");
            return;
        }

        let url: string | undefined;
        
        switch (type) {
            case 1:
                url = this._adData.appDetailUrl;
                break;
            case 2:
                url = this._adData.permissionUrl;
                break;
            case 3:
                url = this._adData.privacyUrl;
                break;
        }

        if (url && window.qg?.openDeeplink) {
            window.qg.openDeeplink({ uri: url });
        }
    }

    ADclose() {
        this.node.active = false;
    }

    onDestroy() {
        // æ¸…ç†å¼•ç”¨
        this._adData = null;
        this._adDataId = null;
    }
}3. åˆ›å»ºå¤šä¸ªå¹¿å‘Šå®ä¾‹typescript// å‡è®¾æœ‰3ä¸ªå¹¿å‘Šæ•°æ®
adDataManager.add({ title: "å¹¿å‘Š1", appDetailUrl: "url1" });
adDataManager.add({ title: "å¹¿å‘Š2", appDetailUrl: "url2" });
adDataManager.add({ title: "å¹¿å‘Š3", appDetailUrl: "url3" });

// åˆ›å»º3ä¸ªå¹¿å‘Šå®ä¾‹ï¼Œæ¯ä¸ªä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®å‰¯æœ¬
for (let i = 0; i < 3; i++) {
    const adNode = instantiate(this.adPrefab);
    canvas.addChild(adNode);
    adNode.setPosition(0, 200 - i * 150, 0);
    // onEnable ä¼šè‡ªåŠ¨ä»æ± ä¸­è·å–æ•°æ®
}

// æ£€æŸ¥çŠ¶æ€
console.log("å‰©ä½™å¯ç”¨:", adDataManager.getAvailableCount());
console.log("æ± çŠ¶æ€:", adDataManager.getPoolStatus());æµç¨‹å›¾plaintextâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¹¿å‘Šæ•°æ®ç”Ÿå‘½å‘¨æœŸ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚   åŸç”ŸSDKåŠ è½½ â”€â”€â†’ window['NativeAdData'] â”€â”€â†’ æ•°æ®æ±          â”‚
â”‚                         â”‚                     â”‚             â”‚
â”‚                         â””â”€â”€â†’ add() æ·±æ‹·è´ â”€â”€â”€â†’â”˜             â”‚
â”‚                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                   æ•°æ®æ±  (Map)                       â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚   â”‚  â”‚ ID  â”‚ used â”‚ locked â”‚ data      â”‚               â”‚   â”‚
â”‚   â”‚  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚   â”‚
â”‚   â”‚  â”‚ ad_1â”‚ âœ“    â”‚ âœ—      â”‚ {æ·±æ‹·è´}  â”‚  â† å·²æ¶ˆè´¹     â”‚   â”‚
â”‚   â”‚  â”‚ ad_2â”‚ âœ—    â”‚ âœ“      â”‚ {æ·±æ‹·è´}  â”‚  â† ä½¿ç”¨ä¸­     â”‚   â”‚
â”‚   â”‚  â”‚ ad_3â”‚ âœ—    â”‚ âœ—      â”‚ {æ·±æ‹·è´}  â”‚  â† å¯ç”¨       â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                 â”‚
â”‚                     acquire() è·å–+åŠ é”                     â”‚
â”‚                           â”‚                                 â”‚
â”‚                           â†“                                 â”‚
â”‚                    è¿”å›æ·±æ‹·è´å‰¯æœ¬                            â”‚
â”‚                           â”‚                                 â”‚
â”‚                     å®ä¾‹åŒ–é¢„åˆ¶ä½“                             â”‚
â”‚                           â”‚                                 â”‚
â”‚                     consume() æ ‡è®°å·²ç”¨                       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜æ ¸å¿ƒç‰¹ç‚¹ ç‰¹æ€§  è¯´æ˜  æ·±æ‹·è´  æ¯æ¬¡è·å–éƒ½æ˜¯ç‹¬ç«‹å‰¯æœ¬ï¼Œä¿®æ”¹ä¸å½±å“åŸæ•°æ®  é”æœºåˆ¶  locked é˜²æ­¢åŒä¸€æ•°æ®è¢«å¤šä¸ªå®ä¾‹åŒæ—¶è·å–  ä¸€æ¬¡æ€§æ¶ˆè´¹  used æ ‡è®°ç¡®ä¿æ•°æ®åªè¢«ä½¿ç”¨ä¸€æ¬¡  é˜Ÿåˆ—ç®¡ç†  æ”¯æŒå¤šä¸ªå¹¿å‘Šæ•°æ®æ’é˜Ÿç­‰å¾…ä½¿ç”¨  çŠ¶æ€è¿½è¸ª  å¯æŸ¥çœ‹æ¯ä¸ªæ•°æ®çš„ä½¿ç”¨çŠ¶æ€  è‡ªåŠ¨æ¸…ç†  clearUsed() æ¸…ç†å·²æ¶ˆè´¹çš„æ•°æ® è¿™æ ·æ¯ä¸ªå¹¿å‘Šå®ä¾‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ•°æ®å‰¯æœ¬ï¼Œå®Œå…¨éš”ç¦»ï¼Œä¸ä¼šäº’ç›¸å½±å“ï¼å·¥å‚æ¨¡å¼manageè¦æŒ‚åœ¨é‚£ä¸ªè„šæœ¬ä¸Šï¼Ÿå·¥å‚æ¨¡å¼manageè¦æŒ‚åœ¨é‚£ä¸ªè„šæœ¬ä¸Šï¼Ÿæ·±åº¦æ€è€ƒ Â· 25sç”¨æˆ·é—®å·¥å‚æ¨¡å¼çš„ AdManager ç®¡ç†å™¨åº”è¯¥æŒ‚è½½åœ¨å“ªä¸ªè„šæœ¬/èŠ‚ç‚¹ä¸Šã€‚æ ¹æ®é¡¹ç›®ç»“æ„ï¼Œæœ‰å‡ ä¸ªé€‰æ‹©ï¼šæŒ‚åœ¨ Canvas ä¸Š - å› ä¸ºå¹¿å‘Šæ˜¯ UI å…ƒç´ ï¼ŒæŒ‚åœ¨ Canvas ä¸Šæ¯”è¾ƒåˆç†æŒ‚åœ¨ mainCanvas è„šæœ¬æ‰€åœ¨çš„èŠ‚ç‚¹ä¸Š - å› ä¸º mainCanvas æ˜¯ä¸»å…¥å£åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ç®¡ç†èŠ‚ç‚¹ - æ¯”å¦‚ "AdManager" èŠ‚ç‚¹ä¸æŒ‚è½½ï¼Œä½¿ç”¨çº¯é™æ€å•ä¾‹ - ä¸éœ€è¦ç»§æ‰¿ Componentè€ƒè™‘åˆ°ï¼šAdManager éœ€è¦æŒæœ‰é¢„åˆ¶ä½“å¼•ç”¨ï¼ˆPrefabï¼‰éœ€è¦åœ¨åœºæ™¯ä¸­æŒä¹…å­˜åœ¨éœ€è¦è®¿é—® Canvas æ·»åŠ å­èŠ‚ç‚¹æœ€ä½³æ–¹æ¡ˆæ˜¯ï¼šç®€å•æ–¹æ¡ˆï¼šç›´æ¥åœ¨ mainCanvas æˆ– Canvas ä¸Šæ·»åŠ è§„èŒƒæ–¹æ¡ˆï¼šåˆ›å»ºç‹¬ç«‹çš„ "AdManager" èŠ‚ç‚¹æŒ‚è½½è®©æˆ‘ç»™å‡ºå…·ä½“å»ºè®®ã€‚æ ¹æ®é¡¹ç›®ç»“æ„ï¼Œæœ‰å‡ ç§æŒ‚è½½æ–¹å¼ï¼šæ–¹æ¡ˆå¯¹æ¯” æ–¹æ¡ˆ  æŒ‚è½½ä½ç½®  ä¼˜ç‚¹  ç¼ºç‚¹  æ–¹æ¡ˆ1  Canvas èŠ‚ç‚¹  ç®€å•ï¼Œç›´æ¥è®¿é—®UIå±‚  èŒè´£æ··æ‚  æ–¹æ¡ˆ2  ç‹¬ç«‹ AdManager èŠ‚ç‚¹  æ¸…æ™°åˆ†ç¦»ï¼Œæ˜“ç»´æŠ¤  å¤šä¸€ä¸ªèŠ‚ç‚¹  æ–¹æ¡ˆ3  mainCanvas ç»„ä»¶  å·²æœ‰å…¥å£ï¼Œæ”¹åŠ¨å°‘  è€¦åˆåº¦é«˜  æ–¹æ¡ˆ4  çº¯é™æ€ç±»ï¼ˆä¸æŒ‚è½½ï¼‰  æ— éœ€èŠ‚ç‚¹ï¼Œå…¨å±€è®¿é—®  æ— æ³•å¼•ç”¨é¢„åˆ¶ä½“ æ¨èï¼šæ–¹æ¡ˆ2 - ç‹¬ç«‹èŠ‚ç‚¹ï¼ˆæœ€è§„èŒƒï¼‰åœºæ™¯å±‚çº§ç»“æ„plaintextmain (Scene)
â”œâ”€â”€ core
â”œâ”€â”€ Canvas
â”‚   â”œâ”€â”€ panelRoot
â”‚   â”œâ”€â”€ loading
â”‚   â”œâ”€â”€ ...
â”‚   â””â”€â”€ AdManager   â† æ–°å»ºèŠ‚ç‚¹ï¼ŒæŒ‚è½½ AdManager ç»„ä»¶
â””â”€â”€ UICamera_Canvasåˆ›å»ºæ­¥éª¤åœ¨ Cocos Creator ç¼–è¾‘å™¨ä¸­ï¼šæ‰“å¼€ main.sceneåœ¨ Canvas ä¸‹å³é”® â†’ åˆ›å»º â†’ ç©ºèŠ‚ç‚¹å‘½åä¸º AdManageræŒ‚è½½ç»„ä»¶ï¼šé€‰ä¸­ AdManager èŠ‚ç‚¹æ·»åŠ è‡ªå®šä¹‰ç»„ä»¶ AdManagerå°†å¹¿å‘Šé¢„åˆ¶ä½“æ‹–åˆ° adPrefab å±æ€§ä¸Šæ–‡ä»¶ä½ç½®æ ¹æ®é¡¹ç›®ç»“æ„ï¼Œå»ºè®®æ”¾åœ¨ framework ç›®å½•ï¼šplaintextassets/script/
â”œâ”€â”€ framework/
â”‚   â”œâ”€â”€ AdManager.ts      â† å¹¿å‘Šç®¡ç†å™¨
â”‚   â”œâ”€â”€ AdDataManager.ts  â† æ•°æ®æ± ç®¡ç†å™¨ï¼ˆçº¯é™æ€ï¼Œä¸éœ€æŒ‚è½½ï¼‰
â”‚   â”œâ”€â”€ uiManager.ts
â”‚   â””â”€â”€ ...æˆ–è€…ï¼šæ–¹æ¡ˆ4 - çº¯é™æ€ç±»ï¼ˆæœ€ç®€å•ï¼‰å¦‚æœä¸æƒ³åˆ›å»ºæ–°èŠ‚ç‚¹ï¼Œå¯ä»¥æ”¹æˆçº¯é™æ€ç±»ï¼Œé€šè¿‡ä»£ç åŠ è½½é¢„åˆ¶ä½“ï¼štypescript// AdManager.ts - ä¸ç»§æ‰¿ Componentï¼Œæ— éœ€æŒ‚è½½

import { Prefab, Node, instantiate, find, Layers, resources } from 'cc';
import { adDataManager } from './AdDataManager';

export class AdManager {
    private static _adPrefab: Prefab | null = null;

    /**
     * åˆå§‹åŒ–ï¼ˆåŠ è½½é¢„åˆ¶ä½“ï¼‰
     */
    public static async init(): Promise<void> {
        return new Promise((resolve, reject) => {
            resources.load('prefab/ui/InitAd', Prefab, (err, prefab) => {
                if (err) {
                    console.error("[AdManager] åŠ è½½å¹¿å‘Šé¢„åˆ¶ä½“å¤±è´¥:", err);
                    reject(err);
                    return;
                }
                this._adPrefab = prefab;
                console.log("[AdManager] åˆå§‹åŒ–å®Œæˆ");
                resolve();
            });
        });
    }

    /**
     * åˆ›å»ºå¹¿å‘Šå®ä¾‹
     */
    public static createAd(options?: {
        parent?: Node;
        position?: { x: number; y: number };
        onClose?: () => void;
    }): Node | null {
        if (!this._adPrefab) {
            console.error("[AdManager] é¢„åˆ¶ä½“æœªåŠ è½½ï¼Œè¯·å…ˆè°ƒç”¨ init()");
            return null;
        }

        // è·å–å¹¿å‘Šæ•°æ®
        const result = adDataManager.acquire();
        if (!result) {
            console.error("[AdManager] æ²¡æœ‰å¯ç”¨çš„å¹¿å‘Šæ•°æ®");
            return null;
        }

        // å®ä¾‹åŒ–
        const adNode = instantiate(this._adPrefab);
        
        // æ·»åŠ åˆ° Canvas
        const parent = options?.parent || find("Canvas");
        if (parent) {
            parent.addChild(adNode);
        }

        // è®¾ç½® Layer
        this.setLayerRecursively(adNode, Layers.Enum.UI_2D);

        // è®¾ç½®ä½ç½®
        const pos = options?.position || { x: 0, y: 0 };
        adNode.setPosition(pos.x, pos.y, 0);
        adNode.setSiblingIndex(9999);

        // æ¶ˆè´¹æ•°æ®
        adDataManager.consume(result.id);

        console.log("[AdManager] åˆ›å»ºå¹¿å‘ŠæˆåŠŸ");
        return adNode;
    }

    private static setLayerRecursively(node: Node, layer: number) {
        node.layer = layer;
        node.children.forEach(child => this.setLayerRecursively(child, layer));
    }
}ä½¿ç”¨æ–¹å¼typescript// åœ¨ mainCanvas.ts çš„ start() ä¸­åˆå§‹åŒ–
import { AdManager } from './framework/AdManager';

async start() {
    // åˆå§‹åŒ–å¹¿å‘Šç®¡ç†å™¨
    await AdManager.init();
    
    // åˆ›å»ºå¹¿å‘Š
    AdManager.createAd({
        position: { x: 0, y: 100 }
    });
}æ€»ç»“å»ºè®® åœºæ™¯  æ¨èæ–¹æ¡ˆ  æ­£å¼é¡¹ç›®ï¼Œéœ€è¦ç¼–è¾‘å™¨æ‹–æ‹½é¢„åˆ¶ä½“  æ–¹æ¡ˆ2ï¼šç‹¬ç«‹ AdManager èŠ‚ç‚¹  å¿«é€Ÿå¼€å‘ï¼Œä»£ç åŠ è½½é¢„åˆ¶ä½“  æ–¹æ¡ˆ4ï¼šçº¯é™æ€ç±»  æ”¹åŠ¨æœ€å°  æ–¹æ¡ˆ3ï¼šé›†æˆåˆ° mainCanvas å¦‚æœé€‰æ‹©æ–¹æ¡ˆ2ï¼Œåœ¨ Canvas ä¸‹åˆ›å»º AdManager ç©ºèŠ‚ç‚¹å¹¶æŒ‚è½½ç»„ä»¶å³å¯ã€‚å¦‚æœé€‰æ‹©æ–¹æ¡ˆ4ï¼Œä¸éœ€è¦æŒ‚è½½ä»»ä½•èŠ‚ç‚¹ï¼Œç›´æ¥åœ¨ä»£ç ä¸­è°ƒç”¨ AdManager.init() å’Œ AdManager.createAd()ã€‚ä½ å€¾å‘äºå“ªç§æ–¹å¼ï¼Ÿå°±å®ç°å…¨å±€å¯¹è±¡,è®¾ç½®å¯¹è±¡å­˜å‚¨æ•°æ®ï¼Œä¸€ä¸ªé¡µé¢å¯ä»¥åŠ¨æ€åˆ›å»ºå¤šä¸ªé¢„åˆ¶ä½“å¹¿å‘Šï¼ŒåŠ¨æ€ç»‘å®šäº‹ä»¶ï¼Œå®ç°åŠŸèƒ½ï¼Œè¶Šç®€å•è¶Šå¥½å°±å®ç°å…¨å±€å¯¹è±¡,è®¾ç½®å¯¹è±¡å­˜å‚¨æ•°æ®ï¼Œä¸€ä¸ªé¡µé¢å¯ä»¥åŠ¨æ€åˆ›å»ºå¤šä¸ªé¢„åˆ¶ä½“å¹¿å‘Šï¼ŒåŠ¨æ€ç»‘å®šäº‹ä»¶ï¼Œå®ç°åŠŸèƒ½ï¼Œè¶Šç®€å•è¶Šå¥½æ·±åº¦æ€è€ƒ Â· 29sç”¨æˆ·æƒ³è¦ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆï¼šå…¨å±€å¯¹è±¡å­˜å‚¨å¹¿å‘Šæ•°æ®ä¸€ä¸ªé¡µé¢å¯ä»¥åŠ¨æ€åˆ›å»ºå¤šä¸ªå¹¿å‘Šé¢„åˆ¶ä½“åŠ¨æ€ç»‘å®šäº‹ä»¶è¶Šç®€å•è¶Šå¥½è®©æˆ‘è®¾è®¡ä¸€ä¸ªæœ€ç®€å•çš„æ–¹æ¡ˆï¼Œä¸éœ€è¦å¤ªå¤æ‚çš„ç®¡ç†å™¨ã€‚å¥½çš„ï¼Œæœ€ç®€å•çš„æ–¹æ¡ˆï¼åªéœ€è¦ä¸¤ä¸ªæ–‡ä»¶ï¼š1. å…¨å±€å¹¿å‘Šæ•°æ®ç®¡ç†ï¼ˆæ–°å»ºæ–‡ä»¶ï¼‰æ–‡ä»¶è·¯å¾„: assets/script/framework/AdData.tstypescript/**
 * å…¨å±€å¹¿å‘Šæ•°æ®ç®¡ç† - æç®€ç‰ˆ
 */

interface AdInfo {
    data: any;
    used: boolean;
}

class AdData {
    private _pool: AdInfo[] = [];

    /** æ·»åŠ å¹¿å‘Šæ•°æ®ï¼ˆè‡ªåŠ¨æ·±æ‹·è´ï¼‰ */
    add(data: any): number {
        const copied = JSON.parse(JSON.stringify(data));
        this._pool.push({ data: copied, used: false });
        return this._pool.length - 1;
    }

    /** è·å–ä¸€ä¸ªæœªä½¿ç”¨çš„æ•°æ®ï¼ˆæ·±æ‹·è´ï¼‰ */
    acquire(): any {
        for (const item of this._pool) {
            if (!item.used) {
                item.used = true;
                return JSON.parse(JSON.stringify(item.data));
            }
        }
        return null;
    }

    /** ä»å…¨å±€ window è·å–å¹¶æ·»åŠ  */
    addFromWindow(): any {
        if (window['NativeAdData']) {
            const data = window['NativeAdData'];
            window['NativeAdData'] = null;  // æ¸…ç©ºé˜²é‡å¤
            this.add(data);
            return data;
        }
        return null;
    }

    /** è·å–å¯ç”¨æ•°é‡ */
    get available(): number {
        return this._pool.filter(item => !item.used).length;
    }

    /** æ¸…ç©º */
    clear() {
        this._pool = [];
    }
}

export const adData = new AdData();2. æ”¹é€  prefabload.tsæ–‡ä»¶è·¯å¾„: assets/script/prefabload.tstypescriptimport { _decorator, Component, Node, Sprite, Label, assetManager, Texture2D, SpriteFrame, ImageAsset, Button } from 'cc';
import { adData } from './framework/AdData';

const { ccclass, property } = _decorator;

@ccclass('Prefabload')
export class Prefabload extends Component {

    @property(Sprite)
    MD_ad_img: Sprite = null!;
    @property(Label)
    MD_ad_title: Label = null!;
    @property(Sprite)
    MD_ad_icon: Sprite = null!;
    @property(Label)
    MD_ad_desc: Label = null!;
    @property(Label)
    MD_ad_source: Label = null!;

    // å½“å‰å®ä¾‹çš„æ•°æ®ï¼ˆç‹¬ç«‹å‰¯æœ¬ï¼‰
    private _data: any = null;

    /**
     * åˆå§‹åŒ–æ–¹æ³• - å¤–éƒ¨è°ƒç”¨ï¼Œä¼ å…¥æ•°æ®
     */
    init(data?: any) {
        // ä¼˜å…ˆä½¿ç”¨ä¼ å…¥çš„æ•°æ®ï¼Œå¦åˆ™ä»æ± ä¸­è·å–
        this._data = data || adData.acquire();
        
        if (!this._data) {
            console.error("æ²¡æœ‰å¯ç”¨çš„å¹¿å‘Šæ•°æ®");
            return;
        }

        this.fillData();
        this.bindEvents();
    }

    /** å¡«å……æ•°æ® */
    private fillData() {
        const d = this._data;
        if (!d) return;

        if (this.MD_ad_title) this.MD_ad_title.string = d.title || "";
        if (this.MD_ad_source) this.MD_ad_source.string = d.source || "";
        if (this.MD_ad_desc) this.MD_ad_desc.string = d.desc || "";
        
        if (d.imgUrlList?.[0]) this.loadImg(d.imgUrlList[0], this.MD_ad_img);
        if (d.icon) this.loadImg(d.icon, this.MD_ad_icon);
    }

    /** åŠ¨æ€ç»‘å®šäº‹ä»¶ */
    private bindEvents() {
        // ç»‘å®šæ•´ä¸ªå¹¿å‘Šç‚¹å‡» - æ‰“å¼€è¯¦æƒ…
        this.node.on(Node.EventType.TOUCH_END, () => {
            this.openUrl(this._data?.appDetailUrl);
        }, this);
    }

    /** æ‰“å¼€é“¾æ¥ */
    openUrl(url?: string) {
        if (!url) return;
        console.log("æ‰“å¼€é“¾æ¥:", url);
        window.qg?.openDeeplink?.({ uri: url });
    }

    /** åŠ è½½è¿œç¨‹å›¾ç‰‡ */
    private loadImg(url: string, sprite: Sprite) {
        if (!url || !sprite) return;
        assetManager.loadRemote<ImageAsset>(url, (err, image) => {
            if (!err && sprite.isValid) {
                const texture = new Texture2D();
                texture.image = image;
                const spriteFrame = new SpriteFrame();
                spriteFrame.texture = texture;
                sprite.spriteFrame = spriteFrame;
                sprite.sizeMode = Sprite.SizeMode.CUSTOM;
            }
        });
    }

    /** å…³é—­å¹¿å‘Š */
    close() {
        this.node.destroy();
    }

    /** æ‰“å¼€æƒé™é¡µ */
    openPermission() {
        this.openUrl(this._data?.permissionUrl);
    }

    /** æ‰“å¼€éšç§é¡µ */
    openPrivacy() {
        this.openUrl(this._data?.privacyUrl);
    }
}3. ä½¿ç”¨ç¤ºä¾‹ï¼ˆåœ¨ mainCanvas.ts ä¸­ï¼‰typescriptimport { adData } from './framework/AdData';
import { Prefabload } from './prefabload';

// ========== æ·»åŠ æ•°æ® ==========

// æ–¹å¼1: ä» window è·å–
adData.addFromWindow();

// æ–¹å¼2: ç›´æ¥æ·»åŠ 
adData.add({ 
    title: "æµ‹è¯•å¹¿å‘Š", 
    imgUrlList: ["http://..."],
    appDetailUrl: "app://..." 
});

// ========== åˆ›å»ºå¹¿å‘Šå®ä¾‹ ==========

// åˆ›å»ºä¸€ä¸ªå¹¿å‘Š
const ad1 = instantiate(this.adPrefab);
find("Canvas").addChild(ad1);
ad1.getComponent(Prefabload)?.init();  // è‡ªåŠ¨ä»æ± ä¸­è·å–æ•°æ®

// åˆ›å»ºå¦ä¸€ä¸ªå¹¿å‘Šï¼ˆä¼ å…¥è‡ªå®šä¹‰æ•°æ®ï¼‰
const ad2 = instantiate(this.adPrefab);
find("Canvas").addChild(ad2);
ad2.setPosition(0, -200, 0);
ad2.getComponent(Prefabload)?.init({
    title: "è‡ªå®šä¹‰å¹¿å‘Š",
    imgUrlList: ["http://custom.jpg"],
    appDetailUrl: "app://custom"
});

// æ‰¹é‡åˆ›å»º
for (let i = 0; i < 3; i++) {
    const ad = instantiate(this.adPrefab);
    find("Canvas").addChild(ad);
    ad.setPosition(0, 100 - i * 150, 0);
    ad.getComponent(Prefabload)?.init();
}æ ¸å¿ƒæµç¨‹plaintextâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ä½¿ç”¨æµç¨‹                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  1. æ·»åŠ æ•°æ®                                      â”‚
â”‚     adData.add(data)                             â”‚
â”‚     adData.addFromWindow()                       â”‚
â”‚                                                  â”‚
â”‚  2. å®ä¾‹åŒ–é¢„åˆ¶ä½“                                  â”‚
â”‚     const ad = instantiate(prefab)               â”‚
â”‚     canvas.addChild(ad)                          â”‚
â”‚                                                  â”‚
â”‚  3. åˆå§‹åŒ–ç»„ä»¶                                    â”‚
â”‚     ad.getComponent(Prefabload).init()           â”‚
â”‚     â†“                                            â”‚
â”‚     è‡ªåŠ¨è·å–æ•°æ®ï¼ˆæ·±æ‹·è´ï¼‰                         â”‚
â”‚     è‡ªåŠ¨å¡«å……UI                                    â”‚
â”‚     è‡ªåŠ¨ç»‘å®šäº‹ä»¶                                  â”‚
â”‚                                                  â”‚
â”‚  4. å®Œæˆï¼æ¯ä¸ªå®ä¾‹æ•°æ®ç‹¬ç«‹                         â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ç‰¹ç‚¹ ç‰¹æ€§  å®ç°  æ·±æ‹·è´  JSON.parse(JSON.stringify())  è‡ªåŠ¨è·å–  init() è‡ªåŠ¨ä»æ± ä¸­å–æ•°æ®  æ‰‹åŠ¨æŒ‡å®š  init(customData) ä¼ å…¥è‡ªå®šä¹‰æ•°æ®  äº‹ä»¶ç»‘å®š  bindEvents() ä»£ç åŠ¨æ€ç»‘å®š  ä¸€æ¬¡æ¶ˆè´¹  used æ ‡è®°ï¼ŒåŒä¸€æ•°æ®ä¸é‡å¤ä½¿ç”¨ åªéœ€è¦è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå°±èƒ½å®ç°å¤šå®ä¾‹å¹¿å‘Šçš„åŠ¨æ€åˆ›å»ºï¼assets/script/framework/AdData.tsè¿™ä¸ªtså¯ä»¥ä¸ç”¨æŒ‚åœ¨è„šæœ¬ä¸Šï¼Œç›´æ¥å¼•ç”¨å—ï¼Ÿassets/script/framework/AdData.tsè¿™ä¸ªtså¯ä»¥ä¸ç”¨æŒ‚åœ¨è„šæœ¬ä¸Šï¼Œç›´æ¥å¼•ç”¨å—ï¼Ÿæ·±åº¦æ€è€ƒ Â· 11sç”¨æˆ·é—®çš„æ˜¯ AdData.ts æ˜¯å¦å¯ä»¥ä¸æŒ‚è½½åˆ°ä»»ä½•èŠ‚ç‚¹ä¸Šï¼Œç›´æ¥é€šè¿‡ import å¼•ç”¨ä½¿ç”¨ã€‚ç­”æ¡ˆæ˜¯ï¼šæ˜¯çš„ï¼Œå®Œå…¨å¯ä»¥ï¼å› ä¸º AdData.tsï¼šæ²¡æœ‰ç»§æ‰¿ Componentæ˜¯ä¸€ä¸ªçº¯ TypeScript ç±»å¯¼å‡ºçš„æ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡ adDataä¸ä¾èµ–ä»»ä½• Cocos Creator çš„ç”Ÿå‘½å‘¨æœŸè¿™ç§æ¨¡å¼å«åš"çº¯æ•°æ®ç±»"æˆ–"å·¥å…·ç±»"ï¼Œåœ¨ Cocos Creator ä¸­å¾ˆå¸¸è§ï¼Œæ¯”å¦‚ï¼šé…ç½®ç®¡ç†æ•°æ®å­˜å‚¨å·¥å…·å‡½æ•°äº‹ä»¶æ€»çº¿åªéœ€è¦ import å°±èƒ½ç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦æŒ‚è½½åˆ°ä»»ä½•èŠ‚ç‚¹ä¸Šã€‚æ˜¯çš„ï¼Œå®Œå…¨å¯ä»¥ï¼ ä¸éœ€è¦æŒ‚è½½åˆ°ä»»ä½•èŠ‚ç‚¹ä¸Šã€‚åŸå› AdData.ts æ˜¯ä¸€ä¸ªçº¯ TypeScript ç±»ï¼Œä¸æ˜¯ Cocos ç»„ä»¶ï¼štypescript// âœ… æ™®é€šç±» - ä¸éœ€è¦æŒ‚è½½
class AdData {
    // ...
}
export const adData = new AdData();

// âŒ ç»„ä»¶ç±» - éœ€è¦æŒ‚è½½åˆ°èŠ‚ç‚¹
@ccclass('XXX')
export class XXX extends Component {
    // ...
}åŒºåˆ« ç±»å‹  ç»§æ‰¿  éœ€è¦æŒ‚è½½  ä½¿ç”¨æ–¹å¼  çº¯ç±»/å·¥å…·ç±»  æ—   âŒ ä¸éœ€è¦  import ç›´æ¥ç”¨  ç»„ä»¶ç±»  Component  âœ… éœ€è¦  æŒ‚è½½åˆ°èŠ‚ç‚¹ ç›´æ¥ä½¿ç”¨typescript// åœ¨ä»»ä½• .ts æ–‡ä»¶ä¸­ç›´æ¥å¼•ç”¨
import { adData } from './framework/AdData';

// ç›´æ¥è°ƒç”¨
adData.add({ title: "å¹¿å‘Š1" });
adData.addFromWindow();
const data = adData.acquire();å¸¸è§çš„ä¸éœ€è¦æŒ‚è½½çš„ç±»plaintextassets/script/framework/
â”œâ”€â”€ AdData.ts       â† çº¯æ•°æ®ç®¡ç†ï¼Œä¸æŒ‚è½½
â”œâ”€â”€ clientEvent.ts  â† äº‹ä»¶æ€»çº¿ï¼Œä¸æŒ‚è½½
â”œâ”€â”€ gameStorage.ts  â† æœ¬åœ°å­˜å‚¨ï¼Œä¸æŒ‚è½½
â”œâ”€â”€ Constants.ts    â† å¸¸é‡é…ç½®ï¼Œä¸æŒ‚è½½
â””â”€â”€ uiManager.ts    â† å¯èƒ½éœ€è¦æŒ‚è½½ï¼ˆå¦‚æœç»§æ‰¿Componentï¼‰æ€»ç»“âœ… AdData.ts ä¸éœ€è¦æŒ‚è½½ï¼Œç›´æ¥ import { adData } å°±èƒ½åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè®¾è®¡æˆè¿™ç§ç®€å•æ¨¡å¼ - å…¨å±€å•ä¾‹ï¼Œéšå¤„å¯ç”¨ã€‚æ ¹æ®ä¸Šé¢å†ç®€æ˜“è¿›è¡Œæ”¹é€ ï¼Œå®ç°é¢„åˆ¶ä½“å¯ä»¥å®ä¾‹åŒ–ï¼Œç„¶åç»‘å®šï¼Œè€Œä¸æ˜¯åªèƒ½ç»‘æ­»ä¸€ä¸ªé¢„åˆ¶ä½“ï¼Œå¯ä»¥ç»‘å®šå¤šä¸ªé¢„åˆ¶ä½“å¹¿å‘Šæ ¹æ®ä¸Šé¢å†ç®€æ˜“è¿›è¡Œæ”¹é€ ï¼Œå®ç°é¢„åˆ¶ä½“å¯ä»¥å®ä¾‹åŒ–ï¼Œç„¶åç»‘å®šï¼Œè€Œä¸æ˜¯åªèƒ½ç»‘æ­»ä¸€ä¸ªé¢„åˆ¶ä½“ï¼Œå¯ä»¥ç»‘å®šå¤šä¸ªé¢„åˆ¶ä½“å¹¿å‘Šæ·±åº¦æ€è€ƒ Â· 40sç”¨æˆ·æƒ³è¦æ›´çµæ´»çš„è®¾è®¡ï¼šä¸åªæ˜¯ç»‘å®šä¸€ä¸ªé¢„åˆ¶ä½“ï¼Œå¯ä»¥æ”¯æŒå¤šä¸ªä¸åŒçš„é¢„åˆ¶ä½“é¢„åˆ¶ä½“å¯ä»¥åŠ¨æ€å®ä¾‹åŒ–æ¯ä¸ªé¢„åˆ¶ä½“å®ä¾‹åŒ–åå¯ä»¥ç‹¬ç«‹ç»‘å®šæ•°æ®è®©æˆ‘è®¾è®¡ä¸€ä¸ªæ›´ç®€æ´çµæ´»çš„æ–¹æ¡ˆã€‚æ˜ç™½ï¼è®©è®¾è®¡æ›´çµæ´» - æ”¯æŒå¤šç§é¢„åˆ¶ä½“ï¼ŒåŠ¨æ€åŠ è½½å’Œå®ä¾‹åŒ–ã€‚1. AdData.ts - å¢å¼ºç‰ˆï¼ˆæ”¯æŒå¤šé¢„åˆ¶ä½“ï¼‰æ–‡ä»¶è·¯å¾„: assets/script/framework/AdData.tstypescript/**
 * å…¨å±€å¹¿å‘Šç®¡ç† - ç®€æ˜“ç‰ˆ
 * æ”¯æŒï¼šæ•°æ®æ±  + å¤šé¢„åˆ¶ä½“ + åŠ¨æ€å®ä¾‹åŒ–
 */

import { Prefab, Node, instantiate, find, Layers, resources } from 'cc';

interface AdInfo {
    data: any;
    used: boolean;
}

class AdData {
    // æ•°æ®æ± 
    private _pool: AdInfo[] = [];
    
    // é¢„åˆ¶ä½“ç¼“å­˜ { åç§°: Prefab }
    private _prefabs: Map<string, Prefab> = new Map();

    // ==================== æ•°æ®ç®¡ç† ====================

    /** æ·»åŠ å¹¿å‘Šæ•°æ®ï¼ˆæ·±æ‹·è´ï¼‰ */
    add(data: any): number {
        const copied = JSON.parse(JSON.stringify(data));
        this._pool.push({ data: copied, used: false });
        console.log("[AdData] æ·»åŠ æ•°æ®ï¼Œå½“å‰æ± :", this._pool.length);
        return this._pool.length - 1;
    }

    /** è·å–ä¸€ä¸ªæœªä½¿ç”¨çš„æ•°æ®ï¼ˆæ·±æ‹·è´ï¼‰ */
    acquire(): any {
        for (const item of this._pool) {
            if (!item.used) {
                item.used = true;
                return JSON.parse(JSON.stringify(item.data));
            }
        }
        console.warn("[AdData] æ²¡æœ‰å¯ç”¨æ•°æ®");
        return null;
    }

    /** ä» window è·å–å¹¶æ·»åŠ  */
    addFromWindow(): any {
        const data = window['NativeAdData'];
        if (data) {
            window['NativeAdData'] = null;
            this.add(data);
            return data;
        }
        return null;
    }

    /** é‡ç½®æ‰€æœ‰æ•°æ®ä¸ºæœªä½¿ç”¨ */
    reset() {
        this._pool.forEach(item => item.used = false);
    }

    /** æ¸…ç©ºæ•°æ® */
    clear() {
        this._pool = [];
    }

    /** å¯ç”¨æ•°é‡ */
    get available(): number {
        return this._pool.filter(item => !item.used).length;
    }

    // ==================== é¢„åˆ¶ä½“ç®¡ç† ====================

    /**
     * åŠ è½½é¢„åˆ¶ä½“ï¼ˆæ”¯æŒå¤šä¸ªï¼‰
     * @param name é¢„åˆ¶ä½“åç§°ï¼ˆç”¨äºåç»­è·å–ï¼‰
     * @param path èµ„æºè·¯å¾„ï¼ˆä¸å«åç¼€ï¼‰
     */
    loadPrefab(name: string, path: string): Promise<Prefab> {
        return new Promise((resolve, reject) => {
            // å·²ç¼“å­˜ç›´æ¥è¿”å›
            if (this._prefabs.has(name)) {
                resolve(this._prefabs.get(name)!);
                return;
            }

            resources.load(path, Prefab, (err, prefab) => {
                if (err) {
                    console.error(`[AdData] åŠ è½½é¢„åˆ¶ä½“å¤±è´¥: ${path}`, err);
                    reject(err);
                    return;
                }
                this._prefabs.set(name, prefab);
                console.log(`[AdData] é¢„åˆ¶ä½“å·²ç¼“å­˜: ${name}`);
                resolve(prefab);
            });
        });
    }

    /**
     * åˆ›å»ºå¹¿å‘Šå®ä¾‹
     * @param prefabName é¢„åˆ¶ä½“åç§°ï¼ˆéœ€å…ˆ loadPrefabï¼‰
     * @param data å¯é€‰ï¼ŒæŒ‡å®šæ•°æ®ï¼ˆä¸ä¼ åˆ™ä»æ± ä¸­è·å–ï¼‰
     * @param options ä½ç½®ç­‰é€‰é¡¹
     */
    create(prefabName: string, data?: any, options?: {
        parent?: Node;
        x?: number;
        y?: number;
    }): Node | null {
        const prefab = this._prefabs.get(prefabName);
        if (!prefab) {
            console.error(`[AdData] é¢„åˆ¶ä½“æœªåŠ è½½: ${prefabName}`);
            return null;
        }

        // è·å–æ•°æ®
        const adData = data || this.acquire();
        if (!adData) {
            console.error("[AdData] æ²¡æœ‰å¯ç”¨çš„å¹¿å‘Šæ•°æ®");
            return null;
        }

        // å®ä¾‹åŒ–
        const node = instantiate(prefab);
        
        // æ·»åŠ åˆ°çˆ¶èŠ‚ç‚¹
        const parent = options?.parent || find("Canvas");
        parent?.addChild(node);

        // è®¾ç½® Layer ä¸º UI_2D
        this._setLayer(node, Layers.Enum.UI_2D);

        // è®¾ç½®ä½ç½®
        node.setPosition(options?.x || 0, options?.y || 0, 0);
        node.setSiblingIndex(9999);

        // è°ƒç”¨ç»„ä»¶çš„ init æ–¹æ³•ï¼ˆå¦‚æœæœ‰ï¼‰
        const comp = node.getComponent('Prefabload') as any;
        comp?.init?.(adData);

        console.log(`[AdData] åˆ›å»ºå¹¿å‘Š: ${prefabName}`);
        return node;
    }

    /** é€’å½’è®¾ç½® Layer */
    private _setLayer(node: Node, layer: number) {
        node.layer = layer;
        node.children.forEach(child => this._setLayer(child, layer));
    }
}

// å¯¼å‡ºå…¨å±€å•ä¾‹
export const adData = new AdData();2. prefabload.ts - é€šç”¨å¹¿å‘Šç»„ä»¶typescriptimport { _decorator, Component, Node, Sprite, Label, assetManager, Texture2D, SpriteFrame, ImageAsset } from 'cc';
const { ccclass, property } = _decorator;

@ccclass('Prefabload')
export class Prefabload extends Component {

    @property(Sprite)
    MD_ad_img: Sprite = null!;
    @property(Label)
    MD_ad_title: Label = null!;
    @property(Sprite)
    MD_ad_icon: Sprite = null!;
    @property(Label)
    MD_ad_desc: Label = null!;
    @property(Label)
    MD_ad_source: Label = null!;

    private _data: any = null;

    /** åˆå§‹åŒ– - ç”± adData.create() è°ƒç”¨ */
    init(data: any) {
        this._data = data;
        if (!data) return;

        // å¡«å……æ•°æ®
        if (this.MD_ad_title) this.MD_ad_title.string = data.title || "";
        if (this.MD_ad_source) this.MD_ad_source.string = data.source || "";
        if (this.MD_ad_desc) this.MD_ad_desc.string = data.desc || "";
        if (data.imgUrlList?.[0]) this.loadImg(data.imgUrlList[0], this.MD_ad_img);
        if (data.icon) this.loadImg(data.icon, this.MD_ad_icon);

        // ç»‘å®šç‚¹å‡»äº‹ä»¶
        this.node.on(Node.EventType.TOUCH_END, this.onClick, this);
    }

    private loadImg(url: string, sprite: Sprite) {
        if (!url || !sprite) return;
        assetManager.loadRemote<ImageAsset>(url, (err, image) => {
            if (!err && sprite.isValid) {
                const texture = new Texture2D();
                texture.image = image;
                const spriteFrame = new SpriteFrame();
                spriteFrame.texture = texture;
                sprite.spriteFrame = spriteFrame;
                sprite.sizeMode = Sprite.SizeMode.CUSTOM;
            }
        });
    }

    onClick() {
        this.openUrl(this._data?.appDetailUrl);
    }

    openUrl(url?: string) {
        if (url) window.qg?.openDeeplink?.({ uri: url });
    }

    openPermission() {
        this.openUrl(this._data?.permissionUrl);
    }

    openPrivacy() {
        this.openUrl(this._data?.privacyUrl);
    }

    close() {
        this.node.destroy();
    }
}3. ä½¿ç”¨ç¤ºä¾‹typescriptimport { adData } from './framework/AdData';

// ========== åˆå§‹åŒ–ï¼šåŠ è½½å¤šä¸ªé¢„åˆ¶ä½“ ==========

async start() {
    // åŠ è½½ä¸åŒçš„å¹¿å‘Šé¢„åˆ¶ä½“
    await adData.loadPrefab('initAd', 'prefab/ui/InitAd');       // åˆå§‹åŒ–å¹¿å‘Š
    await adData.loadPrefab('bannerAd', 'prefab/ui/BannerAd');   // æ¨ªå¹…å¹¿å‘Š
    await adData.loadPrefab('nativeAd', 'prefab/ui/NvAd-md');    // åŸç”Ÿå¹¿å‘Š
    
    console.log("æ‰€æœ‰é¢„åˆ¶ä½“åŠ è½½å®Œæˆ");
}

// ========== æ·»åŠ å¹¿å‘Šæ•°æ® ==========

// ä» window è·å–
adData.addFromWindow();

// æ‰‹åŠ¨æ·»åŠ å¤šä¸ª
adData.add({ title: "å¹¿å‘Š1", appDetailUrl: "url1", imgUrlList: ["img1"] });
adData.add({ title: "å¹¿å‘Š2", appDetailUrl: "url2", imgUrlList: ["img2"] });
adData.add({ title: "å¹¿å‘Š3", appDetailUrl: "url3", imgUrlList: ["img3"] });

// ========== åˆ›å»ºå¹¿å‘Šå®ä¾‹ ==========

// ä½¿ç”¨ä¸åŒé¢„åˆ¶ä½“åˆ›å»º
adData.create('initAd', null, { x: 0, y: 200 });    // åˆå§‹åŒ–å¹¿å‘Š
adData.create('bannerAd', null, { x: 0, y: 0 });    // æ¨ªå¹…å¹¿å‘Š
adData.create('nativeAd', null, { x: 0, y: -200 }); // åŸç”Ÿå¹¿å‘Š

// æŒ‡å®šæ•°æ®åˆ›å»º
adData.create('nativeAd', {
    title: "è‡ªå®šä¹‰å¹¿å‘Š",
    imgUrlList: ["http://custom.jpg"]
}, { x: 100, y: 100 });

// æ‰¹é‡åˆ›å»ºåŒç±»å‹
for (let i = 0; i < 3; i++) {
    adData.create('nativeAd', null, { y: 200 - i * 150 });
}æµç¨‹å›¾plaintextâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä½¿ç”¨æµç¨‹                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                        â”‚
â”‚  1. åŠ è½½é¢„åˆ¶ä½“ï¼ˆå¯å¤šä¸ªï¼‰                                 â”‚
â”‚     await adData.loadPrefab('initAd', 'prefab/...')    â”‚
â”‚     await adData.loadPrefab('banner', 'prefab/...')    â”‚
â”‚                                                        â”‚
â”‚  2. æ·»åŠ æ•°æ®                                            â”‚
â”‚     adData.add(data1)                                  â”‚
â”‚     adData.add(data2)                                  â”‚
â”‚     adData.addFromWindow()                             â”‚
â”‚                                                        â”‚
â”‚  3. åˆ›å»ºå®ä¾‹ï¼ˆé€‰æ‹©é¢„åˆ¶ä½“ + è‡ªåŠ¨/æ‰‹åŠ¨æ•°æ®ï¼‰               â”‚
â”‚     adData.create('initAd')        // è‡ªåŠ¨å–æ•°æ®        â”‚
â”‚     adData.create('banner', data)  // æŒ‡å®šæ•°æ®          â”‚
â”‚                                                        â”‚
â”‚  4. å†…éƒ¨è‡ªåŠ¨ï¼š                                          â”‚
â”‚     â†’ å®ä¾‹åŒ–é¢„åˆ¶ä½“                                      â”‚
â”‚     â†’ è®¾ç½® UI_2D Layer                                 â”‚
â”‚     â†’ è°ƒç”¨ init(data)                                  â”‚
â”‚     â†’ å¡«å……UI + ç»‘å®šäº‹ä»¶                                 â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜æ ¸å¿ƒä¼˜åŠ¿ ç‰¹æ€§  è¯´æ˜  å¤šé¢„åˆ¶ä½“  loadPrefab() æ”¯æŒåŠ è½½ä»»æ„æ•°é‡é¢„åˆ¶ä½“  æŒ‰åå–ç”¨  create('name') ç”¨åå­—é€‰æ‹©é¢„åˆ¶ä½“  æ•°æ®ç‹¬ç«‹  æ¯ä¸ªå®ä¾‹æ·±æ‹·è´ç‹¬ç«‹æ•°æ®  è‡ªåŠ¨ç»‘å®š  init() è‡ªåŠ¨å¡«å……UIå’Œç»‘å®šäº‹ä»¶  æç®€API  åªæœ‰3ä¸ªæ ¸å¿ƒæ–¹æ³• typescriptadData.loadPrefab(name, path)  // åŠ è½½
adData.add(data)               // æ·»åŠ æ•°æ®
adData.create(name, data?, options?)  // åˆ›å»ºè¿™æ ·å°±å¯ä»¥çµæ´»ç®¡ç†å¤šç§å¹¿å‘Šé¢„åˆ¶ä½“äº†ï¼ await adData.loadPrefab('initAd', 'prefab/ui/InitAd'), 'prefab/ui/InitAd'è¿™ä¸ªæ˜¯é¢„åˆ¶ä½“çš„åŠ è½½è·¯å¾„ï¼Œå¼•ç”¨åˆ°å¯¹åº”é¢„åˆ¶ä½“å—ï¼Ÿ await adData.loadPrefab('initAd', 'prefab/ui/InitAd'), 'prefab/ui/InitAd'è¿™ä¸ªæ˜¯é¢„åˆ¶ä½“çš„åŠ è½½è·¯å¾„ï¼Œå¼•ç”¨åˆ°å¯¹åº”é¢„åˆ¶ä½“å—ï¼Ÿæ·±åº¦æ€è€ƒ Â· 3sç”¨æˆ·é—®çš„æ˜¯ 'prefab/ui/InitAd' è¿™ä¸ªè·¯å¾„æ˜¯å¦èƒ½æ­£ç¡®åŠ è½½åˆ°é¢„åˆ¶ä½“ã€‚åœ¨ Cocos Creator ä¸­ï¼Œresources.load() åŠ è½½èµ„æºæ—¶ï¼šè·¯å¾„æ˜¯ç›¸å¯¹äº assets/resources/ ç›®å½•çš„ä¸éœ€è¦æ–‡ä»¶åç¼€ï¼ˆ.prefabï¼‰è·¯å¾„åŒºåˆ†å¤§å°å†™æ‰€ä»¥ 'prefab/ui/InitAd' å®é™…ä¸Šæ˜¯åŠ è½½ assets/resources/prefab/ui/InitAd.prefabè®©æˆ‘æ£€æŸ¥ä¸€ä¸‹é¡¹ç›®ä¸­é¢„åˆ¶ä½“çš„å®é™…ä½ç½®ã€‚è®©æˆ‘æ£€æŸ¥ä¸€ä¸‹é¡¹ç›®ä¸­é¢„åˆ¶ä½“çš„å®é™…è·¯å¾„ï¼šå·²æ¢ç´¢8ç›®å½•å·²æŸ¥çœ‹ç›®å½•ui8 ä¸ªç»“æœæ·±åº¦æ€è€ƒ Â· 6sé¢„åˆ¶ä½“ç¡®å®å­˜åœ¨äº assets/resources/prefab/ui/InitAd.prefabæ‰€ä»¥è·¯å¾„ 'prefab/ui/InitAd' æ˜¯æ­£ç¡®çš„ï¼šresources.load() çš„è·¯å¾„æ˜¯ç›¸å¯¹äº assets/resources/ çš„ä¸éœ€è¦åŠ  .prefab åç¼€æœ€ç»ˆåŠ è½½çš„æ˜¯ assets/resources/prefab/ui/InitAd.prefabæ˜¯çš„ï¼Œè·¯å¾„æ­£ç¡®ï¼ è·¯å¾„è¯´æ˜plaintextresources.load('prefab/ui/InitAd', ...)
                    â†“
åŠ è½½: assets/resources/prefab/ui/InitAd.prefabè§„åˆ™ è¯´æ˜  å€¼  åŸºç¡€ç›®å½•  assets/resources/  ç›¸å¯¹è·¯å¾„  prefab/ui/InitAd  å®Œæ•´è·¯å¾„  assets/resources/prefab/ui/InitAd.prefab  åç¼€  ä¸éœ€è¦å†™ .prefab é¡¹ç›®ä¸­å¯ç”¨çš„é¢„åˆ¶ä½“typescript// åˆå§‹åŒ–å¹¿å‘Š
await adData.loadPrefab('initAd', 'prefab/ui/InitAd');

// åŸç”Ÿå¹¿å‘Š
await adData.loadPrefab('nativeAd', 'prefab/ui/NvAd-md');

// ä¸»UI
await adData.loadPrefab('mainUI', 'prefab/ui/mainUI');

// åˆ—è¡¨é¡¹
await adData.loadPrefab('listItem', 'prefab/ui/MainListItem');æ³¨æ„ï¼šåªæœ‰æ”¾åœ¨ assets/resources/ ç›®å½•ä¸‹çš„èµ„æºæ‰èƒ½ç”¨ resources.load() åŠ¨æ€åŠ è½½ã€‚ this.node.on(Node.EventType.TOUCH_END, this.onClick, this);è¿™æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ this.node.on(Node.EventType.TOUCH_END, this.onClick, this);è¿™æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿæ·±åº¦æ€è€ƒ Â· 12sç”¨æˆ·é—®çš„æ˜¯ this.node.on(Node.EventType.TOUCH_END, this.onClick, this) è¿™è¡Œä»£ç çš„ä½œç”¨ã€‚è¿™æ˜¯ Cocos Creator ä¸­ç»™èŠ‚ç‚¹ç»‘å®šè§¦æ‘¸äº‹ä»¶çš„ä»£ç ã€‚è®©æˆ‘è§£é‡Šä¸€ä¸‹ï¼šè¿™æ˜¯ä»£ç åŠ¨æ€ç»‘å®šè§¦æ‘¸äº‹ä»¶ï¼Œç›¸å½“äºåœ¨ç¼–è¾‘å™¨ä¸­æ‰‹åŠ¨ç»‘å®šæŒ‰é’®ç‚¹å‡»äº‹ä»¶ã€‚ä»£ç è§£ætypescriptthis.node.on(Node.EventType.TOUCH_END, this.onClick, this);
//    â”‚              â”‚                      â”‚          â”‚
//    â”‚              â”‚                      â”‚          â””â”€â”€ å›è°ƒå‡½æ•°çš„ this æŒ‡å‘
//    â”‚              â”‚                      â””â”€â”€ è§¦å‘æ—¶è°ƒç”¨çš„å‡½æ•°
//    â”‚              â””â”€â”€ äº‹ä»¶ç±»å‹ï¼šè§¦æ‘¸ç»“æŸï¼ˆæ‰‹æŒ‡æŠ¬èµ·ï¼‰
//    â””â”€â”€ å½“å‰ç»„ä»¶æ‰€åœ¨çš„èŠ‚ç‚¹ä½œç”¨å½“ç”¨æˆ·ç‚¹å‡»è¿™ä¸ªèŠ‚ç‚¹æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨ onClick æ–¹æ³•ç­‰åŒäºåœ¨ç¼–è¾‘å™¨ä¸­è¿™æ ·è®¾ç½®ï¼šplaintextButton ç»„ä»¶
â”œâ”€â”€ ClickEvents
â”‚   â”œâ”€â”€ Target: å½“å‰èŠ‚ç‚¹
â”‚   â”œâ”€â”€ Component: Prefabload
â”‚   â”œâ”€â”€ Handler: onClick
â”‚   â””â”€â”€ CustomEventData: (ç©º)å¸¸ç”¨äº‹ä»¶ç±»å‹ äº‹ä»¶  è¯´æ˜  TOUCH_START  æ‰‹æŒ‡æŒ‰ä¸‹  TOUCH_MOVE  æ‰‹æŒ‡ç§»åŠ¨  TOUCH_END  æ‰‹æŒ‡æŠ¬èµ·ï¼ˆç‚¹å‡»å®Œæˆï¼‰  TOUCH_CANCEL  è§¦æ‘¸å–æ¶ˆ å¯¹æ¯”ä½ ç°åœ¨çš„ä»£ç ä½ ç°åœ¨çš„æ–¹æ³•éœ€è¦åœ¨ç¼–è¾‘å™¨ä¸­æ‰‹åŠ¨ç»‘å®šï¼štypescript// éœ€è¦ç¼–è¾‘å™¨ç»‘å®šæŒ‰é’®äº‹ä»¶ï¼Œå¹¶è®¾ç½® CustomEventData
gotoAppDetail() { ... }
gotoPermissionUrl() { ... }
gotPrivacyUrl() { ... }ç”¨ä»£ç ç»‘å®šçš„å¥½å¤„æ˜¯ä¸éœ€è¦åœ¨ç¼–è¾‘å™¨è®¾ç½®ï¼Œå®Œå…¨åŠ¨æ€ï¼štypescript// ä»£ç è‡ªåŠ¨ç»‘å®šï¼Œä¸ä¾èµ–ç¼–è¾‘å™¨
init(data: any) {
    this.adData = data;
    
    // ç»™æ•´ä¸ªå¹¿å‘ŠåŒºåŸŸç»‘å®šç‚¹å‡»äº‹ä»¶
    this.node.on(Node.EventType.TOUCH_END, this.gotoAppDetail, this);
    
    // æˆ–è€…ç»™ç‰¹å®šå­èŠ‚ç‚¹ç»‘å®š
    this.node.getChildByName("btnPrivacy")?.on(
        Node.EventType.TOUCH_END, 
        this.gotPrivacyUrl, 
        this
    );
}æ€»ç»“ æ–¹å¼  è¯´æ˜  ä¼˜ç‚¹  ç¼–è¾‘å™¨ç»‘å®š  Button ç»„ä»¶ + ClickEvents  å¯è§†åŒ–é…ç½®  ä»£ç ç»‘å®š  node.on(äº‹ä»¶, å›è°ƒ, this)  åŠ¨æ€çµæ´»ï¼Œå¤šå®ä¾‹å¤ç”¨ å¯¹äºä½ çš„å¤šå®ä¾‹å¹¿å‘Šåœºæ™¯ï¼Œä»£ç ç»‘å®šæ›´åˆé€‚ï¼Œå› ä¸ºæ¯ä¸ªå®ä¾‹çš„æ•°æ®ä¸åŒï¼Œäº‹ä»¶å›è°ƒéœ€è¦è®¿é—®å„è‡ªç‹¬ç«‹çš„ this.adDataã€‚è¿™é‡Œæ‰‹åŠ¨ç»‘å®šä¹Ÿå¯ä»¥å§ï¼Œå› ä¸ºdataæ˜¯ä¸åŒçš„ï¼Œè·³è½¬çš„urlä¹Ÿä¼šä¸åŒå§è¿™é‡Œæ‰‹åŠ¨ç»‘å®šä¹Ÿå¯ä»¥å§ï¼Œå› ä¸ºdataæ˜¯ä¸åŒçš„ï¼Œè·³è½¬çš„urlä¹Ÿä¼šä¸åŒå§æ·±åº¦æ€è€ƒ Â· 10sç”¨æˆ·é—®çš„å¯¹ï¼å³ä½¿åœ¨ç¼–è¾‘å™¨ä¸­æ‰‹åŠ¨ç»‘å®šäº‹ä»¶ï¼Œåªè¦æ¯ä¸ªå®ä¾‹çš„ this.adData æ˜¯ç‹¬ç«‹çš„ï¼ˆé€šè¿‡ init(data) ä¼ å…¥ä¸åŒçš„æ·±æ‹·è´æ•°æ®ï¼‰ï¼Œé‚£ä¹ˆç‚¹å‡»æ—¶è®¿é—®çš„ this.adData.appDetailUrl ç­‰ä¹Ÿä¼šæ˜¯å„è‡ªç‹¬ç«‹çš„å€¼ã€‚æ‰€ä»¥ï¼šç¼–è¾‘å™¨æ‰‹åŠ¨ç»‘å®š âœ… å¯ä»¥ä»£ç åŠ¨æ€ç»‘å®š âœ… ä¹Ÿå¯ä»¥ä¸¤ç§æ–¹å¼éƒ½èƒ½å·¥ä½œï¼Œå› ä¸ºå…³é”®æ˜¯ this.adData æ˜¯æ¯ä¸ªå®ä¾‹ç‹¬ç«‹çš„æ•°æ®å‰¯æœ¬ã€‚è®©æˆ‘ç®€å•ç¡®è®¤è¿™ä¸ªç†è§£ã€‚å®Œå…¨æ­£ç¡®ï¼ æ‰‹åŠ¨ç»‘å®šä¹Ÿå¯ä»¥ï¼åŸå› å…³é”®åœ¨äº this.adData æ˜¯æ¯ä¸ªå®ä¾‹ç‹¬ç«‹çš„æ•°æ®ï¼štypescript// å®ä¾‹A è°ƒç”¨ init(dataA)
// this.adData = dataA (ç‹¬ç«‹å‰¯æœ¬)
// ç‚¹å‡»æ—¶ â†’ this.adData.appDetailUrl = "urlA"

// å®ä¾‹B è°ƒç”¨ init(dataB)  
// this.adData = dataB (ç‹¬ç«‹å‰¯æœ¬)
// ç‚¹å‡»æ—¶ â†’ this.adData.appDetailUrl = "urlB"ä¸¤ç§æ–¹å¼å¯¹æ¯” æ–¹å¼  ç»‘å®šä½ç½®  æ•°æ®æ¥æº  ç»“æœ  ç¼–è¾‘å™¨ç»‘å®š  é¢„åˆ¶ä½“ä¸­é…ç½®  this.adData  âœ… æ¯ä¸ªå®ä¾‹è·³è½¬ä¸åŒURL  ä»£ç ç»‘å®š  init() ä¸­ç»‘å®š  this.adData  âœ… æ¯ä¸ªå®ä¾‹è·³è½¬ä¸åŒURL ä½ ç°åœ¨çš„ä»£ç å°±èƒ½å·¥ä½œtypescript// ç¼–è¾‘å™¨ä¸­ç»‘å®šæŒ‰é’®äº‹ä»¶åˆ°è¿™äº›æ–¹æ³•
gotoAppDetail() {
    // this æŒ‡å‘å½“å‰å®ä¾‹ï¼ŒadData æ˜¯è¯¥å®ä¾‹çš„ç‹¬ç«‹æ•°æ®
    if(this.adData && this.adData.appDetailUrl) {
        window.qg.openDeeplink({uri: this.adData.appDetailUrl})
    }
}åªè¦æ¯ä¸ªå®ä¾‹é€šè¿‡ init(data) ä¼ å…¥äº†ä¸åŒçš„æ•°æ®å‰¯æœ¬ï¼Œç‚¹å‡»æ—¶å°±ä¼šè·³è½¬åˆ°å„è‡ªçš„ URLã€‚æ€»ç»“âœ… ç¼–è¾‘å™¨æ‰‹åŠ¨ç»‘å®šå®Œå…¨æ²¡é—®é¢˜ï¼Œæ›´ç›´è§‚
âœ… ä»£ç ç»‘å®šåªæ˜¯å¦ä¸€ç§é€‰æ‹©ï¼Œé€‚åˆæ›´åŠ¨æ€çš„åœºæ™¯ä½ ä¿æŒç°åœ¨çš„å†™æ³•å°±è¡Œï¼