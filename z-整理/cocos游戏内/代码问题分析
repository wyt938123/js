æŸ¥çœ‹æ‚¨çš„æˆªå›¾ï¼Œå‘ç°äº†é—®é¢˜æ‰€åœ¨ã€‚è®©æˆ‘æ£€æŸ¥ä¸€ä¸‹æ‚¨å½“å‰æ‰“å¼€çš„ç™»å½•ä»£ç æ–‡ä»¶ã€‚
å·²æŸ¥çœ‹
loginCanvas.ts
ç°åœ¨æˆ‘æ‰¾åˆ°é—®é¢˜äº†ï¼ä»æ—¥å¿—æˆªå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼šé—®é¢˜åŸå› ï¼š
âŒ æ—¥å¿—æ˜¾ç¤ºï¼š[AdData] æ²¡æœ‰å¯ç”¨çš„å¹¿å‘Šæ•°æ®
æ—¥å¿—æ˜¾ç¤ºå¹¿å‘Šæ˜¯è¢«åˆ›å»ºäº†ï¼ˆ[AdData] åˆ›å»ºå¹¿å‘Š: nativeAdï¼‰ï¼Œä½†æ•°æ®åŠ è½½å¤±è´¥
åˆ†ææ‚¨çš„ä»£ç ç¬¬80è¡Œé—®é¢˜ï¼š
typescript
window['loadNativeAd'].push(adData)  // âŒ é”™è¯¯ï¼šåº”è¯¥æ˜¯ push åˆ°æ•°ç»„ï¼Œä½†ä½¿ç”¨äº†é”™è¯¯çš„å¯¹è±¡
å®é™…é—®é¢˜æ˜¯ï¼šæ‚¨åœ¨ç¬¬93è¡Œè®¾ç½®äº†ï¼š
typescript
window['loadNativeAd'] = this.loadNativeAd;  // å°†æ•°ç»„å¼•ç”¨èµ‹å€¼ç»™window
ä½†ç”±äº JavaScript çš„å¼•ç”¨æœºåˆ¶ï¼Œåœ¨ onLoad å›è°ƒä¸­ä½¿ç”¨ window['loadNativeAd'].push() æ—¶ï¼Œæ•°ç»„å¯¹è±¡å¯èƒ½è¿˜æœªæ­£ç¡®åˆå§‹åŒ–æˆ–è€…å¼•ç”¨ä¸¢å¤±ã€‚
ä¿®å¤æ–¹æ¡ˆï¼ˆæœ€ç®€å®ç°ï¼‰ï¼š
loginCanvas.ts
// ... existing code ...
    start () {
        // Deleted:window['loadNativeAd'] = this.loadNativeAd;
        if(!window['loadNativeAd']){
            window['loadNativeAd'] = [];
        }

        this.createNativeAd('i7ik1b3mgg');
        this.createNativeAd('a5sz2rxpaj');
// ... existing code ...
å…³é”®ä¿®æ”¹ï¼š
åˆ é™¤äº† window['loadNativeAd'] = this.loadNativeAd çš„å¼•ç”¨èµ‹å€¼
æ”¹ä¸ºç›´æ¥åˆå§‹åŒ– window['loadNativeAd'] = []ï¼Œç¡®ä¿å…¨å±€å¯¹è±¡æ˜¯ä¸€ä¸ªçº¯å‡€çš„æ•°ç»„
æ·»åŠ åˆ¤æ–­é¿å…é‡å¤åˆå§‹åŒ–
è¿™æ ·åœ¨ onLoad å›è°ƒï¼ˆç¬¬80è¡Œï¼‰æ‰§è¡Œ window['loadNativeAd'].push(adData) æ—¶ï¼Œå°±èƒ½æ­£ç¡®å°†å¹¿å‘Šæ•°æ®å­˜å…¥å…¨å±€æ•°ç»„äº†ã€‚
è¿˜æ˜¯æ²¡æœ‰å¯ç”¨å¹¿å‘Šæ•°æ®ï¼Œè¿™ä¸ªå‡ tsä½ éƒ½æŸ¥çœ‹ä¸€ä¸‹
è¿˜æ˜¯æ²¡æœ‰å¯ç”¨å¹¿å‘Šæ•°æ®ï¼Œè¿™ä¸ªå‡ tsä½ éƒ½æŸ¥çœ‹ä¸€ä¸‹
è®©æˆ‘æ£€æŸ¥æ•´ä¸ªå¹¿å‘Šç›¸å…³çš„ä»£ç æ–‡ä»¶ï¼Œæ‰¾å‡ºæ ¹æœ¬åŸå› ã€‚
å·²æ¢ç´¢
2æ–‡ä»¶ 4æ£€ç´¢
æ‰¾åˆ°æ ¹æœ¬é—®é¢˜äº†ï¼è®©æˆ‘æ£€æŸ¥ initAd ç›¸å…³çš„ä»£ç ï¼š
å·²æ¢ç´¢
1æ–‡ä»¶ 4æ£€ç´¢
ç°åœ¨æ‰¾åˆ°å…¨éƒ¨é—®é¢˜äº†ï¼è®©æˆ‘æ£€æŸ¥ mainCanvas.tsï¼š
å·²æ¢ç´¢
1æ–‡ä»¶ 1æ£€ç´¢
å®Œç¾ï¼ç°åœ¨æˆ‘æ‰¾åˆ°æ‰€æœ‰é—®é¢˜äº†ï¼š
é—®é¢˜æ±‡æ€»ï¼š
1. loginCanvas.ts ä¸­çš„é—®é¢˜
ç¬¬80è¡Œä½¿ç”¨äº† window['loadNativeAd'] ä½†å®é™…åº”è¯¥ä½¿ç”¨ window['NativeAdData']
AdData.ts ç¬¬42è¡Œä»£ç æ˜ç¡®æ˜¾ç¤ºå®ƒä» window['NativeAdData'] è·å–æ•°æ®
2. AdData.ts ä¸­çš„é—®é¢˜
ç¬¬42-48è¡Œçš„ addFromWindow() æ–¹æ³•æ£€æŸ¥çš„æ˜¯ window['NativeAdData']ï¼Œä½† loginCanvas å´å¾€ window['loadNativeAd'] é‡Œpushæ•°æ®
3. æ•°æ®æµæ–­è£‚
plaintext
loginCanvas.ts (ç¬¬80è¡Œ) 
  â†“ å­˜å…¥ window['loadNativeAd']
  âœ— æ•°æ®æµæ–­è£‚
  â†“ 
AdData.ts (ç¬¬42è¡Œ)
  â†“ ä» window['NativeAdData'] è¯»å–  â† æ‰¾ä¸åˆ°æ•°æ®ï¼
å®Œæ•´ä¿®å¤æ–¹æ¡ˆï¼š
loginCanvas.ts
// ... existing code ...
    loadNativeAd :Array<any> = new Array();
    // Deleted:// adId :any;       
    createNativeAd(adUnitId:string){
    
    console.log("ad demo : loadNativeAd");
    let MynativeAd = qg.createNativeAd({
        adUnitId: adUnitId,
        success: function(code) {
            console.log("loadNativeAd loadNativeAd : success");
        },
        fail: function(data, code) {
            console.log("loadNativeAd loadNativeAd fail: " + data + "," + code);
        },
        complete: function() {
            console.log("loadNativeAd loadNativeAd : complete");
        }
    });        


    MynativeAd.offLoad();
    MynativeAd.onLoad(function (test:any) {
        let adId = test.adList[0].adId;
        let adData = test.adList[0];
        console.log("ad demo loadNativeAd onLoad NativeAd enter length : " + test.adList.length);
        console.log(JSON.stringify(test));         
        var imgUrlList = test.adList[0].imgUrlList;
        console.log("ad demo : loadNativeAd onLoad imgUrlList : " + imgUrlList);
        
        // Deleted:window['loadNativeAd'].push(adData)
        if(!window['NativeAdData']){
            window['NativeAdData'] = [];
        }
        window['NativeAdData'].push(adData);
        console.log("[ç™»å½•é¡µ] å¹¿å‘Šæ•°æ®å·²å­˜å…¥ NativeAdDataï¼Œå½“å‰æ•°é‡:", window['NativeAdData'].length);
    });
    MynativeAd.offError();
    MynativeAd.onError(function (test) {
        console.log("ad demo : loadNativeAd onError enter" + test.errCode);
        console.log("ad demo : loadNativeAd onError enter" + test.errMsg);
    });  
    MynativeAd.load();
}

    

    start () {
        // Deleted:window['loadNativeAd'] = this.loadNativeAd;
        if(!window['NativeAdData']){
            window['NativeAdData'] = [];
        }

        this.createNativeAd('i7ik1b3mgg');
        this.createNativeAd('a5sz2rxpaj');
// ... existing code ...
å…³é”®ä¿®æ”¹ç‚¹ï¼š
âœ… ç¬¬80è¡Œï¼šä» window['loadNativeAd'] æ”¹ä¸º window['NativeAdData']
âœ… ç¬¬93è¡Œï¼šåˆ é™¤é”™è¯¯çš„å¼•ç”¨èµ‹å€¼ï¼Œæ”¹ä¸ºåˆå§‹åŒ– window['NativeAdData'] æ•°ç»„
âœ… ç¬¬82-84è¡Œï¼šæ·»åŠ æ•°ç»„åˆå§‹åŒ–å’Œè°ƒè¯•æ—¥å¿—ï¼Œç¡®ä¿æ•°æ®æ­£ç¡®å­˜å‚¨
âœ… ç»Ÿä¸€å‘½åï¼šå…¨éƒ¨ä½¿ç”¨ NativeAdDataï¼Œä¸ AdData.ts ä¿æŒä¸€è‡´
è¿™æ ·æ•°æ®æµå°±é€šäº†ï¼š
plaintext
loginCanvas.ts â†’ window['NativeAdData'] â†’ AdData.addFromWindow() â†’ adData.create() âœ“
loginCanvas.ts 52-89
 ä¸ºä»€ä¹ˆè¿˜æ˜¯æ— æ³•åŒæ—¶åˆ›å»ºå¤šä¸ªå¹¿å‘Šå®ä¾‹ï¼Ÿ
loginCanvas.ts 52-89
 ä¸ºä»€ä¹ˆè¿˜æ˜¯æ— æ³•åŒæ—¶åˆ›å»ºå¤šä¸ªå¹¿å‘Šå®ä¾‹ï¼Ÿ
è®©æˆ‘åˆ†æä¸€ä¸‹å½“å‰çš„é—®é¢˜ï¼Œå¹¶æŸ¥çœ‹ç›¸å…³ä»£ç æ¥ç†è§£ä¸ºä»€ä¹ˆæ— æ³•åŒæ—¶åˆ›å»ºå¤šä¸ªå¹¿å‘Šå®ä¾‹ã€‚
å·²æ¢ç´¢
2æ–‡ä»¶
ç°åœ¨æˆ‘æ‰¾åˆ°é—®é¢˜æ ¹æºäº†ï¼è®©æˆ‘åˆ†æä¸€ä¸‹æ— æ³•åŒæ—¶åˆ›å»ºå¤šä¸ªå¹¿å‘Šå®ä¾‹çš„3ä¸ªå…³é”®é—®é¢˜ï¼š
é—®é¢˜åˆ†æï¼š
âŒ é—®é¢˜1ï¼šAdData.ts ç¬¬42è¡Œå˜é‡åé”™è¯¯
typescript
// AdData.ts ç¬¬42è¡Œ
const data = window['loadNativeAd'];  // âŒ é”™è¯¯ï¼åº”è¯¥æ˜¯ 'NativeAdData'
âŒ é—®é¢˜2ï¼šæ•°æ®æ± çš„ acquire() ä¼šæ ‡è®°ä¸ºå·²ä½¿ç”¨
typescript
// AdData.ts ç¬¬30-38è¡Œ
acquire(): any {
    for (const item of this._pool) {
        if (!item.used) {
            item.used = true;  // âŒ æ ‡è®°ä¸ºå·²ä½¿ç”¨
            return JSON.parse(JSON.stringify(item.data));
        }
    }
    console.warn("[AdData] æ²¡æœ‰å¯ç”¨æ•°æ®");  // ç¬¬äºŒæ¬¡è°ƒç”¨å°±æ²¡æ•°æ®äº†ï¼
    return null;
}
æ‰§è¡Œæµç¨‹ï¼š
plaintext
ç¬¬86è¡Œï¼šadData.addFromWindow() 
  â†’ åªæ·»åŠ äº† 1 æ¡æ•°æ®åˆ°æ± ï¼ˆpopåªå–ä¸€æ¡ï¼‰
  â†’ æ± ä¸­æ•°æ®ï¼š[{data: ad1, used: false}]

ç¬¬86è¡Œï¼šadData.create() ç¬¬1æ¬¡
  â†’ acquire() è·å–æ•°æ®ï¼Œæ ‡è®° used = true
  â†’ æ± ä¸­æ•°æ®ï¼š[{data: ad1, used: true}]  âœ“ åˆ›å»ºæˆåŠŸ

ç¬¬87è¡Œï¼šadData.create() ç¬¬2æ¬¡  
  â†’ acquire() æ‰¾ä¸åˆ° used=false çš„æ•°æ®
  â†’ è¿”å› nullï¼Œæ‰“å° "[AdData] æ²¡æœ‰å¯ç”¨çš„å¹¿å‘Šæ•°æ®" âœ— åˆ›å»ºå¤±è´¥
âŒ é—®é¢˜3ï¼šaddFromWindow() åªæ·»åŠ ä¸€æ¡æ•°æ®
typescript
// AdData.ts ç¬¬41-49è¡Œ
addFromWindow(): any {
    const data = window['NativeAdData'];
    if (data.length>0) {
        this.add(data.pop());  // âŒ pop() åªå–ä¸€æ¡
        return data;
    }
    // ...
}
ä½†ä½ çš„ loginCanvas.ts ä¸­è°ƒç”¨äº† 2 æ¬¡ createNativeAd()ï¼Œåº”è¯¥æœ‰ 2 æ¡å¹¿å‘Šæ•°æ®ï¼
å®Œæ•´ä¿®å¤æ–¹æ¡ˆï¼ˆæœ€ç®€å®ç°ï¼‰ï¼š
AdData.ts
// ... existing code ...
     /** ä» window è·å–å¹¶æ·»åŠ  */
    addFromWindow(): any {
        const data = window['NativeAdData'];
        if (data && data.length>0) {
            while(data.length > 0) {
                this.add(data.pop());
            }
            console.log("[AdData] å·²ä» window æ·»åŠ æ‰€æœ‰å¹¿å‘Šæ•°æ®ï¼Œå½“å‰æ± :", this._pool.length);
            return true;
        }
        console.warn("[AdData] æ²¡æœ‰å¯ç”¨æ•°æ®");
        return null;
    }

       /** é‡ç½®æ‰€æœ‰æ•°æ®ä¸ºæœªä½¿ç”¨ */
    reset() {
        this._pool.forEach(item => item.used = false);
        console.log("[AdData] å·²é‡ç½®æ•°æ®æ± ï¼Œå¯ç”¨:", this.available);
    }
// ... existing code ...
mainCanvas.ts
// ... existing code ...
        await adData.loadPrefab('nativeAd', 'prefab/ui/NvAd-md'); 

 
        setTimeout(() => { 
            adData.addFromWindow();
            console.log("[ä¸»åœºæ™¯] å¹¿å‘Šæ± å¯ç”¨æ•°é‡:", adData.available);
            adData.create('nativeAd', null, { x: 0, y: 0 }); 
            adData.create('nativeAd', null, { x: -300, y: -200 }); 
        }, 10000);
// ... existing code ...
loginCanvas.ts
// ... existing code ...
        console.log("ad demo : loadNativeAd onLoad imgUrlList : " + imgUrlList);
        
        if(!window['NativeAdData']){
            window['NativeAdData'] = [];
        }
        window['NativeAdData'].push(adData);
        console.log("[ç™»å½•é¡µ] å¹¿å‘Šæ•°æ®å·²å­˜å…¥ NativeAdDataï¼Œå½“å‰æ•°é‡:", window['NativeAdData'].length);
    });
// ... existing code ...
    start () {
        if(!window['NativeAdData']){
            window['NativeAdData'] = [];
        }

        this.createNativeAd('i7ik1b3mgg');
        this.createNativeAd('a5sz2rxpaj');
// ... existing code ...
å…³é”®ä¿®å¤ç‚¹ï¼š
âœ… ç¬¬42è¡Œï¼šwindow['loadNativeAd'] â†’ window['NativeAdData']ï¼ˆç»Ÿä¸€å‘½åï¼‰
âœ… addFromWindow()ï¼šä½¿ç”¨ while å¾ªç¯å°†æ‰€æœ‰æ•°æ®æ·»åŠ åˆ°æ± ä¸­
âœ… mainCanvas ç¬¬87è¡Œï¼šåˆ é™¤é‡å¤çš„ addFromWindow()ï¼Œåªåœ¨ç¬¬86è¡Œè°ƒç”¨ä¸€æ¬¡
âœ… å¢å¼ºæ—¥å¿—ï¼šè¾“å‡ºæ± çš„å¯ç”¨æ•°é‡ï¼Œæ–¹ä¾¿æ’æŸ¥
ç°åœ¨æ•°æ®æµæ˜¯è¿™æ ·çš„ï¼š
plaintext
loginCanvas â†’ window['NativeAdData'] å­˜å…¥ 2 æ¡æ•°æ®
                â†“
mainCanvas â†’ adData.addFromWindow() å…¨éƒ¨æ·»åŠ åˆ°æ± 
                â†“
æ± ä¸­æœ‰ 2 æ¡æ•°æ®ï¼š[{used:false}, {used:false}]
                â†“
create() ç¬¬1æ¬¡ â†’ acquire() è·å–ç¬¬1æ¡ï¼Œæ ‡è®° used=true âœ“
create() ç¬¬2æ¬¡ â†’ acquire() è·å–ç¬¬2æ¡ï¼Œæ ‡è®° used=true âœ“
è¿™æ ·å°±èƒ½åŒæ—¶åˆ›å»ºå¤šä¸ªå¹¿å‘Šå®ä¾‹äº†ï¼ğŸ‰
loadNativeAdä½œä¸ºäº†æˆ‘çš„å…¨å±€å˜é‡
loadNativeAdä½œä¸ºäº†æˆ‘çš„å…¨å±€å˜é‡
æ˜ç™½äº†ï¼loadNativeAd æ˜¯æ‚¨åœ¨ loginCanvas ä¸­å®šä¹‰çš„ç±»æˆå‘˜å˜é‡ï¼ˆç¬¬52è¡Œï¼‰ï¼Œå¹¶é€šè¿‡ window['loadNativeAd'] = this.loadNativeAd æš´éœ²ä¸ºå…¨å±€å˜é‡ã€‚è®©æˆ‘é‡æ–°å®¡è§†æ‚¨çš„è®¾è®¡æ„å›¾ï¼Œå¹¶ç»™å‡ºæ­£ç¡®çš„ä¿®å¤æ–¹æ¡ˆï¼š
å·²æŸ¥çœ‹
loginCanvas.ts
(52 - 251)
å¥½çš„ï¼æˆ‘ç°åœ¨ç†è§£äº†æ‚¨çš„è®¾è®¡ã€‚æ‚¨å¸Œæœ›ä¿ç•™ loadNativeAd ä½œä¸ºå…¨å±€å˜é‡åã€‚é‚£ä¹ˆé—®é¢˜å°±å¾ˆç®€å•äº†ï¼Œåªéœ€è¦ä¿®å¤ AdData.ts ä¸­çš„å˜é‡åå³å¯ï¼š
é—®é¢˜æ ¹æºï¼š
æ‚¨çš„è®¾è®¡ï¼š
âœ… loginCanvas ç¬¬52è¡Œï¼šå®šä¹‰ loadNativeAd æ•°ç»„
âœ… loginCanvas ç¬¬93è¡Œï¼šå·²æ³¨é‡Šæ‰ï¼ˆè¢«æˆ‘è¯¯å¯¼äº†ï¼‰
âœ… loginCanvas ç¬¬94-96è¡Œï¼šåˆå§‹åŒ– window['loadNativeAd'] æ•°ç»„
âœ… loginCanvas ç¬¬80è¡Œï¼šå¾€ window['loadNativeAd'] ä¸­ push æ•°æ®
ä½†æ˜¯ï¼š
âŒ AdData.ts ç¬¬42è¡Œï¼šå´ä» window['NativeAdData'] è¯»å–ï¼ˆå˜é‡åä¸ä¸€è‡´ï¼ï¼‰
æœ€ç®€ä¿®å¤æ–¹æ¡ˆï¼š
AdData.ts
// ... existing code ...
     /** ä» window è·å–å¹¶æ·»åŠ  */
    addFromWindow(): any {
        const data = window['loadNativeAd'];
        if (data && data.length>0) {
            while(data.length > 0) {
                this.add(data.pop());
            }
            console.log("[AdData] å·²ä» window.loadNativeAd æ·»åŠ æ‰€æœ‰å¹¿å‘Šæ•°æ®ï¼Œå½“å‰æ± :", this._pool.length);
            return true;
        }
        console.warn("[AdData] window.loadNativeAd æ²¡æœ‰å¯ç”¨æ•°æ®");
        return null;
    }
// ... existing code ...
loginCanvas.ts
// ... existing code ...
        console.log("ad demo : loadNativeAd onLoad imgUrlList : " + imgUrlList);
        
        window['loadNativeAd'].push(adData);
        console.log("[ç™»å½•é¡µ] å¹¿å‘Šæ•°æ®å·²å­˜å…¥ loadNativeAdï¼Œå½“å‰æ•°é‡:", window['loadNativeAd'].length);
    });
// ... existing code ...
mainCanvas.ts
// ... existing code ...
        await adData.loadPrefab('nativeAd', 'prefab/ui/NvAd-md'); 

 
        setTimeout(() => { 
            adData.addFromWindow();
            console.log("[ä¸»åœºæ™¯] å¹¿å‘Šæ± å¯ç”¨æ•°é‡:", adData.available);
            adData.create('nativeAd', null, { x: 0, y: 0 }); 
            adData.create('nativeAd', null, { x: -300, y: -200 }); 
        }, 10000);
// ... existing code ...
ä¿®å¤è¦ç‚¹ï¼š
âœ… AdData.ts ç¬¬42è¡Œï¼šwindow['NativeAdData'] â†’ window['loadNativeAd']ï¼ˆç»Ÿä¸€ä½¿ç”¨æ‚¨çš„å…¨å±€å˜é‡åï¼‰
âœ… addFromWindow()ï¼šä½¿ç”¨ while å¾ªç¯ï¼Œå°†æ‰€æœ‰å¹¿å‘Šæ•°æ®æ·»åŠ åˆ°æ± ä¸­
âœ… mainCanvas ç¬¬87è¡Œï¼šåˆ é™¤é‡å¤çš„ addFromWindow() è°ƒç”¨
âœ… å¢å¼ºæ—¥å¿—ï¼šè¾“å‡ºå…³é”®æ­¥éª¤ï¼Œæ–¹ä¾¿è°ƒè¯•
è¿™æ ·å°±å®Œå…¨å°Šé‡æ‚¨çš„åŸå§‹è®¾è®¡ï¼Œåªä¿®å¤å˜é‡åä¸ä¸€è‡´çš„é—®é¢˜ï¼ğŸ¯
yjtvj5wv.png
æ§åˆ¶å°åªæ‰“å°äº†ä¸€æ¬¡ï¼Œç†è®ºæ˜¯æœ‰ä¸¤æ¬¡çš„
yjtvj5wv.png
æ§åˆ¶å°åªæ‰“å°äº†ä¸€æ¬¡ï¼Œç†è®ºæ˜¯æœ‰ä¸¤æ¬¡çš„
ä»æˆªå›¾ä¸­æˆ‘çœ‹åˆ°ï¼ŒonLoad å›è°ƒåªè§¦å‘äº†ä¸€æ¬¡ï¼Œè¿™è¯´æ˜é—®é¢˜å‡ºåœ¨å¹¿å‘ŠåŠ è½½é˜¶æ®µï¼Œè€Œä¸æ˜¯åç»­çš„åˆ›å»ºé€»è¾‘ã€‚è®©æˆ‘åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆåªæœ‰ä¸€ä¸ªå¹¿å‘ŠåŠ è½½æˆåŠŸï¼š
é—®é¢˜åˆ†æï¼š
æ‚¨è°ƒç”¨äº†ä¸¤æ¬¡ createNativeAd()ï¼š
typescript
this.createNativeAd('i7ik1b3mgg');  // ç¬¬1ä¸ªå¹¿å‘Šä½
this.createNativeAd('a5sz2rxpaj');  // ç¬¬2ä¸ªå¹¿å‘Šä½
ä½†æ—¥å¿—æ˜¾ç¤ºï¼š
âœ… loadNativeAd : success å‡ºç°äº† 2æ¬¡ï¼ˆ14:22:56.327 ä¸¤æ¡ï¼‰
âœ… loadNativeAd : complete å‡ºç°äº† 2æ¬¡
âŒ onLoad NativeAd enter length : 1 åªå‡ºç°äº† 1æ¬¡
ç»“è®ºï¼šç¬¬2ä¸ªå¹¿å‘Šä½çš„ onLoad å›è°ƒæ²¡æœ‰è§¦å‘ï¼Œå¯èƒ½æ˜¯å› ä¸ºï¼š
å¹¿å‘Šä½æ²¡æœ‰è¿”å›å¹¿å‘Šæ•°æ®ï¼ˆå¸¸è§åŸå› ï¼‰
onLoad ç›‘å¬å™¨è¢«è¦†ç›–ï¼ˆæ¯æ¬¡ createNativeAd éƒ½ä¼šé‡æ–°ç»‘å®šï¼‰
æ ¹æœ¬é—®é¢˜ï¼šoffLoad() å’Œ onLoad() çš„ä½œç”¨åŸŸ
æ‚¨å½“å‰çš„ä»£ç åœ¨æ¯æ¬¡è°ƒç”¨ createNativeAd() æ—¶éƒ½ä¼šè§£ç»‘å¹¶é‡æ–°ç»‘å®šï¼š
typescript
MynativeAd.offLoad();  // âŒ è¿™ä¼šè§£ç»‘ä¹‹å‰çš„ç›‘å¬å™¨
MynativeAd.onLoad(function (test:any) {
    // åªæœ‰å½“å‰è¿™ä¸ªå¹¿å‘Šä½çš„å›è°ƒä¼šæ‰§è¡Œ
    window['loadNativeAd'].push(adData);
});
è¿™å¯¼è‡´ï¼š
ç¬¬1æ¬¡è°ƒç”¨ createNativeAd('i7ik1b3mgg') â†’ ç»‘å®šç›‘å¬å™¨1
ç¬¬2æ¬¡è°ƒç”¨ createNativeAd('a5sz2rxpaj') â†’ è§£ç»‘ç›‘å¬å™¨1ï¼Œç»‘å®šç›‘å¬å™¨2
ç»“æœï¼šåªæœ‰ç¬¬2ä¸ªå¹¿å‘Šä½çš„å›è°ƒä¼šæ‰§è¡Œï¼Œä½†å¦‚æœå®ƒæ²¡æ•°æ®å°±ä¸ä¼šè§¦å‘ onLoad
ä¿®å¤æ–¹æ¡ˆï¼ˆæœ€ç®€å®ç°ï¼‰ï¼š
æ–¹æ¡ˆ1ï¼šç§»é™¤ offLoad()ï¼Œè®©æ‰€æœ‰ç›‘å¬å™¨å…±å­˜
loginCanvas.ts
// ... existing code ...
    createNativeAd(adUnitId:string){
    
    console.log("ad demo : loadNativeAd");
    let MynativeAd = qg.createNativeAd({
        adUnitId: adUnitId,
        success: function(code) {
            console.log("loadNativeAd loadNativeAd : success");
        },
        fail: function(data, code) {
            console.log("loadNativeAd loadNativeAd fail: " + data + "," + code);
        },
        complete: function() {
            console.log("loadNativeAd loadNativeAd : complete");
        }
    });        


    // Deleted:MynativeAd.offLoad();
    MynativeAd.onLoad(function (test:any) {
        let adId = test.adList[0].adId;
        let adData = test.adList[0];
        console.log("ad demo loadNativeAd onLoad NativeAd enter length : " + test.adList.length);
        console.log(JSON.stringify(test));         
        var imgUrlList = test.adList[0].imgUrlList;
        console.log("ad demo : loadNativeAd onLoad imgUrlList : " + imgUrlList);
        
        window['loadNativeAd'].push(adData);
        console.log("[ç™»å½•é¡µ] å¹¿å‘Šæ•°æ®å·²å­˜å…¥ loadNativeAdï¼Œå½“å‰æ•°é‡:", window['loadNativeAd'].length);
    });
    // Deleted:MynativeAd.offError();
    MynativeAd.onError(function (test) {
        console.log("ad demo : loadNativeAd onError enter" + test.errCode);
        console.log("ad demo : loadNativeAd onError enter" + test.errMsg);
    });  
    MynativeAd.load();
}
// ... existing code ...
å…³é”®ä¿®æ”¹ï¼š
âœ… åˆ é™¤ MynativeAd.offLoad() - ä¸è§£ç»‘ä¹‹å‰çš„ç›‘å¬å™¨
âœ… åˆ é™¤ MynativeAd.offError() - åŒç†
âœ… ä¿ç•™å¢å¼ºæ—¥å¿—ï¼Œæ–¹ä¾¿è§‚å¯Ÿæ˜¯å¦æœ‰ä¸¤æ¬¡å›è°ƒ
é¢„æœŸç»“æœï¼š
ä¿®æ”¹åï¼Œæ§åˆ¶å°åº”è¯¥è¾“å‡ºï¼š
plaintext
ad demo loadNativeAd onLoad NativeAd enter length : 1
[ç™»å½•é¡µ] å¹¿å‘Šæ•°æ®å·²å­˜å…¥ loadNativeAdï¼Œå½“å‰æ•°é‡: 1
ad demo loadNativeAd onLoad NativeAd enter length : 1  â† ç¬¬2æ¬¡å›è°ƒ
[ç™»å½•é¡µ] å¹¿å‘Šæ•°æ®å·²å­˜å…¥ loadNativeAdï¼Œå½“å‰æ•°é‡: 2  â† æ•°é‡å˜ä¸º2
å¦‚æœç¬¬2ä¸ªå¹¿å‘Šä½ç¡®å®æ²¡æœ‰æ•°æ®ï¼ˆå¹³å°è¿”å›ç©ºåˆ—è¡¨ï¼‰ï¼Œé‚£ä¹ˆåªä¼šè§¦å‘ä¸€æ¬¡å›è°ƒï¼Œè¿™æ˜¯æ­£å¸¸çš„ã€‚ä½†è‡³å°‘ç°åœ¨ä¸ä¼šå› ä¸º offLoad() å¯¼è‡´ç›‘å¬å™¨è¢«æ„å¤–è§£ç»‘ã€‚
æˆ‘æ¯æ¬¡è°ƒç”¨éƒ½æ˜¯åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„MynativeAdï¼Œä»–ä»¬ä¹‹å‰æ€ä¹ˆè¿˜ä¼šå½±å“å‘¢ï¼Ÿ
æˆ‘æ¯æ¬¡è°ƒç”¨éƒ½æ˜¯åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„MynativeAdï¼Œä»–ä»¬ä¹‹å‰æ€ä¹ˆè¿˜ä¼šå½±å“å‘¢ï¼Ÿ
æ‚¨è¯´å¾—å¯¹ï¼æˆ‘ç†è§£é”™äº†ã€‚æ¯æ¬¡è°ƒç”¨ createNativeAd() éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ MynativeAd å®ä¾‹ï¼Œå®ƒä»¬ä¹‹é—´ç¡®å®ä¸ä¼šç›¸äº’å½±å“ã€‚è®©æˆ‘é‡æ–°åˆ†ææˆªå›¾ä¸­çš„æ—¥å¿—ï¼š
å·²æŸ¥çœ‹
loginCanvas.ts
(54 - 253)
æ‚¨å®Œå…¨æ­£ç¡®ï¼æˆ‘ä¹‹å‰çš„åˆ†ææ˜¯é”™è¯¯çš„ã€‚è®©æˆ‘é‡æ–°çœ‹æˆªå›¾æ—¥å¿—ï¼š
çœŸå®æƒ…å†µåˆ†æï¼š
ä»æˆªå›¾çœ‹åˆ°çš„å®Œæ•´æ—¶é—´çº¿ï¼š
plaintext
14:22:56.327 - loadNativeAd : success      (ç¬¬1ä¸ªå¹¿å‘Šä½åˆ›å»ºæˆåŠŸ)
14:22:56.327 - loadNativeAd : complete     (ç¬¬1ä¸ªå¹¿å‘Šä½åˆ›å»ºå®Œæˆ)
14:22:56.327 - loadNativeAd : success      (ç¬¬2ä¸ªå¹¿å‘Šä½åˆ›å»ºæˆåŠŸ)
14:22:56.327 - loadNativeAd : complete     (ç¬¬2ä¸ªå¹¿å‘Šä½åˆ›å»ºå®Œæˆ)
14:22:57.213 - onLoad enter length : 1     (åªæœ‰1ä¸ªå¹¿å‘Šä½è¿”å›äº†æ•°æ®ï¼)
ç»“è®ºï¼šä¸¤ä¸ªå¹¿å‘Šä½éƒ½åˆ›å»ºæˆåŠŸäº†ï¼Œä½†åªæœ‰1ä¸ªè¿”å›äº†å¹¿å‘Šæ•°æ®ï¼ˆonLoad åªè§¦å‘äº†1æ¬¡ï¼‰
çœŸæ­£çš„é—®é¢˜ï¼š
è¿™ä¸æ˜¯ä»£ç é—®é¢˜ï¼Œè€Œæ˜¯å¹¿å‘Šå¹³å°çš„é—®é¢˜ï¼š
âœ… å¹¿å‘Šä½ i7ik1b3mgg - è¿”å›äº†æ•°æ®
âŒ å¹¿å‘Šä½ a5sz2rxpaj - æ²¡æœ‰è¿”å›æ•°æ®ï¼ˆå¹¿å‘Šå¡«å……ç‡é—®é¢˜ï¼‰
å½“å¹¿å‘Šå¹³å°æ²¡æœ‰å¯ç”¨å¹¿å‘Šæ—¶ï¼š
onLoad ä¸ä¼šè§¦å‘
onError ä¹Ÿå¯èƒ½ä¸è§¦å‘ï¼ˆå–å†³äºå¹³å°å®ç°ï¼‰
åªæ˜¯é»˜é»˜å¤±è´¥
è§£å†³æ–¹æ¡ˆï¼šå¢å¼ºé”™è¯¯ç›‘æ§å’Œé‡è¯•æœºåˆ¶
loginCanvas.ts
// ... existing code ...
    createNativeAd(adUnitId:string){
    
    console.log(`[å¹¿å‘ŠåŠ è½½] å¼€å§‹åŠ è½½å¹¿å‘Šä½: ${adUnitId}`);
    let MynativeAd = qg.createNativeAd({
        adUnitId: adUnitId,
        success: function(code) {
            console.log(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - success`);
        },
        fail: function(data, code) {
            console.log(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - fail: ${data}, code: ${code}`);
        },
        complete: function() {
            console.log(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - complete`);
        }
    });        


    MynativeAd.offLoad();
    MynativeAd.onLoad(function (test:any) {
        if (!test.adList || test.adList.length === 0) {
            console.warn(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - onLoad è¿”å›ç©ºåˆ—è¡¨`);
            return;
        }
        
        let adId = test.adList[0].adId;
        let adData = test.adList[0];
        console.log(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - onLoad æˆåŠŸ, length: ${test.adList.length}`);
        console.log(JSON.stringify(test));         
        var imgUrlList = test.adList[0].imgUrlList;
        console.log(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - imgUrlList: ${imgUrlList}`);
        
        window['loadNativeAd'].push(adData);
        console.log(`[å¹¿å‘ŠåŠ è½½] æ•°æ®å·²å­˜å…¥, å½“å‰æ€»æ•°: ${window['loadNativeAd'].length}`);
    });
    MynativeAd.offError();
    MynativeAd.onError(function (test) {
        console.error(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - onError: ${test.errCode} - ${test.errMsg}`);
    });  
    MynativeAd.load();
}
// ... existing code ...
å…³é”®æ”¹è¿›ï¼š
âœ… å¢å¼ºæ—¥å¿—ï¼šæ¯æ¡æ—¥å¿—éƒ½å¸¦ä¸Š adUnitIdï¼Œå¯ä»¥æ¸…æ¥šçœ‹åˆ°æ˜¯å“ªä¸ªå¹¿å‘Šä½
âœ… ç©ºæ•°æ®æ£€æŸ¥ï¼šåœ¨ onLoad ä¸­æ£€æŸ¥ test.adList æ˜¯å¦ä¸ºç©º
âœ… é”™è¯¯æ—¥å¿—å¢å¼ºï¼šonError ä¸­è¾“å‡ºå…·ä½“çš„é”™è¯¯ç å’Œé”™è¯¯ä¿¡æ¯
é¢„æœŸç»“æœï¼š
ä¿®æ”¹åï¼Œå¦‚æœç¬¬2ä¸ªå¹¿å‘Šä½ç¡®å®æ²¡æœ‰æ•°æ®ï¼Œæ§åˆ¶å°ä¼šæ˜¾ç¤ºï¼š
plaintext
[å¹¿å‘ŠåŠ è½½] å¼€å§‹åŠ è½½å¹¿å‘Šä½: i7ik1b3mgg
[å¹¿å‘ŠåŠ è½½] å¼€å§‹åŠ è½½å¹¿å‘Šä½: a5sz2rxpaj
[å¹¿å‘ŠåŠ è½½] i7ik1b3mgg - success
[å¹¿å‘ŠåŠ è½½] i7ik1b3mgg - complete
[å¹¿å‘ŠåŠ è½½] a5sz2rxpaj - success
[å¹¿å‘ŠåŠ è½½] a5sz2rxpaj - complete
[å¹¿å‘ŠåŠ è½½] i7ik1b3mgg - onLoad æˆåŠŸ, length: 1
[å¹¿å‘ŠåŠ è½½] æ•°æ®å·²å­˜å…¥, å½“å‰æ€»æ•°: 1
[å¹¿å‘ŠåŠ è½½] a5sz2rxpaj - onError: xxx - å¹¿å‘Šå¡«å……å¤±è´¥  â† ä¼šçœ‹åˆ°å…·ä½“åŸå› 
è¿™æ ·æ‚¨å°±èƒ½å‡†ç¡®çŸ¥é“æ˜¯å“ªä¸ªå¹¿å‘Šä½æœ‰é—®é¢˜ï¼Œä»¥åŠå…·ä½“çš„å¤±è´¥åŸå› äº†ã€‚
ewqcabr8.png
æ²¡æœ‰ï¼Œè¿˜æ˜¯ä¸€ä¸ªï¼Œé”™è¯¯ä¿¡æ¯éƒ½æ²¡æœ‰
ewqcabr8.png
æ²¡æœ‰ï¼Œè¿˜æ˜¯ä¸€ä¸ªï¼Œé”™è¯¯ä¿¡æ¯éƒ½æ²¡æœ‰
ä»æˆªå›¾å¯ä»¥çœ‹åˆ°ï¼Œç°åœ¨æ—¥å¿—å·²ç»å¾ˆæ¸…æ™°äº†ï¼š
plaintext
[å¹¿å‘ŠåŠ è½½] i7ik1b3mgg - onLoad æˆåŠŸ, length: 1
[å¹¿å‘ŠåŠ è½½] æ•°æ®å·²å­˜å…¥, å½“å‰æ€»æ•°: 1
åªæœ‰ä¸€ä¸ªå¹¿å‘Šä½è¿”å›äº†æ•°æ®ï¼Œè€Œä¸”ï¼š
âœ… i7ik1b3mgg æˆåŠŸåŠ è½½
âŒ a5sz2rxpaj æ²¡æœ‰ä»»ä½•æ—¥å¿—ï¼ˆæ—¢æ²¡æœ‰ onLoadï¼Œä¹Ÿæ²¡æœ‰ onErrorï¼‰
è¿™è¯´æ˜ç¬¬2ä¸ªå¹¿å‘Šä½é™é»˜å¤±è´¥äº†ã€‚è®©æˆ‘æ£€æŸ¥ä¸€ä¸‹åä¸ºå¿«æ¸¸æˆå¹¿å‘Šå¹³å°çš„æ–‡æ¡£ï¼Œçœ‹çœ‹æ˜¯å¦éœ€è¦ç‰¹æ®Šå¤„ç†ã€‚æ ¹æ®åä¸ºå¿«æ¸¸æˆåŸç”Ÿå¹¿å‘Šçš„ç‰¹æ€§ï¼Œå¯èƒ½çš„åŸå› æœ‰ï¼š
å¹¿å‘Šå¡«å……ç‡é—®é¢˜ï¼šç¬¬2ä¸ªå¹¿å‘Šä½IDæ²¡æœ‰é…ç½®æˆ–æ²¡æœ‰å¹¿å‘Šåº“å­˜
å¹¶å‘è¯·æ±‚é™åˆ¶ï¼šåŒæ—¶è¯·æ±‚ä¸¤ä¸ªå¹¿å‘Šå¯èƒ½è¢«å¹³å°é™æµ
é™é»˜å¤±è´¥ï¼šæŸäº›æƒ…å†µä¸‹å¹³å°ä¸ä¼šè§¦å‘ onError å›è°ƒ
è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨é¡ºåºåŠ è½½ + è¶…æ—¶æ£€æµ‹
loginCanvas.ts
// ... existing code ...
    loadNativeAd :Array<any> = new Array();
    
    createNativeAd(adUnitId:string): Promise<void> {
        return new Promise((resolve, reject) => {
            console.log(`[å¹¿å‘ŠåŠ è½½] å¼€å§‹åŠ è½½å¹¿å‘Šä½: ${adUnitId}`);
            
            let isResolved = false;
            const timeout = setTimeout(() => {
                if (!isResolved) {
                    console.warn(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - è¶…æ—¶ï¼ˆ5ç§’æœªå“åº”ï¼‰`);
                    isResolved = true;
                    resolve();
                }
            }, 5000);
            
            let MynativeAd = qg.createNativeAd({
                adUnitId: adUnitId,
                success: function(code) {
                    console.log(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - success`);
                },
                fail: function(data, code) {
                    console.log(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - fail: ${data}, code: ${code}`);
                    if (!isResolved) {
                        clearTimeout(timeout);
                        isResolved = true;
                        resolve();
                    }
                },
                complete: function() {
                    console.log(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - complete`);
                }
            });

            MynativeAd.offLoad();
            MynativeAd.onLoad(function (test:any) {
                if (!test.adList || test.adList.length === 0) {
                    console.warn(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - onLoad è¿”å›ç©ºåˆ—è¡¨`);
                    if (!isResolved) {
                        clearTimeout(timeout);
                        isResolved = true;
                        resolve();
                    }
                    return;
                }
                
                let adId = test.adList[0].adId;
                let adData = test.adList[0];
                console.log(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - onLoad æˆåŠŸ, length: ${test.adList.length}`);
                console.log(JSON.stringify(test));
                var imgUrlList = test.adList[0].imgUrlList;
                console.log(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - imgUrlList: ${imgUrlList}`);
                
                window['loadNativeAd'].push(adData);
                console.log(`[å¹¿å‘ŠåŠ è½½] æ•°æ®å·²å­˜å…¥, å½“å‰æ€»æ•°: ${window['loadNativeAd'].length}`);
                
                if (!isResolved) {
                    clearTimeout(timeout);
                    isResolved = true;
                    resolve();
                }
            });
            
            MynativeAd.offError();
            MynativeAd.onError(function (test) {
                console.error(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - onError: ${test.errCode} - ${test.errMsg}`);
                if (!isResolved) {
                    clearTimeout(timeout);
                    isResolved = true;
                    resolve();
                }
            });
            
            MynativeAd.load();
        });
    }

    

    async start () {
        if(!window['loadNativeAd']){
            window['loadNativeAd'] = [];
        }

        await this.createNativeAd('i7ik1b3mgg');
        await this.createNativeAd('a5sz2rxpaj');
        
        console.log(`[å¹¿å‘ŠåŠ è½½] å…¨éƒ¨åŠ è½½å®Œæˆï¼Œæ€»å…±è·å–: ${window['loadNativeAd'].length} æ¡å¹¿å‘Šæ•°æ®`);
// ... existing code ...
å…³é”®æ”¹è¿›ï¼š
âœ… Promise åŒ–ï¼šcreateNativeAd() è¿”å› Promiseï¼Œæ”¯æŒ await
âœ… é¡ºåºåŠ è½½ï¼šä½¿ç”¨ await ç¡®ä¿ç¬¬1ä¸ªåŠ è½½å®Œå†åŠ è½½ç¬¬2ä¸ªï¼ˆé¿å…å¹¶å‘é™åˆ¶ï¼‰
âœ… è¶…æ—¶æ£€æµ‹ï¼š5ç§’å†…æ²¡æœ‰ä»»ä½•å›è°ƒå°±è‡ªåŠ¨ resolveï¼ˆå¤„ç†é™é»˜å¤±è´¥ï¼‰
âœ… é˜²é‡å¤ resolveï¼šä½¿ç”¨ isResolved æ ‡å¿—é¿å…å¤šæ¬¡è°ƒç”¨
âœ… æœ€ç»ˆç»Ÿè®¡ï¼šè¾“å‡ºæ€»å…±è·å–äº†å¤šå°‘æ¡å¹¿å‘Šæ•°æ®
é¢„æœŸæ•ˆæœï¼š
plaintext
[å¹¿å‘ŠåŠ è½½] å¼€å§‹åŠ è½½å¹¿å‘Šä½: i7ik1b3mgg
[å¹¿å‘ŠåŠ è½½] i7ik1b3mgg - success
[å¹¿å‘ŠåŠ è½½] i7ik1b3mgg - complete
[å¹¿å‘ŠåŠ è½½] i7ik1b3mgg - onLoad æˆåŠŸ, length: 1
[å¹¿å‘ŠåŠ è½½] æ•°æ®å·²å­˜å…¥, å½“å‰æ€»æ•°: 1
[å¹¿å‘ŠåŠ è½½] å¼€å§‹åŠ è½½å¹¿å‘Šä½: a5sz2rxpaj  â† ç¬¬1ä¸ªå®Œæˆåæ‰å¼€å§‹ç¬¬2ä¸ª
[å¹¿å‘ŠåŠ è½½] a5sz2rxpaj - success
[å¹¿å‘ŠåŠ è½½] a5sz2rxpaj - complete
[å¹¿å‘ŠåŠ è½½] a5sz2rxpaj - è¶…æ—¶ï¼ˆ5ç§’æœªå“åº”ï¼‰  â† å¦‚æœé™é»˜å¤±è´¥ä¼šæ˜¾ç¤ºè¿™ä¸ª
[å¹¿å‘ŠåŠ è½½] å…¨éƒ¨åŠ è½½å®Œæˆï¼Œæ€»å…±è·å–: 1 æ¡å¹¿å‘Šæ•°æ®
è¿™æ ·å°±èƒ½æ˜ç¡®çŸ¥é“ç¬¬2ä¸ªå¹¿å‘Šä½æ˜¯å¦çœŸçš„æ²¡æœ‰æ•°æ®ï¼Œè¿˜æ˜¯è¢«å¹³å°é™åˆ¶äº†ã€‚
loginCanvas.ts 53-126
 é‡æ–°æ·»åŠ å›æˆ‘åŸæ¥çš„åŒæ­¥ç‰ˆæœ¬
loginCanvas.ts 53-126
 é‡æ–°æ·»åŠ å›æˆ‘åŸæ¥çš„åŒæ­¥ç‰ˆæœ¬
å¥½çš„ï¼Œæˆ‘å¸®æ‚¨æ¢å¤æˆåŸæ¥çš„åŒæ­¥ç‰ˆæœ¬ï¼š
loginCanvas.ts
// ... existing code ...
    // Deleted:createNativeAd(adUnitId:string): Promise<void> {
    // Deleted://         return new Promise((resolve, reject) => {
    // Deleted://             console.log(`[å¹¿å‘ŠåŠ è½½] å¼€å§‹åŠ è½½å¹¿å‘Šä½: ${adUnitId}`);
    // Deleted://             
    // Deleted://             let isResolved = false;
    // Deleted://             const timeout = setTimeout(() => {
    // Deleted://                 if (!isResolved) {
    // Deleted://                     console.warn(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - è¶…æ—¶ï¼ˆ5ç§’æœªå“åº”ï¼‰`);
    // Deleted://                     isResolved = true;
    // Deleted://                     resolve();
    // Deleted://                 }
    // Deleted://             }, 10000);
    // Deleted://             
    // Deleted://             let MynativeAd = qg.createNativeAd({
    // Deleted://                 adUnitId: adUnitId,
    // Deleted://                 success: function(code) {
    // Deleted://                     console.log(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - success`);
    // Deleted://                 },
    // Deleted://                 fail: function(data, code) {
    // Deleted://                     console.log(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - fail: ${data}, code: ${code}`);
    // Deleted://                     if (!isResolved) {
    // Deleted://                         clearTimeout(timeout);
    // Deleted://                         isResolved = true;
    // Deleted://                         resolve();
    // Deleted://                     }
    // Deleted://                 },
    // Deleted://                 complete: function() {
    // Deleted://                     console.log(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - complete`);
    // Deleted://                 }
    // Deleted://             });
    // Deleted://
    // Deleted://             // MynativeAd.offLoad();
    // Deleted://             MynativeAd.onLoad(function (test:any) {
    // Deleted://                 if (!test.adList || test.adList.length === 0) {
    // Deleted://                     console.warn(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - onLoad è¿”å›ç©ºåˆ—è¡¨`);
    // Deleted://                     if (!isResolved) {
    // Deleted://                         clearTimeout(timeout);
    // Deleted://                         isResolved = true;
    // Deleted://                         resolve();
    // Deleted://                     }
    // Deleted://                     return;
    // Deleted://                 }
    // Deleted://                 
    // Deleted://                 let adId = test.adList[0].adId;
    // Deleted://                 let adData = test.adList[0];
    // Deleted://                 console.log(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - onLoad æˆåŠŸ, length: ${test.adList.length}`);
    // Deleted://                 console.log(JSON.stringify(test));
    // Deleted://                 var imgUrlList = test.adList[0].imgUrlList;
    // Deleted://                 console.log(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - imgUrlList: ${imgUrlList}`);
    // Deleted://                 
    // Deleted://                 window['loadNativeAd'].push(adData);
    // Deleted://                 console.log(`[å¹¿å‘ŠåŠ è½½] æ•°æ®å·²å­˜å…¥, å½“å‰æ€»æ•°: ${window['loadNativeAd'].length}`);
    // Deleted://                 
    // Deleted://                 if (!isResolved) {
    // Deleted://                     clearTimeout(timeout);
    // Deleted://                     isResolved = true;
    // Deleted://                     resolve();
    // Deleted://                 }
    // Deleted://             });
    // Deleted://             
    // Deleted://             MynativeAd.offError();
    // Deleted://             MynativeAd.onError(function (test) {
    // Deleted://                 console.error(`[å¹¿å‘ŠåŠ è½½] ${adUnitId} - onError: ${test.errCode} - ${test.errMsg}`);
    // Deleted://                 if (!isResolved) {
    // Deleted://                     clearTimeout(timeout);
    // Deleted://                     isResolved = true;
    // Deleted://                     resolve();
    // Deleted://                 }
    // Deleted://             });
    // Deleted://             
    // Deleted://             MynativeAd.load();
    // Deleted://         });
    // Deleted://     }

    createNativeAd(adUnitId:string){
    
    console.log("ad demo : loadNativeAd");
    let MynativeAd = qg.createNativeAd({
        adUnitId: adUnitId,
        success: function(code) {
            console.log("loadNativeAd loadNativeAd : success");
        },
        fail: function(data, code) {
            console.log("loadNativeAd loadNativeAd fail: " + data + "," + code);
        },
        complete: function() {
            console.log("loadNativeAd loadNativeAd : complete");
        }
    });        


    MynativeAd.offLoad();
    MynativeAd.onLoad(function (test:any) {
        let adId = test.adList[0].adId;
        let adData = test.adList[0];
        console.log("ad demo loadNativeAd onLoad NativeAd enter length : " + test.adList.length);
        console.log(JSON.stringify(test));         
        var imgUrlList = test.adList[0].imgUrlList;
        console.log("ad demo : loadNativeAd onLoad imgUrlList : " + imgUrlList);
        
        window['loadNativeAd'].push(adData)
    });
    MynativeAd.offError();
    MynativeAd.onError(function (test) {
        console.log("ad demo : loadNativeAd onError enter" + test.errCode);
        console.log("ad demo : loadNativeAd onError enter" + test.errMsg);
    });  
    MynativeAd.load();
}
// ... existing code ...
å·²æ¢å¤æˆæ‚¨åŸæ¥çš„åŒæ­¥ç‰ˆæœ¬ï¼Œä¸å†ä½¿ç”¨ Promise å’Œ awaitã€‚è¿™æ ·ä¸¤ä¸ªå¹¿å‘Šä½ä¼šåŒæ—¶å¹¶å‘åŠ è½½ã€‚
ä¸Šé¢çš„å¼‚æ­¥ç‰ˆæœ¬æˆåŠŸäº†ï¼Œè¯´æ˜å¹¿å‘Šä½æ²¡é—®é¢˜ï¼Œé—®é¢˜å‡ºåœ¨äº†åŒæ­¥åŠ è½½ä¸¤ä¸ªå¯¼è‡´å‡ºç°çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ
ä¸Šé¢çš„å¼‚æ­¥ç‰ˆæœ¬æˆåŠŸäº†ï¼Œè¯´æ˜å¹¿å‘Šä½æ²¡é—®é¢˜ï¼Œé—®é¢˜å‡ºåœ¨äº†åŒæ­¥åŠ è½½ä¸¤ä¸ªå¯¼è‡´å‡ºç°çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ
å¾ˆå¥½çš„å‘ç°ï¼è¿™è¯´æ˜åä¸ºå¿«æ¸¸æˆå¹³å°å¯¹åŸç”Ÿå¹¿å‘Šçš„å¹¶å‘åŠ è½½æœ‰é™åˆ¶ã€‚è®©æˆ‘åˆ†æä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼š
é—®é¢˜æ ¹æºï¼šå¹¿å‘ŠSDKçš„å¹¶å‘é™åˆ¶
åŒæ­¥ç‰ˆæœ¬çš„æ‰§è¡Œæµç¨‹ï¼š
javascript
// å‡ ä¹åŒæ—¶æ‰§è¡Œï¼ˆæ—¶é—´é—´éš” < 1msï¼‰
this.createNativeAd('i7ik1b3mgg');  // ç«‹å³åˆ›å»ºå®ä¾‹1
this.createNativeAd('a5sz2rxpaj');  // ç«‹å³åˆ›å»ºå®ä¾‹2

// ä¸¤ä¸ªå¹¿å‘Šå®ä¾‹å‡ ä¹åŒæ—¶è°ƒç”¨ load()
MynativeAd1.load();  // æ—¶é—´ç‚¹: T
MynativeAd2.load();  // æ—¶é—´ç‚¹: T + 0.001ms
å¯èƒ½çš„å¹³å°é™åˆ¶ï¼š
è¯·æ±‚é˜Ÿåˆ—é”å®š
ç¬¬1ä¸ªå¹¿å‘Šå¼€å§‹åŠ è½½æ—¶ï¼ŒSDKå†…éƒ¨å¯èƒ½ä¼šé”å®šè¯·æ±‚é˜Ÿåˆ—
ç¬¬2ä¸ªå¹¿å‘Šçš„ load() è¢«å¿½ç•¥æˆ–æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—
ä½†SDKæ²¡æœ‰æ­£ç¡®å¤„ç†é˜Ÿåˆ—ï¼Œå¯¼è‡´ç¬¬2ä¸ªè¯·æ±‚"ä¸¢å¤±"
å•ä¾‹èµ„æºç«äº‰
åä¸ºå¿«æ¸¸æˆçš„ qg.createNativeAd() å¯èƒ½å…±äº«æŸäº›å•ä¾‹èµ„æºï¼ˆå¦‚ç½‘ç»œç®¡ç†å™¨ï¼‰
å¹¶å‘è¯·æ±‚å¯¼è‡´èµ„æºç«äº‰ï¼Œç¬¬2ä¸ªè¯·æ±‚è¢«é™é»˜ä¸¢å¼ƒ
å¹¿å‘Šå¡«å……ç­–ç•¥
å¹³å°å¯èƒ½é™åˆ¶"åŒä¸€æ—¶åˆ»åªèƒ½è¯·æ±‚1ä¸ªåŸç”Ÿå¹¿å‘Š"
è¿™æ˜¯ä¸ºäº†é˜²æ­¢æ»¥ç”¨å¹¿å‘Šèµ„æº
ä¸ºä»€ä¹ˆå¼‚æ­¥ç‰ˆæœ¬æˆåŠŸï¼Ÿ
javascript
await this.createNativeAd('i7ik1b3mgg');  // ç­‰å¾…ç¬¬1ä¸ªå®Œæˆ
await this.createNativeAd('a5sz2rxpaj');  // ç¬¬1ä¸ªå®Œæˆåå†è¯·æ±‚ç¬¬2ä¸ª
æ—¶é—´å·®æ‹¯æ•‘äº†ä¸€åˆ‡ï¼š
ç¬¬1ä¸ªå¹¿å‘ŠåŠ è½½å®Œæˆï¼ˆè€—æ—¶çº¦1-3ç§’ï¼‰
SDKé‡Šæ”¾èµ„æº/è§£é”é˜Ÿåˆ—
ç¬¬2ä¸ªå¹¿å‘Šæ‰å¼€å§‹åŠ è½½ âœ… æˆåŠŸ
æœ€ç®€ä¼˜åŒ–æ–¹æ¡ˆ
æ—¢ç„¶åŒæ­¥åŠ è½½æœ‰é—®é¢˜ï¼Œé‚£å°±ä¿ç•™å¼‚æ­¥ç‰ˆæœ¬ï¼Œä½†ç®€åŒ–é€»è¾‘ï¼š
loginCanvas.ts
// ... existing code ...
    loadNativeAd :Array<any> = new Array();
    
    createNativeAd(adUnitId:string): Promise<void> {
        return new Promise((resolve) => {
            console.log(`[å¹¿å‘Š] åŠ è½½: ${adUnitId}`);
            
            const timeout = setTimeout(() => {
                console.warn(`[å¹¿å‘Š] ${adUnitId} è¶…æ—¶`);
                resolve();
            }, 5000);
            
            let MynativeAd = qg.createNativeAd({
                adUnitId: adUnitId,
                success: function(code) {
                    console.log(`[å¹¿å‘Š] ${adUnitId} success`);
                },
                fail: function(data, code) {
                    console.log(`[å¹¿å‘Š] ${adUnitId} fail: ${code}`);
                    clearTimeout(timeout);
                    resolve();
                },
                complete: function() {
                    console.log(`[å¹¿å‘Š] ${adUnitId} complete`);
                }
            });

            MynativeAd.offLoad();
            MynativeAd.onLoad(function (test:any) {
                if (!test.adList || test.adList.length === 0) {
                    console.warn(`[å¹¿å‘Š] ${adUnitId} æ— æ•°æ®`);
                    clearTimeout(timeout);
                    resolve();
                    return;
                }
                
                let adData = test.adList[0];
                console.log(`[å¹¿å‘Š] ${adUnitId} æˆåŠŸ, å…±${test.adList.length}æ¡`);
                
                window['loadNativeAd'].push(adData);
                console.log(`[å¹¿å‘Š] å½“å‰æ± : ${window['loadNativeAd'].length}`);
                
                clearTimeout(timeout);
                resolve();
            });
            
            MynativeAd.offError();
            MynativeAd.onError(function (test) {
                console.error(`[å¹¿å‘Š] ${adUnitId} error: ${test.errMsg}`);
                clearTimeout(timeout);
                resolve();
            });
            
            MynativeAd.load();
        });
    }

    

    async start () {
        if(!window['loadNativeAd']){
            window['loadNativeAd'] = [];
        }

        await this.createNativeAd('i7ik1b3mgg');
        await this.createNativeAd('a5sz2rxpaj');
        
        console.log(`[å¹¿å‘Š] åŠ è½½å®Œæˆï¼Œå…±è·å– ${window['loadNativeAd'].length} æ¡`);
// ... existing code ...
å…³é”®ç‚¹ï¼š
âœ… å¼‚æ­¥é¡ºåºåŠ è½½ï¼šé¿å…å¹¶å‘å†²çª
âœ… è¶…æ—¶ä¿æŠ¤ï¼š5ç§’æœªå“åº”è‡ªåŠ¨ç»§ç»­ï¼Œä¸ä¼šå¡æ­»
âœ… ç®€åŒ–æ—¥å¿—ï¼šä¿ç•™å…³é”®ä¿¡æ¯ï¼Œæ›´æ¸…æ™°
âœ… Promise ç®€åŒ–ï¼šç§»é™¤ isResolved æ ‡å¿—ï¼Œç›´æ¥ç”¨ clearTimeout + resolve
