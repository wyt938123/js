<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        //æ»¡è¶³å¼‚æ­¥æ¡ä»¶åé˜Ÿåˆ—å¼€å¯
        class ReportManager {
            private readyPromise: Promise<void>;
            private resolveReady: () => void;

            constructor() {
                // åˆå§‹åŒ–ä¸€ä¸ªpendingçŠ¶æ€çš„Promiseï¼Œä¿å­˜resolveå‡½æ•°
                this.readyPromise = new Promise(resolve => {
                    this.resolveReady = resolve;
                });
            }

            // æ¨¡æ‹Ÿåˆå§‹åŒ–å®Œæˆçš„å›è°ƒ
            public onInitialized() {
                console.log('âœ… åˆå§‹åŒ–å®Œæˆï¼Œå¼€å§‹æ‰§è¡Œæ‰€æœ‰ä¸ŠæŠ¥è¯·æ±‚');
                this.resolveReady();
            }

            // å®é™…çš„ä¸ŠæŠ¥é€»è¾‘
            private reportData(config: { id: number; msg: string }) {
                console.log(`ğŸ“¤ ä¸ŠæŠ¥æ•°æ®: ${JSON.stringify(config)}`);
            }

            // å¯¹å¤–æš´éœ²çš„ä¸ŠæŠ¥æ–¹æ³•
            public async report(config: { id: number; msg: string }) {
                console.log(`â³ ç­‰å¾…åˆå§‹åŒ–: ä¸ŠæŠ¥è¯·æ±‚${config.id}å·²æ’é˜Ÿ`);
                await this.readyPromise; // é˜»å¡ï¼Œç›´åˆ°åˆå§‹åŒ–å®Œæˆ
                this.reportData(config);
            }
        }

        // æµ‹è¯•ä»£ç 
        const manager = new ReportManager();

        // æ¨¡æ‹Ÿå¤šæ¬¡è°ƒç”¨reportï¼ˆæ­¤æ—¶è¿˜æœªåˆå§‹åŒ–ï¼‰
        manager.report({ id: 1, msg: 'ç¬¬ä¸€ä¸ªä¸ŠæŠ¥è¯·æ±‚' });
        manager.report({ id: 2, msg: 'ç¬¬äºŒä¸ªä¸ŠæŠ¥è¯·æ±‚' });
        manager.report({ id: 3, msg: 'ç¬¬ä¸‰ä¸ªä¸ŠæŠ¥è¯·æ±‚' });

        // æ¨¡æ‹Ÿå»¶è¿Ÿåˆå§‹åŒ–ï¼ˆæ¯”å¦‚2ç§’åext_field_14å‡†å¤‡å¥½ï¼‰
        setTimeout(() => {
            manager.onInitialized();
        }, 2000);
    </script>
</body>

</html>