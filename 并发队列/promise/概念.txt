åµŒå¥—è°ƒç”¨ï¼Œç¬¬ä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºå¾€å¾€æ˜¯ç¬¬äºŒä¸ªå‡½æ•°çš„è¾“å…¥ï¼›
å¤„ç†å¤šä¸ªå¼‚æ­¥è¯·æ±‚å¹¶å‘ï¼Œå¼€å‘æ—¶å¾€å¾€éœ€è¦åŒæ­¥è¯·æ±‚æœ€ç»ˆçš„ç»“æœã€‚

æ»¡è¶³ç¬¬ä¸€ä¸ª
let fs = require('fs')

function read(filename) {
  return new Promise((resolve, reject) => {
    fs.readFile(filename, 'utf8', (err, data) => {
      if (err) reject(err);
      resolve(data);
    })
  })
}

read('./name.txt').then((data)=>{
  return read(data) 
}).then((data)=>{
  return read(data)  
}).then((data)=>{
    console.log(data);
},err=>{
    console.log(err);
})

ä½œè€…ï¼šé½å°ç¥
é“¾æ¥ï¼šhttps://juejin.cn/post/6850037281206566919
æ¥æºï¼šç¨€åœŸæ˜é‡‘
è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚

promise.thenæ–¹æ³•ä¹Ÿæ˜¯ç«‹å³è°ƒç”¨çš„ï¼Œè¿”å›ä¸€ä¸ªpromiseï¼Œå¹¶ä¸”å…¶çŠ¶æ€æ˜¯ğŸˆ¶ç”±returnçš„å€¼å†³å®šçš„
thenå‡½æ•°æœ¬èº«çš„é€»è¾‘ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œä¸”å›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°åœ¨é‡Œé¢è¿›è¡Œå¤„ç†



å…·ä½“æ¥è¯´ï¼š
promise2 çš„å£°æ˜æ˜¯ const promise2 = new MyPromise(...)ï¼Œconst å˜é‡çš„åˆå§‹åŒ–æ˜¯ â€œå…ˆåˆ›å»ºç»‘å®šã€å†æ‰§è¡Œèµ‹å€¼â€ï¼Œä¸”åœ¨èµ‹å€¼å®Œæˆå‰å¤„äº â€œæš‚æ—¶æ€§æ­»åŒºï¼ˆTDZï¼‰â€ï¼Œæ— æ³•è®¿é—®ï¼›
æ‰§è¡Œå™¨å‡½æ•°ï¼ˆ(resolve, reject) => { ... }ï¼‰åœ¨ new MyPromise æ—¶ç«‹å³åŒæ­¥æ‰§è¡Œï¼Œæ­¤æ—¶ promise2 è¿˜æœªå®Œæˆèµ‹å€¼ï¼ˆå› ä¸º new MyPromise è¿˜åœ¨æ‰§è¡Œä¸­ï¼‰ï¼Œä½†ä½ åœ¨æ‰§è¡Œå™¨å†…éƒ¨è°ƒç”¨äº† resolvePromise(promise2, x, resolve, reject)ï¼Œç›´æ¥å¼•ç”¨äº†å¤„äº TDZ ä¸­çš„ promise2ï¼Œå› æ­¤è§¦å‘è¯¥é”™è¯¯ã€‚


function resolvePromise(promise2, x, resolve, reject) {
  // å¦‚æœç›¸ç­‰äº†ï¼Œè¯´æ˜returnçš„æ˜¯è‡ªå·±ï¼ŒæŠ›å‡ºç±»å‹é”™è¯¯å¹¶è¿”å›
  if (promise2 === x) {
    return reject(new TypeError('Chaining cycle detected for promise #<Promise>'))
  }
  if(x instanceof MyPromise) {
    x.then(resolve, reject)
  } else{
    resolve(x)
  }

å¯¼è‡´ return çš„promiseè¿›å…¥thenæµç¨‹


