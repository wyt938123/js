<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        createNativeAd(adUnitId: string): Promise<void> {
    return new Promise((resolve, reject) => {
        console.log(`[广告加载] 开始加载广告位: ${adUnitId}`);

        let finished = false;

        const finish = (err?: any) => {
            if (finished) return;
            finished = true;
            clearTimeout(timeout);

            if (err) {
                // 统一把错误转成 Error，方便调用方打印 / 上报
                const error =
                    err instanceof Error
                        ? err
                        : new Error(typeof err === 'string'
                            ? err
                            : JSON.stringify(err));
                console.error(`[广告加载] ${adUnitId} - 失败:`, error);
                reject(error);
            } else {
                console.log(`[广告加载] ${adUnitId} - 成功`);
                resolve();
            }
        };

        const timeout = setTimeout(() => {
            finish(new Error(`[广告加载] ${adUnitId} - 超时（8秒未响应）`));
        }, 8000);

        let MynativeAd = qg.createNativeAd({
            adUnitId,
            success(code) {
                console.log(`[广告加载] ${adUnitId} - success`, code);
            },
            fail(data, code) {
                finish({ data, code, msg: 'qg.createNativeAd fail' });
            },
            complete() {
                console.log(`[广告加载] ${adUnitId} - complete`);
            }
        });

        MynativeAd.offLoad();
        MynativeAd.onLoad(function (test: any) {
            if (!test.adList || test.adList.length === 0) {
                finish(new Error(`[广告加载] ${adUnitId} - onLoad 返回空列表`));
                return;
            }

            let adId = test.adList[0].adId;
            let adData = test.adList[0];

            console.log(`[广告加载] ${adUnitId} - onLoad 成功, length: ${test.adList.length}`);
            console.log(JSON.stringify(test));

            try {
                window['loadNativeAd'].push({ nativeAd: MynativeAd, data: adData, adId });
                console.log(`[广告加载] 数据已存入, 当前总数: ${window['loadNativeAd'].length}`);
            } catch (e) {
                finish(e);
                return;
            }

            finish(); // 成功
        });

        MynativeAd.offError();
        MynativeAd.onError(function (test: any) {
            finish({
                errCode: test.errCode,
                errMsg: test.errMsg,
                from: 'onError'
            });
        });

        MynativeAd.load();
    });
}
    </script>
</body>
</html>